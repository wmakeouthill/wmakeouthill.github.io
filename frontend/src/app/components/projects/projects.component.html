<section id="projects" class="section projects" #projectsSection>
  <div class="container">
    <div class="section-title">
      <h2>{{ 'projects.title' | translate }}</h2>
      <p class="section-subtitle">{{ 'projects.subtitle' | translate }}</p>
    </div>

    <!-- Filters -->
    <div class="filters">
      @for (lang of availableLanguages(); track lang) {
      <button class="filter-btn" [class.active]="selectedFilter() === lang" (click)="filterProjects(lang)">
        {{ lang === 'all' ? ('projects.filters.all' | translate) : lang }}
      </button>
      }
    </div>

    <!-- Loading State -->
    @if (loading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>{{ 'projects.loading' | translate }}</p>
    </div>
    }

    <!-- Projects Grid -->
    @if (!loading() && filteredProjects().length > 0) {
    <div class="projects-grid">
      @for (project of paginatedProjects(); track project.id) {
      <div class="project-card">
        <div class="project-image">
          <img [src]="getProjectImage(project.name)" [alt]="project.name"
            (error)="onImageError($event, project.name)" />
          <div class="project-overlay">
            <div class="project-links-grid" [class.no-demo]="!project.homepage">
              <!-- Row 1: GitHub | README -->
              <a [href]="project.html_url" target="_blank" rel="noopener noreferrer" class="project-link github-btn">
                <img src="assets/icons/github-octocat.svg" alt="GitHub" width="16" height="16" />
                <span>{{ 'projects.github' | translate }}</span>
              </a>
              <button (click)="openReadmeModal(project.name)" class="project-link readme-btn">
                <img src="assets/icons/readme.svg" alt="README" width="16" height="16" />
                <span>{{ 'projects.readme' | translate }}</span>
              </button>

              <!-- Row 2: Demo (if exists) | Code Preview -->
              @if (project.homepage) {
              <a [href]="project.homepage" target="_blank" rel="noopener noreferrer" class="project-link demo-btn">
                <span class="demo-icon">üöÄ</span>
                <span>{{ 'projects.demo' | translate }}</span>
              </a>
              }
              <button (click)="openCodePreviewModal(project)" class="project-link code-btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path
                    d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z" />
                </svg>
                <span>{{ 'projects.codePreview' | translate }}</span>
              </button>
            </div>
          </div>
        </div>

        <div class="project-content">
          <h3 class="project-title">{{ project.name }}</h3>
          <p class="project-description">
            {{ project.description || ('projects.noDescription' | translate) }}
          </p>

          <div class="project-footer">
            <div class="project-stats">
              <span class="stat">‚≠ê {{ project.stargazers_count }}</span>
              <span class="stat">üî± {{ project.forks_count }}</span>
            </div>

            @if (project.language) {
            <span class="language-badge">{{ project.language }}</span>
            }
          </div>

          @if (project.languages && project.languages.length > 0) {
          <div class="languages-section">
            <div class="languages-bar">
              @for (lang of project.languages; track lang.name) {
              <div class="language-segment" [style.background-color]="lang.color" [style.width.%]="lang.percentage"
                [title]="lang.name + ': ' + lang.percentage + '%'"></div>
              }
            </div>
            <div class="languages-legend">
              @for (lang of project.languages; track lang.name) {
              <div class="language-item">
                <span class="language-color" [style.background-color]="lang.color"></span>
                <span class="language-name">{{ lang.name }}</span>
                <span class="language-percentage">{{ lang.percentage }}%</span>
              </div>
              }
            </div>
          </div>
          } @if (project.topics && project.topics.length > 0) {
          <div class="project-topics">
            @for (topic of project.topics.slice(0, 3); track topic) {
            <span class="topic-tag">{{ topic }}</span>
            }
          </div>
          }
        </div>
      </div>
      }
    </div>

    <!-- Pagination -->
    @if (totalPages() > 1) {
    <div class="pagination">
      <button class="pagination-btn" [class.disabled]="currentPage() === 1" (click)="previousPage()"
        aria-label="{{ 'projects.pagination.previous' | translate }}">
        ‚Äπ
      </button>

      @for (page of pageNumbers(); track page) {
      @if (page === -1) {
      <span class="pagination-ellipsis">...</span>
      } @else {
      <button class="pagination-btn" [class.active]="currentPage() === page" (click)="goToPage(page)">
        {{ page }}
      </button>
      }
      }

      <button class="pagination-btn" [class.disabled]="currentPage() === totalPages()" (click)="nextPage()"
        aria-label="{{ 'projects.pagination.next' | translate }}">
        ‚Ä∫
      </button>
    </div>
    } }

    <!-- Empty State -->
    @if (!loading() && filteredProjects().length === 0) {
    <div class="empty-state">
      <p>{{ 'projects.empty' | translate }}</p>
    </div>
    }
  </div>

  <!-- README Modal -->
  <app-readme-modal [isOpen]="showReadmeModal()" [projectName]="currentProjectName()" (close)="closeReadmeModal()">
  </app-readme-modal>

  <!-- Code Preview Modal -->
  <app-code-preview-modal [isOpen]="showCodePreviewModal()" [projectName]="currentProjectForPreview()"
    (close)="closeCodePreviewModal()">
  </app-code-preview-modal>
</section>