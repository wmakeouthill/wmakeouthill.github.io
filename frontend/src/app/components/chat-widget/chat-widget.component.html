<div class="chat-widget-container" [class.scroll-top-visible]="scrollToTopVisible()">
  <!-- BotÃ£o flutuante -->
  <button
    class="chat-floating-button"
    type="button"
    (click)="toggleOpen()"
    aria-label="Abrir chat com IA sobre o Wesley"
    >
    <span class="chat-icon">ðŸ’¬</span>
    <span class="chat-label-badge">
      <span class="chat-label">Chat IA</span>
    </span>
  </button>

  <!-- Painel de chat -->
  @if (isOpen()) {
    <section class="chat-panel" aria-label="Chat com IA sobre o Wesley">
      <header class="chat-header">
        <div class="chat-header-info">
          <h2>Chat com a IA do Wesley</h2>
          <p>FaÃ§a perguntas sobre experiÃªncia, projetos e stack.</p>
        </div>
        <button
          type="button"
          class="chat-close-button"
          (click)="toggleOpen()"
          aria-label="Fechar chat"
        >
          âœ•
        </button>
      </header>

      <div class="chat-messages" role="log" #messagesContainer>
        @if (messages().length === 0) {
          <div class="chat-message chat-message-assistant chat-message-initial">
            <p>
              OlÃ¡! Eu sou a IA treinada com o portfÃ³lio do Wesley. Pode perguntar sobre
              tecnologias que ele domina, projetos que jÃ¡ fez ou experiÃªncias profissionais.
            </p>
          </div>
        }

        @for (message of messages(); track message.timestamp) {
          <div
            class="chat-message"
            [class.chat-message-user]="message.from === 'user'"
            [class.chat-message-assistant]="message.from === 'assistant'"
          >
            @if (message.from === 'assistant' && message.html) {
              <div [innerHTML]="message.html"></div>
            } @else {
              <p>{{ message.text }}</p>
            }
          </div>
        }

        @if (isLoading()) {
          <div class="chat-message chat-message-assistant chat-loading">
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
          </div>
        }
      </div>

      <form
        class="chat-input-area"
        (ngSubmit)="sendMessage()"
        autocomplete="off"
      >
        <input
          #chatInput
          type="text"
          class="chat-input"
          [disabled]="isLoading()"
          [ngModel]="inputText()"
          (ngModelChange)="handleInputChange($event)"
          name="chatInput"
          placeholder="Ex.: Me explica o projeto LoL Matchmaking ou o Traffic Manager..."
        />
        <button
          type="submit"
          class="chat-send-button"
          [disabled]="!canSend()"
        >
          Enviar
        </button>
      </form>
    </section>
  }
</div>


