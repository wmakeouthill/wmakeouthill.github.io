# ğŸ¯ Diretrizes de Desenvolvimento (Cursor Rules)
## Arquitetura Limpa â€¢ SOLID â€¢ DDD â€¢ DRY â€¢ ACID â€¢ Clean Code â€¢ Clean Architecture

> **Este documento serve como ponto de entrada para os padrÃµes de desenvolvimento.**
> As regras especÃ­ficas estÃ£o organizadas em arquivos dedicados:

| Arquivo | Escopo | DescriÃ§Ã£o |
|---------|--------|-----------|
| `.cursorrules` | Geral | PrincÃ­pios fundamentais, OWASP Top 10, visÃ£o geral (este arquivo) |
| `.cursorrules-frontend` | Angular 20+ Zoneless | Regras especÃ­ficas frontend + SeguranÃ§a Angular (CSP, XSS, XSRF) |
| `.cursorrules-backend` | Java 21/25 LTS / Spring Boot 3.5.x | Regras especÃ­ficas backend + Spring Security 6.x (OAuth2, JWT, RBAC) |

---

## ğŸ“‹ VERSÃ•ES LTS ESTÃVEIS OBRIGATÃ“RIAS

### Stack Backend (Java)

| Tecnologia | VersÃ£o LTS | ObservaÃ§Ã£o |
|------------|------------|------------|
| Java | **21 LTS** (obrigatÃ³rio) / **25 LTS** (preferido quando disponÃ­vel) | Java 25 LTS previsto para setembro 2025 |
| Spring Boot | **3.4.x** / **3.5.x** (quando disponÃ­vel) | Spring Boot 3.5 previsto para maio 2025 |
| Spring Framework | **6.2.x** | CompatÃ­vel com Spring Boot 3.4/3.5 |
| Maven | **3.9.x** | Build tool padrÃ£o |
| Gradle | **8.x** | Alternativa ao Maven |
| MapStruct | **1.6.x** | Mapeamento de objetos (preferido sobre manual) |
| Liquibase | **4.x** | MigraÃ§Ãµes de banco de dados |
| JUnit | **5.11+** | Framework de testes |
| Mockito | **5.x** | Framework de mocking |

### Stack Frontend (Angular)

| Tecnologia | VersÃ£o | ObservaÃ§Ã£o |
|------------|--------|------------|
| Angular | **20.x+** | Zoneless estÃ¡vel, standalone por padrÃ£o |
| TypeScript | **5.7+** | Strict mode obrigatÃ³rio |
| Node.js | **22 LTS** | Toolchain e runtime |
| RxJS | **7.8+** | Uso reduzido (preferir Signals) |
| ESLint | **9.x** | Flat config obrigatÃ³rio |

---

## âš ï¸ PRINCÃPIOS FUNDAMENTAIS INEGOCIÃVEIS

### 1. Clean Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       INFRASTRUCTURE                             â”‚
â”‚          Frameworks, UI, DB, APIs Externas, Config               â”‚
â”‚                                                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚                    APPLICATION                         â”‚    â”‚
â”‚    â”‚             Use Cases, DTOs, Ports, Services           â”‚    â”‚
â”‚    â”‚                                                        â”‚    â”‚
â”‚    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
â”‚    â”‚    â”‚               DOMAIN                       â”‚      â”‚    â”‚
â”‚    â”‚    â”‚     Entidades, Value Objects,              â”‚      â”‚    â”‚
â”‚    â”‚    â”‚     Regras de NegÃ³cio, Domain Services     â”‚      â”‚    â”‚
â”‚    â”‚    â”‚     âŒ ZERO dependÃªncias externas          â”‚      â”‚    â”‚
â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
â”‚    â”‚                                                        â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Regra de DependÃªncia:** `Infrastructure â†’ Application â†’ Domain`

âŒ **NUNCA** inverta essa ordem!
âœ… **Camadas externas DEPENDEM de camadas internas**
âŒ **Camadas internas NUNCA dependem de camadas externas**

| Camada | Pode Depender De | NÃƒO Pode Depender De |
|--------|------------------|----------------------|
| Domain | Nada (Ã© o nÃºcleo) | Application, Infrastructure |
| Application | Domain | Infrastructure |
| Infrastructure | Application, Domain | - |

---

### 2. SOLID (Todos ObrigatÃ³rios)

| PrincÃ­pio | AplicaÃ§Ã£o | Regra |
|-----------|-----------|-------|
| **S**ingle Responsibility | Classes/Componentes | Uma classe = uma responsabilidade Ãºnica |
| **O**pen/Closed | Extensibilidade | Aberto para extensÃ£o, fechado para modificaÃ§Ã£o |
| **L**iskov Substitution | Hierarquias | Subtipos devem ser substituÃ­veis pelo tipo base |
| **I**nterface Segregation | Interfaces | Interfaces pequenas, especÃ­ficas e coesas |
| **D**ependency Inversion | Acoplamento | Dependa de abstraÃ§Ãµes, nÃ£o de implementaÃ§Ãµes |

#### Exemplos SOLID

```java
// âœ… Single Responsibility - Uma classe, uma responsabilidade
public class CriarPedidoUseCase { /* apenas criaÃ§Ã£o */ }
public class CancelarPedidoUseCase { /* apenas cancelamento */ }

// âœ… Open/Closed - ExtensÃ­vel via interface
public interface ValidadorPedido { void validar(Pedido pedido); }
public class ValidadorPreco implements ValidadorPedido { }
public class ValidadorEstoque implements ValidadorPedido { }

// âœ… Interface Segregation - Interfaces pequenas
public interface Listavel<T> { List<T> listar(); }
public interface Persistivel<T> { T salvar(T entity); }

// âœ… Dependency Inversion - Depende de abstraÃ§Ãµes
@RequiredArgsConstructor
public class PedidoService {
    private final PedidoRepositoryPort repository; // Interface, nÃ£o implementaÃ§Ã£o
}
```

---

### 3. DRY (Don't Repeat Yourself)

#### Regras ObrigatÃ³rias

- âœ… **SEMPRE** verificar antes de criar:
  - Backend â†’ bibliotecas comuns, mÃ³dulos compartilhados, utils
  - Frontend â†’ `shared/`, `utils/`, composables existentes
- âœ… **SEMPRE** centralizar conversÃµes e mapeamentos:
  - Backend â†’ Mappers via DI (Spring) + JacksonConfig / MapStruct
  - Frontend â†’ Composables, Adapters, Facades reutilizÃ¡veis
- âœ… **SEMPRE** reutilizar antes de duplicar
- âŒ **NUNCA** duplicar cÃ³digo existente
- âŒ **NUNCA** criar utilitÃ¡rios sem verificar se jÃ¡ existem

#### ReutilizaÃ§Ã£o de Mappers (JacksonConfig / Factories)

**REGRAS CRÃTICAS PARA EVITAR MEMORY LEAK:**

- âŒ **PROIBIDO** `new ObjectMapper()` espalhado no cÃ³digo
- âŒ **PROIBIDO** singleton manual/registry global (`getInstance()`, `static final` com cache)
- âœ… `ObjectMapper` deve ser configurado em **um Ãºnico ponto** (JacksonConfig) e **injetado**
- âœ… Mappers devem ser **stateless** e providos por **DI** (singleton controlado pelo container)
- âœ… Para variaÃ§Ãµes, expor via **factories** (ex.: `ObjectReaderFactory`, `ObjectWriterFactory`)

```java
// âœ… CORRETO - InjeÃ§Ã£o via DI
@Configuration
public class JacksonConfig {
    @Bean
    @Primary
    public ObjectMapper objectMapper() {
        return JsonMapper.builder()
            .addModule(new JavaTimeModule())
            .disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS)
            .build();
    }
}

@Service
@RequiredArgsConstructor
public class MeuService {
    private final ObjectMapper objectMapper; // Injetado, singleton do Spring
}

// âŒ ERRADO - Singleton manual
public class JsonUtil {
    private static final ObjectMapper MAPPER = new ObjectMapper(); // Memory leak!
    public static ObjectMapper getInstance() { return MAPPER; }
}
```

---

### 4. Clean Code

#### Limites de Tamanho

| Escopo | Limite Recomendado | Limite MÃ¡ximo |
|--------|-------------------|---------------|
| Classe/Componente | 150 linhas | 300 linhas |
| MÃ©todo/FunÃ§Ã£o | 15 linhas | 20 linhas |
| ParÃ¢metros | 3 parÃ¢metros | 5 parÃ¢metros |
| NÃ­veis de indentaÃ§Ã£o | 2 nÃ­veis | 3 nÃ­veis |

#### Nomenclatura Universal

| Tipo | PadrÃ£o | Exemplo |
|------|--------|---------|
| Classes | PascalCase | `ProdutoService`, `CriarPedidoUseCase` |
| Interfaces | PascalCase (sem prefixo I) | `PedidoRepository`, `ValidadorPedido` |
| MÃ©todos/FunÃ§Ãµes | camelCase (verbos) | `buscarProduto()`, `salvarCliente()` |
| VariÃ¡veis | camelCase | `produtoSelecionado`, `listaItens` |
| Constantes | UPPER_SNAKE_CASE | `MAX_UPLOAD_SIZE`, `API_URL` |
| Arquivos Angular | kebab-case | `produto-lista.component.ts` |
| Pacotes Java | lowercase | `br.com.empresa.modulo` |

#### ProibiÃ§Ãµes Absolutas de Nomenclatura

```
âŒ AbreviaÃ§Ãµes: prod, cat, svc, usr, btn, msg
âŒ Nomes genÃ©ricos: data, info, util, helper, manager, handler
âŒ CÃ³digo comentado no repositÃ³rio
âŒ Catch vazio ou genÃ©rico demais
âŒ VariÃ¡veis com nomes de uma letra (exceto loops: i, j, k)
âŒ Prefixo I para interfaces (IRepository)
âŒ Sufixo Impl desnecessÃ¡rio (RepositoryImpl quando hÃ¡ sÃ³ uma impl)
```

---

### 5. DDD (Domain-Driven Design)

#### Building Blocks ObrigatÃ³rios

| Bloco | DescriÃ§Ã£o | LocalizaÃ§Ã£o |
|-------|-----------|-------------|
| **Entities** | Objetos com identidade Ãºnica e ciclo de vida | `domain/entities/` |
| **Value Objects** | Objetos imutÃ¡veis sem identidade | `domain/valueobjects/` |
| **Aggregates** | Clusters de entidades com raiz | `domain/aggregates/` |
| **Domain Services** | LÃ³gica que nÃ£o pertence a uma entidade | `domain/services/` |
| **Domain Events** | Eventos de domÃ­nio | `domain/events/` |
| **Repositories** | Interfaces de persistÃªncia | `domain/repositories/` ou `application/ports/` |

#### Regras DDD

- âœ… **Entidades Ricas**: ContÃªm comportamento, nÃ£o apenas dados
- âœ… **Value Objects ImutÃ¡veis**: ValidaÃ§Ã£o no construtor, sem setters
- âœ… **Use Cases na Application**: OrquestraÃ§Ã£o, nÃ£o no controller
- âœ… **Ports/Adapters**: Para integraÃ§Ãµes externas
- âŒ **Entidades AnÃªmicas**: Apenas getters/setters (proibido)

```java
// âœ… Entidade Rica
public class Pedido {
    private StatusPedido status;
    
    public void confirmar() {
        if (this.status != StatusPedido.PENDENTE) {
            throw new EstadoInvalidoException("Pedido nÃ£o pode ser confirmado");
        }
        this.status = StatusPedido.CONFIRMADO;
    }
    
    public BigDecimal calcularTotal() {
        return itens.stream()
            .map(ItemPedido::getSubtotal)
            .reduce(BigDecimal.ZERO, BigDecimal::add);
    }
}

// âŒ Entidade AnÃªmica (PROIBIDO)
public class Pedido {
    private StatusPedido status;
    public void setStatus(StatusPedido status) { this.status = status; }
}
```

---

### 6. ACID (PersistÃªncia e TransaÃ§Ãµes)

| Propriedade | DescriÃ§Ã£o | Regra |
|-------------|-----------|-------|
| **A**tomicidade | OperaÃ§Ãµes sÃ£o tudo-ou-nada | MudanÃ§as relacionadas na mesma transaÃ§Ã£o |
| **C**onsistÃªncia | Dados sempre em estado vÃ¡lido | Invariantes e constraints respeitadas |
| **I**solamento | TransaÃ§Ãµes independentes | Escolha consciente do nÃ­vel; evitar suposiÃ§Ãµes |
| **D**urabilidade | Dados persistidos sÃ£o permanentes | Commit + migraÃ§Ãµes versionadas (Liquibase/Flyway) |

#### Regras PrÃ¡ticas ACID

- âœ… Use transaÃ§Ãµes no nÃ­vel do **use case/application service**
- âœ… Evite transaÃ§Ãµes longas (I/O externo dentro de transaÃ§Ã£o)
- âœ… Para integraÃ§Ã£o confiÃ¡vel (mensageria/eventos), avalie padrÃ£o **Outbox**
- âœ… Valide invariantes no domÃ­nio E reforce com constraints no banco
- âœ… Use **Idempotency Keys** para operaÃ§Ãµes que podem ser repetidas
- âœ… Considere **Event Sourcing** para auditoria completa de mudanÃ§as
- âœ… Isole operaÃ§Ãµes de leitura (`@Transactional(readOnly = true)`)
- âŒ NUNCA faÃ§a chamadas HTTP/externas dentro de transaÃ§Ãµes ativas
- âŒ NUNCA misture transaÃ§Ãµes de diferentes agregados sem coordenaÃ§Ã£o

#### PadrÃµes de Confiabilidade

```java
// âœ… Outbox Pattern - Garantia de entrega de eventos
@Entity
@Table(name = "outbox_events")
public class OutboxEvent {
    @Id
    private UUID id;
    private String aggregateType;
    private String aggregateId;
    private String eventType;
    private String payload;
    private LocalDateTime createdAt;
    private boolean processed;
}

// âœ… Idempotency Key - Evitar processamento duplicado
@Service
@RequiredArgsConstructor
public class ProcessarPagamentoUseCase {
    private final IdempotencyKeyRepository idempotencyRepo;
    
    @Transactional
    public ResultadoPagamento executar(String idempotencyKey, PagamentoRequest request) {
        // Verifica se jÃ¡ foi processado
        var existente = idempotencyRepo.findByKey(idempotencyKey);
        if (existente.isPresent()) {
            return existente.get().getResultado();
        }
        
        // Processa e salva com idempotency key
        var resultado = processarPagamento(request);
        idempotencyRepo.save(new IdempotencyRecord(idempotencyKey, resultado));
        return resultado;
    }
}
```

---

### 7. Design Patterns (Usar Quando AplicÃ¡vel)

#### Backend

| Pattern | Quando Usar | Exemplo |
|---------|------------|---------|
| **Factory** | CriaÃ§Ã£o complexa de objetos | `PedidoFactory.criarComItens()` |
| **Strategy** | Algoritmos intercambiÃ¡veis | `ValidadorStrategy`, `CalculoFreteStrategy` |
| **Adapter** | IntegraÃ§Ã£o com sistemas externos | `PagamentoGatewayAdapter` |
| **Facade** | Simplificar subsistemas complexos | `RelatorioFacade` |
| **Repository** | AbstraÃ§Ã£o de persistÃªncia | `PedidoRepository` (interface no domain) |
| **Specification** | Regras de negÃ³cio combinÃ¡veis | `PedidoAtivoSpecification` |
| **Builder** | ConstruÃ§Ã£o de objetos com muitos parÃ¢metros | `Pedido.builder().comCliente()...` |
| **Decorator** | Adicionar comportamento dinamicamente | `LoggingServiceDecorator` |
| **Template Method** | Algoritmo com passos customizÃ¡veis | `AbstractExportador` |
| **Observer** | NotificaÃ§Ã£o de eventos de domÃ­nio | `DomainEventPublisher` |
| **Chain of Responsibility** | Pipeline de validaÃ§Ãµes | `ValidadorChain` |

#### Frontend

| Pattern | Quando Usar | Exemplo |
|---------|------------|---------|
| **Facade** | Simplificar APIs complexas | `AuthFacade` |
| **Adapter** | Transformar dados do backend | `ProdutoAdapter` |
| **Container/Presentational** | Separar lÃ³gica de apresentaÃ§Ã£o | Smart/Dumb Components |
| **Composition (Composables)** | Reutilizar lÃ³gica entre componentes | `use-paginacao.ts` |
| **Observer** | ComunicaÃ§Ã£o reativa (Signals/RxJS) | `signal()`, `effect()` |
| **State Machine** | Estados complexos de UI | `useStateMachine()` |
| **Mediator** | ComunicaÃ§Ã£o entre componentes desacoplados | `EventBusService` |

#### Exemplos de Patterns

```java
// âœ… Strategy Pattern - Algoritmos intercambiÃ¡veis
public interface CalculoFreteStrategy {
    BigDecimal calcular(Pedido pedido);
}

@Component
public class FreteCorreiosStrategy implements CalculoFreteStrategy {
    public BigDecimal calcular(Pedido pedido) { /* implementaÃ§Ã£o */ }
}

@Component  
public class FreteTransportadoraStrategy implements CalculoFreteStrategy {
    public BigDecimal calcular(Pedido pedido) { /* implementaÃ§Ã£o */ }
}

// âœ… Specification Pattern - Regras combinÃ¡veis
public interface Specification<T> {
    boolean isSatisfiedBy(T entity);
    Specification<T> and(Specification<T> other);
    Specification<T> or(Specification<T> other);
}

public class PedidoAtivoSpecification implements Specification<Pedido> {
    public boolean isSatisfiedBy(Pedido pedido) {
        return pedido.getStatus() == StatusPedido.ATIVO;
    }
}

// âœ… Decorator Pattern
public class LoggingPedidoService implements PedidoServicePort {
    private final PedidoServicePort delegate;
    private final Logger logger;
    
    public Pedido criar(CriarPedidoRequest request) {
        logger.info("Criando pedido: {}", request);
        var pedido = delegate.criar(request);
        logger.info("Pedido criado: {}", pedido.getId());
        return pedido;
    }
}
```

```typescript
// âœ… Composable Pattern (Angular)
// composables/use-paginacao.ts
export function usePaginacao<T>(
  fetchFn: (page: number) => Observable<ResultadoPaginado<T>>
) {
  const dados = signal<T[]>([]);
  const paginaAtual = signal(1);
  const total = signal(0);
  const carregando = signal(false);

  const carregar = (page: number) => {
    carregando.set(true);
    fetchFn(page).subscribe({
      next: (resultado) => {
        dados.set(resultado.dados);
        total.set(resultado.total);
        paginaAtual.set(page);
        carregando.set(false);
      },
      error: () => carregando.set(false)
    });
  };

  return { dados, paginaAtual, total, carregando, carregar };
}

// Uso no componente
const paginacao = usePaginacao((page) => this.produtoService.listar(page));
```

---

## ğŸ—ï¸ ARQUITETURA UNIFICADA

### Backend (DDD + Clean Architecture)

```
src/main/java/br/com/empresa/{modulo}/
â”œâ”€â”€ domain/                     # NÃšCLEO - Regras de negÃ³cio puras
â”‚   â”œâ”€â”€ entities/               # Entidades com comportamento
â”‚   â”œâ”€â”€ valueobjects/           # Objetos de valor imutÃ¡veis
â”‚   â”œâ”€â”€ services/               # ServiÃ§os de domÃ­nio
â”‚   â”œâ”€â”€ repositories/           # Interfaces de repositÃ³rio
â”‚   â”œâ”€â”€ events/                 # Eventos de domÃ­nio
â”‚   â””â”€â”€ exceptions/             # ExceÃ§Ãµes de domÃ­nio
â”‚
â”œâ”€â”€ application/                # CASOS DE USO - OrquestraÃ§Ã£o
â”‚   â”œâ”€â”€ usecases/               # Casos de uso especÃ­ficos
â”‚   â”œâ”€â”€ dtos/                   # Data Transfer Objects
â”‚   â”œâ”€â”€ ports/                  # Interfaces (in/out)
â”‚   â”‚   â”œâ”€â”€ in/                 # Portas de entrada
â”‚   â”‚   â””â”€â”€ out/                # Portas de saÃ­da
â”‚   â””â”€â”€ services/               # ServiÃ§os de aplicaÃ§Ã£o
â”‚
â”œâ”€â”€ infrastructure/             # ADAPTADORES - ImplementaÃ§Ãµes tÃ©cnicas
â”‚   â”œâ”€â”€ persistence/            # JPA entities, repositories
â”‚   â”‚   â”œâ”€â”€ entities/           # Entidades JPA
â”‚   â”‚   â”œâ”€â”€ repositories/       # ImplementaÃ§Ãµes JPA
â”‚   â”‚   â””â”€â”€ mappers/            # Mappers Domain â†” Entity
â”‚   â”œâ”€â”€ web/                    # Controllers, handlers
â”‚   â”‚   â”œâ”€â”€ controllers/        # REST Controllers
â”‚   â”‚   â””â”€â”€ handlers/           # Exception handlers
â”‚   â”œâ”€â”€ external/               # Clientes externos (Feign, REST)
â”‚   â”œâ”€â”€ messaging/              # JMS, Kafka, RabbitMQ
â”‚   â””â”€â”€ config/                 # ConfiguraÃ§Ãµes Spring
â”‚
â””â”€â”€ interfaces/                 # INTERFACE - Contratos de API (opcional)
    â””â”€â”€ rest/
        â””â”€â”€ v1/                 # Versionamento de API
            â””â”€â”€ *API.java       # Interfaces OpenAPI
```

### Frontend (Clean Architecture Adaptada)

```
src/app/
â”œâ”€â”€ core/                       # Singleton services, guards, interceptors
â”‚   â”œâ”€â”€ guards/
â”‚   â”œâ”€â”€ interceptors/
â”‚   â””â”€â”€ services/
â”‚
â”œâ”€â”€ shared/                     # MÃ³dulo compartilhado
â”‚   â”œâ”€â”€ components/             # Componentes reutilizÃ¡veis (Dumb)
â”‚   â”œâ”€â”€ directives/
â”‚   â”œâ”€â”€ pipes/
â”‚   â”œâ”€â”€ models/                 # Interfaces compartilhadas
â”‚   â””â”€â”€ utils/                  # UtilitÃ¡rios puros
â”‚
â”œâ”€â”€ features/                   # MÃ³dulos de feature (por domÃ­nio)
â”‚   â””â”€â”€ {feature}/
â”‚       â”œâ”€â”€ pages/              # Smart Components (containers)
â”‚       â”œâ”€â”€ components/         # Componentes da feature
â”‚       â”œâ”€â”€ services/           # ServiÃ§os HTTP
â”‚       â”œâ”€â”€ models/             # Interfaces/Types da feature
â”‚       â”œâ”€â”€ composables/        # LÃ³gica reutilizÃ¡vel (use-*.ts)
â”‚       â””â”€â”€ {feature}.routes.ts # Rotas da feature
â”‚
â”œâ”€â”€ app.component.ts
â”œâ”€â”€ app.config.ts
â””â”€â”€ app.routes.ts
```

---

## âœ… CHECKLIST UNIVERSAL

### Antes de Iniciar uma Feature

- [ ] Li e entendi a arquitetura do mÃ³dulo
- [ ] Verifiquei se existe cÃ³digo similar que pode ser reutilizado
- [ ] Defini as camadas onde o cÃ³digo serÃ¡ criado
- [ ] Planejei a divisÃ£o de responsabilidades (SOLID)
- [ ] Identifiquei entidades, value objects e use cases necessÃ¡rios

### Antes de Commitar

#### Arquitetura

- [ ] Clean Architecture respeitada (dependÃªncias corretas)
- [ ] Domain sem dependÃªncias de frameworks
- [ ] Responsabilidade Ãºnica por classe/componente (S de SOLID)
- [ ] Interfaces segregadas corretamente (I de SOLID)
- [ ] DependÃªncias invertidas (D de SOLID)

#### Qualidade de CÃ³digo

- [ ] Arquivos com menos de 300 linhas
- [ ] FunÃ§Ãµes/mÃ©todos com menos de 20 linhas
- [ ] Nomes descritivos e autoexplicativos
- [ ] Sem cÃ³digo duplicado (DRY)
- [ ] Sem magic numbers/strings (usar constantes)
- [ ] Sem cÃ³digo comentado

#### Frontend (Angular 20+ Zoneless)

- [ ] Usando `inject()`, nÃ£o constructor injection
- [ ] Usando `signal()`, `computed()`, `input()`, `output()`
- [ ] Usando `@if`, `@for`, `@switch`, `@defer` nos templates
- [ ] Standalone components apenas
- [ ] ChangeDetection.OnPush habilitado (obrigatÃ³rio para Zoneless)
- [ ] `provideExperimentalZonelessChangeDetection()` configurado (quando zoneless)
- [ ] `provideHttpClient(withInterceptors([...]))` para HTTP
- [ ] Sem `zone.js` no polyfills (modo zoneless)
- [ ] `effect()` para side effects reativos
- [ ] Signals para gerenciamento de estado local

#### Backend (Java 21+ / Spring Boot 3.4+)

- [ ] Usando `@RequiredArgsConstructor` (Lombok)
- [ ] Usando mappers/factories via DI (JacksonConfig / MapStruct), sem singleton manual
- [ ] Entidades ricas (com comportamento)
- [ ] Value Objects como **Java Records** (imutÃ¡veis por padrÃ£o)
- [ ] ExceÃ§Ãµes especÃ­ficas e tratadas
- [ ] Optional ao invÃ©s de null
- [ ] Pattern Matching (`instanceof`, `switch expressions`)
- [ ] Sealed classes para hierarquias fechadas
- [ ] Virtual Threads para I/O blocking (Spring Boot 3.2+)
- [ ] `@Transactional(readOnly = true)` para queries

#### Testes

- [ ] Testes unitÃ¡rios para lÃ³gica de negÃ³cio
- [ ] Testes de casos de erro
- [ ] PadrÃ£o AAA (Arrange, Act, Assert)
- [ ] Mocks para dependÃªncias externas

---

## ğŸš« ANTI-PATTERNS UNIVERSAIS (PROIBIDOS)

### CÃ³digo

1. âŒ **God Classes** - Classes fazendo muitas coisas
2. âŒ **Entidades AnÃªmicas** - Apenas getters/setters, sem comportamento
3. âŒ **CÃ³digo Duplicado** - Violar DRY
4. âŒ **Nomes GenÃ©ricos** - `data`, `info`, `util`, `helper`
5. âŒ **AbreviaÃ§Ãµes** - `prod`, `cat`, `svc`, `usr`
6. âŒ **Magic Numbers/Strings** - Valores hardcoded sem constantes
7. âŒ **Catch Vazio** - Engolir exceÃ§Ãµes
8. âŒ **Retornar null** - Usar Optional

### Arquitetura

9. âŒ **DependÃªncias Invertidas** - Domain dependendo de Infrastructure
10. âŒ **LÃ³gica no Controller** - Regras de negÃ³cio na camada web
11. âŒ **Framework no Domain** - JPA, Spring annotations no domÃ­nio
12. âŒ **Use Cases Gigantes** - Casos de uso fazendo muitas coisas
13. âŒ **Singleton Manual** - `getInstance()`, static cache

### Frontend EspecÃ­fico

14. âŒ **Sintaxe Antiga** - `*ngIf`, `*ngFor`, `@Input()`, `@Output()`
15. âŒ **Constructor Injection** - Ao invÃ©s de `inject()`
16. âŒ **BehaviorSubject para Estado** - Ao invÃ©s de Signals
17. âŒ **NgModules** - Ao invÃ©s de Standalone Components
18. âŒ **Zone.js em modo Zoneless** - Remover do polyfills
19. âŒ **HttpClientModule** - Usar `provideHttpClient()` standalone
20. âŒ **Subscribe manual sem cleanup** - Sempre usar `takeUntilDestroyed()` ou `async` pipe

### Backend EspecÃ­fico

21. âŒ **Construtor Manual** - Ao invÃ©s de `@RequiredArgsConstructor`
22. âŒ **new ObjectMapper()** - Ao invÃ©s de injeÃ§Ã£o via JacksonConfig
23. âŒ **SQL no Controller** - Queries diretamente na camada web
24. âŒ **Mappers manuais repetidos** - Use MapStruct
25. âŒ **Classes para Value Objects** - Use Java Records
26. âŒ **null returns** - Use Optional
27. âŒ **Checked exceptions em domain** - Use RuntimeException especÃ­ficas
28. âŒ **Thread.sleep()** - Use Virtual Threads ou scheduling
29. âŒ **Chamadas externas em transaÃ§Ã£o** - Extraia para fora da @Transactional

---

## ï¿½ SEGURANÃ‡A (OWASP TOP 10 - 2024)

> **SeguranÃ§a Ã© responsabilidade de TODOS. Nunca assuma que estÃ¡ seguro.**
> Consulte `.cursorrules-backend` e `.cursorrules-frontend` para regras especÃ­ficas.

### PrincÃ­pios Fundamentais

| PrincÃ­pio | DescriÃ§Ã£o | AplicaÃ§Ã£o |
|-----------|-----------|----------|
| **Defense in Depth** | MÃºltiplas camadas de proteÃ§Ã£o | ValidaÃ§Ã£o em todas as camadas |
| **Least Privilege** | MÃ­nimo de permissÃµes necessÃ¡rias | Roles especÃ­ficos, nÃ£o admin para tudo |
| **Fail Secure** | Falhas devem ser seguras | Negar acesso em caso de erro |
| **Zero Trust** | Nunca confie, sempre verifique | Validar TODAS as requisiÃ§Ãµes |
| **Secure by Default** | SeguranÃ§a como padrÃ£o | ConfiguraÃ§Ãµes restritivas por padrÃ£o |

### OWASP Top 10 - 2024 (Checklist)

| # | Vulnerabilidade | MitigaÃ§Ã£o Backend | MitigaÃ§Ã£o Frontend |
|---|-----------------|-------------------|--------------------|
| **A01** | Broken Access Control | RBAC, @PreAuthorize, Method Security | Guards, Route Protection |
| **A02** | Cryptographic Failures | TLS 1.3, bcrypt, AES-256, secrets em vault | HTTPS only, no sensitive data in storage |
| **A03** | Injection | Prepared Statements, Bean Validation | SanitizaÃ§Ã£o, DomSanitizer |
| **A04** | Insecure Design | Threat Modeling, Security Reviews | Secure defaults, CSP |
| **A05** | Security Misconfiguration | Hardening, disable debug, CORS restrito | Strict CSP, no source maps em prod |
| **A06** | Vulnerable Components | Dependabot, OWASP Dependency Check | npm audit, renovate |
| **A07** | Auth Failures | OAuth2/OIDC, MFA, session management | Secure token storage, auto-logout |
| **A08** | Data Integrity | HMAC, assinaturas digitais, checksums | VerificaÃ§Ã£o de integridade |
| **A09** | Logging Failures | Audit logs, SIEM, nÃ£o logar PII | Error boundaries, sanitize logs |
| **A10** | SSRF | Whitelist URLs, validar destinos | N/A (backend) |

### Regras de SeguranÃ§a Universais

#### AutenticaÃ§Ã£o e AutorizaÃ§Ã£o

```java
// âœ… BACKEND - Spring Security 6.x com OAuth2/OIDC
@Configuration
@EnableMethodSecurity(prePostEnabled = true)
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        return http
            .csrf(csrf -> csrf.csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse()))
            .cors(cors -> cors.configurationSource(corsConfigurationSource()))
            .sessionManagement(session -> session.sessionCreationPolicy(STATELESS))
            .oauth2ResourceServer(oauth2 -> oauth2.jwt(Customizer.withDefaults()))
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/actuator/health").permitAll()
                .requestMatchers("/api/public/**").permitAll()
                .anyRequest().authenticated()
            )
            .build();
    }
}

// âœ… Method Security - SEMPRE validar autorizaÃ§Ã£o
@PreAuthorize("hasRole('ADMIN') or @authService.isOwner(#id, authentication)")
public void deletar(UUID id) { ... }
```

```typescript
// âœ… FRONTEND - Auth Guard funcional (Angular 20+)
export const authGuard: CanActivateFn = (route, state) => {
  const authService = inject(AuthService);
  const router = inject(Router);
  
  if (authService.isAuthenticated()) {
    return true;
  }
  
  return router.createUrlTree(['/login'], {
    queryParams: { returnUrl: state.url }
  });
};
```

#### Input Validation (Nunca Confie em Input Externo)

```java
// âœ… BACKEND - Bean Validation + Custom Validators
public record CriarUsuarioRequest(
    @NotBlank @Size(min = 3, max = 100) String nome,
    @NotBlank @Email String email,
    @NotBlank @ValidSenha String senha,  // Custom validator
    @NotNull @ValidCpf String cpf        // Custom validator
) {}
```

#### HTTP Security Headers

```yaml
# âœ… BACKEND - Headers obrigatÃ³rios (application.yml)
server:
  servlet:
    session:
      cookie:
        secure: true
        http-only: true
        same-site: strict

# âœ… Via Spring Security ou filtro
# Content-Security-Policy: default-src 'self'; script-src 'self'
# X-Content-Type-Options: nosniff
# X-Frame-Options: DENY
# Strict-Transport-Security: max-age=31536000; includeSubDomains
# Referrer-Policy: strict-origin-when-cross-origin
# Permissions-Policy: geolocation=(), microphone=()
```

### Checklist de SeguranÃ§a (ObrigatÃ³rio)

- [ ] **HTTPS** obrigatÃ³rio em produÃ§Ã£o (TLS 1.3)
- [ ] **CORS** configurado com whitelist de origens
- [ ] **CSRF** proteÃ§Ã£o habilitada para formulÃ¡rios
- [ ] **Rate Limiting** configurado para prevenir DDoS
- [ ] **Secrets** em variÃ¡veis de ambiente ou vault (nunca no cÃ³digo)
- [ ] **Logs** nÃ£o contÃªm dados sensÃ­veis (PII, senhas, tokens)
- [ ] **DependÃªncias** verificadas com Dependabot/Snyk
- [ ] **Input Validation** em TODAS as camadas
- [ ] **Output Encoding** para prevenir XSS
- [ ] **SQL Injection** prevenido (prepared statements, JPA)

> ğŸ“š Consulte seÃ§Ãµes especÃ­ficas em `.cursorrules-backend` e `.cursorrules-frontend`

---

## ï¿½ğŸ“š REFERÃŠNCIA RÃPIDA

### Criar Novo Componente Angular (Zoneless)

```typescript
@Component({
  selector: 'app-exemplo',
  standalone: true,
  imports: [CommonModule],
  templateUrl: './exemplo.component.html',
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class ExemploComponent {
  // 1. InjeÃ§Ãµes
  private readonly service = inject(ExemploService);
  private readonly destroyRef = inject(DestroyRef);
  
  // 2. Inputs/Outputs (Signal-based)
  readonly item = input.required<Item>();
  readonly destaque = input(false);
  readonly onSalvar = output<Item>();
  
  // 3. State (Signals)
  readonly carregando = signal(false);
  readonly erro = signal<string | null>(null);
  
  // 4. Computeds
  readonly itemValido = computed(() => this.validar(this.item()));
  
  // 5. Effects (side effects reativos)
  constructor() {
    effect(() => {
      console.log('Item mudou:', this.item());
    });
  }
  
  // 6. Methods
  salvar(): void {
    this.onSalvar.emit(this.item());
  }
  
  private validar(item: Item): boolean {
    return item.nome.length > 0;
  }
}
```

### Template com Control Flow Moderno

```html
@if (carregando()) {
  <app-loading />
} @else if (erro()) {
  <app-error [message]="erro()" />
} @else {
  @for (item of itens(); track item.id) {
    <app-item-card 
      [item]="item"
      [destaque]="item.destaque"
      (selecionar)="onSelecionar($event)"
    />
  } @empty {
    <p>Nenhum item encontrado</p>
  }
}

@defer (on viewport) {
  <app-grafico [dados]="dados()" />
} @placeholder {
  <div class="skeleton"></div>
}
```

### Criar Novo Use Case Java

```java
@Service
@RequiredArgsConstructor
@Slf4j
public class CriarExemploUseCase {
    
    private final ExemploRepositoryPort repository;
    private final ValidadorService validador;
    private final ExemploMapper mapper;
    private final ApplicationEventPublisher eventPublisher;
    
    @Transactional
    public ExemploResponse executar(CriarExemploRequest request) {
        log.info("Criando exemplo: {}", request);
        
        // 1. Validar
        validador.validar(request);
        
        // 2. Criar entidade rica
        var exemplo = Exemplo.criar(
            request.nome(),
            new Email(request.email())
        );
        
        // 3. Persistir
        var salvo = repository.salvar(exemplo);
        
        // 4. Publicar evento
        eventPublisher.publishEvent(new ExemploCriadoEvent(salvo.getId()));
        
        // 5. Mapear e retornar
        return mapper.toResponse(salvo);
    }
}
```

### Java Record (Value Object)

```java
public record Email(String valor) {
    public Email {
        Objects.requireNonNull(valor, "Email Ã© obrigatÃ³rio");
        if (!valor.contains("@")) {
            throw new IllegalArgumentException("Email invÃ¡lido: " + valor);
        }
    }
}

public record Dinheiro(BigDecimal valor, String moeda) {
    public static final Dinheiro ZERO = new Dinheiro(BigDecimal.ZERO, "BRL");
    
    public Dinheiro {
        Objects.requireNonNull(valor);
        Objects.requireNonNull(moeda);
        if (valor.compareTo(BigDecimal.ZERO) < 0) {
            throw new IllegalArgumentException("Valor nÃ£o pode ser negativo");
        }
    }
    
    public Dinheiro somar(Dinheiro outro) {
        if (!this.moeda.equals(outro.moeda)) {
            throw new IllegalArgumentException("Moedas diferentes");
        }
        return new Dinheiro(this.valor.add(outro.valor), this.moeda);
    }
}
```

### MapStruct Mapper

```java
@Mapper(componentModel = "spring", unmappedTargetPolicy = ReportingPolicy.ERROR)
public interface ExemploMapper {
    
    @Mapping(target = "id", ignore = true)
    @Mapping(target = "dataCriacao", expression = "java(java.time.LocalDateTime.now())")
    Exemplo toDomain(CriarExemploRequest request);
    
    @Mapping(target = "emailFormatado", source = "email.valor")
    ExemploResponse toResponse(Exemplo exemplo);
    
    List<ExemploResponse> toResponseList(List<Exemplo> exemplos);
}
```

---

## ğŸ”— DOCUMENTAÃ‡ÃƒO DETALHADA

| Documento | ConteÃºdo |
|-----------|----------|
| `.cursorrules-frontend` | Angular 20+ Zoneless, Signals, Composables, SSR |
| `.cursorrules-backend` | Java 21/25 LTS, Spring Boot 3.4/3.5, Records, DDD, Clean Architecture |

---

**ğŸš¨ ESTAS DIRETRIZES SÃƒO INEGOCIÃVEIS**

Sempre siga todas as regras antes de implementar qualquer funcionalidade.
Em caso de dÃºvida, consulte os arquivos especÃ­ficos de frontend ou backend.
