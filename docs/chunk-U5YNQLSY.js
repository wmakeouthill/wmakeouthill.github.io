import{a as Lt,b as Kt,g as It,h as Qt,i as Te,j as Ce,k as Ki,l as Ht,m as D}from"./chunk-A3ZZXC42.js";var xn={9306:((o,e,t)=>{var s=t(4901),i=t(6823),n=TypeError;o.exports=function(r){if(s(r))return r;throw new n(i(r)+" is not a function")}}),3506:((o,e,t)=>{var s=t(3925),i=String,n=TypeError;o.exports=function(r){if(s(r))return r;throw new n("Can't set "+i(r)+" as a prototype")}}),7080:((o,e,t)=>{var s=t(4402).has;o.exports=function(i){return s(i),i}}),679:((o,e,t)=>{var s=t(1625),i=TypeError;o.exports=function(n,r){if(s(r,n))return n;throw new i("Incorrect invocation")}}),8551:((o,e,t)=>{var s=t(34),i=String,n=TypeError;o.exports=function(r){if(s(r))return r;throw new n(i(r)+" is not an object")}}),7811:(o=>{o.exports=typeof ArrayBuffer<"u"&&typeof DataView<"u"}),7394:((o,e,t)=>{var s=t(4576),i=t(6706),n=t(2195),r=s.ArrayBuffer,a=s.TypeError;o.exports=r&&i(r.prototype,"byteLength","get")||function(l){if(n(l)!=="ArrayBuffer")throw new a("ArrayBuffer expected");return l.byteLength}}),3238:((o,e,t)=>{var s=t(4576),i=t(7476),n=t(7394),r=s.ArrayBuffer,a=r&&r.prototype,l=a&&i(a.slice);o.exports=function(h){if(n(h)!==0||!l)return!1;try{return l(h,0,0),!1}catch{return!0}}}),5169:((o,e,t)=>{var s=t(3238),i=TypeError;o.exports=function(n){if(s(n))throw new i("ArrayBuffer is detached");return n}}),5636:((o,e,t)=>{var s=t(4576),i=t(9504),n=t(6706),r=t(7696),a=t(5169),l=t(7394),h=t(4483),c=t(1548),d=s.structuredClone,u=s.ArrayBuffer,f=s.DataView,p=Math.min,g=u.prototype,m=f.prototype,v=i(g.slice),b=n(g,"resizable","get"),A=n(g,"maxByteLength","get"),w=i(m.getInt8),y=i(m.setInt8);o.exports=(c||h)&&function(x,E,C){var S=l(x),M=E===void 0?S:r(E),L=!b||!b(x),G;if(a(x),c&&(x=d(x,{transfer:[x]}),S===M&&(C||L)))return x;if(S>=M&&(!C||L))G=v(x,0,M);else{var H=C&&!L&&A?{maxByteLength:A(x)}:void 0;G=new u(M,H);for(var U=new f(x),q=new f(G),P=p(M,S),R=0;R<P;R++)y(q,R,w(U,R))}return c||h(x),G}}),4644:((o,e,t)=>{var s=t(7811),i=t(3724),n=t(4576),r=t(4901),a=t(34),l=t(9297),h=t(6955),c=t(6823),d=t(6699),u=t(6840),f=t(2106),p=t(1625),g=t(2787),m=t(2967),v=t(8227),b=t(3392),A=t(1181),w=A.enforce,y=A.get,x=n.Int8Array,E=x&&x.prototype,C=n.Uint8ClampedArray,S=C&&C.prototype,M=x&&g(x),L=E&&g(E),G=Object.prototype,H=n.TypeError,U=v("toStringTag"),q=b("TYPED_ARRAY_TAG"),P="TypedArrayConstructor",R=s&&!!m&&h(n.opera)!=="Opera",X=!1,Y,st,nt,K={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Q={BigInt64Array:8,BigUint64Array:8},Tt=function(rt){if(!a(rt))return!1;var at=h(rt);return at==="DataView"||l(K,at)||l(Q,at)},Ct=function(N){var rt=g(N);if(a(rt)){var at=y(rt);return at&&l(at,P)?at[P]:Ct(rt)}},_=function(N){if(!a(N))return!1;var rt=h(N);return l(K,rt)||l(Q,rt)},T=function(N){if(_(N))return N;throw new H("Target is not a typed array")},I=function(N){if(r(N)&&(!m||p(M,N)))return N;throw new H(c(N)+" is not a typed array constructor")},$=function(N,rt,at,Rt){if(i){if(at)for(var mt in K){var dt=n[mt];if(dt&&l(dt.prototype,N))try{delete dt.prototype[N]}catch{try{dt.prototype[N]=rt}catch{}}}(!L[N]||at)&&u(L,N,at?rt:R&&E[N]||rt,Rt)}},J=function(N,rt,at){var Rt,mt;if(i){if(m){if(at){for(Rt in K)if(mt=n[Rt],mt&&l(mt,N))try{delete mt[N]}catch{}}if(!M[N]||at)try{return u(M,N,at?rt:R&&M[N]||rt)}catch{}else return}for(Rt in K)mt=n[Rt],mt&&(!mt[N]||at)&&u(mt,N,rt)}};for(Y in K)st=n[Y],nt=st&&st.prototype,nt?w(nt)[P]=st:R=!1;for(Y in Q)st=n[Y],nt=st&&st.prototype,nt&&(w(nt)[P]=st);if((!R||!r(M)||M===Function.prototype)&&(M=function(){throw new H("Incorrect invocation")},R))for(Y in K)n[Y]&&m(n[Y],M);if((!R||!L||L===G)&&(L=M.prototype,R))for(Y in K)n[Y]&&m(n[Y].prototype,L);if(R&&g(S)!==L&&m(S,L),i&&!l(L,U)){X=!0,f(L,U,{configurable:!0,get:function(){return a(this)?this[q]:void 0}});for(Y in K)n[Y]&&d(n[Y],q,Y)}o.exports={NATIVE_ARRAY_BUFFER_VIEWS:R,TYPED_ARRAY_TAG:X&&q,aTypedArray:T,aTypedArrayConstructor:I,exportTypedArrayMethod:$,exportTypedArrayStaticMethod:J,getTypedArrayConstructor:Ct,isView:Tt,isTypedArray:_,TypedArray:M,TypedArrayPrototype:L}}),5370:((o,e,t)=>{var s=t(6198);o.exports=function(i,n,r){for(var a=0,l=arguments.length>2?r:s(n),h=new i(l);l>a;)h[a]=n[a++];return h}}),9617:((o,e,t)=>{var s=t(5397),i=t(5610),n=t(6198),r=function(a){return function(l,h,c){var d=s(l),u=n(d);if(u===0)return!a&&-1;var f=i(c,u),p;if(a&&h!==h){for(;u>f;)if(p=d[f++],p!==p)return!0}else for(;u>f;f++)if((a||f in d)&&d[f]===h)return a||f||0;return!a&&-1}};o.exports={includes:r(!0),indexOf:r(!1)}}),4527:((o,e,t)=>{var s=t(3724),i=t(4376),n=TypeError,r=Object.getOwnPropertyDescriptor,a=s&&!(function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(l){return l instanceof TypeError}})();o.exports=a?function(l,h){if(i(l)&&!r(l,"length").writable)throw new n("Cannot set read only .length");return l.length=h}:function(l,h){return l.length=h}}),7680:((o,e,t)=>{var s=t(9504);o.exports=s([].slice)}),7628:((o,e,t)=>{var s=t(6198);o.exports=function(i,n){for(var r=s(i),a=new n(r),l=0;l<r;l++)a[l]=i[r-l-1];return a}}),9928:((o,e,t)=>{var s=t(6198),i=t(1291),n=RangeError;o.exports=function(r,a,l,h){var c=s(r),d=i(l),u=d<0?c+d:d;if(u>=c||u<0)throw new n("Incorrect index");for(var f=new a(c),p=0;p<c;p++)f[p]=p===u?h:r[p];return f}}),6319:((o,e,t)=>{var s=t(8551),i=t(9539);o.exports=function(n,r,a,l){try{return l?r(s(a)[0],a[1]):r(a)}catch(h){i(n,"throw",h)}}}),2195:((o,e,t)=>{var s=t(9504),i=s({}.toString),n=s("".slice);o.exports=function(r){return n(i(r),8,-1)}}),6955:((o,e,t)=>{var s=t(2140),i=t(4901),n=t(2195),r=t(8227),a=r("toStringTag"),l=Object,h=n((function(){return arguments})())==="Arguments",c=function(d,u){try{return d[u]}catch{}};o.exports=s?n:function(d){var u,f,p;return d===void 0?"Undefined":d===null?"Null":typeof(f=c(u=l(d),a))=="string"?f:h?n(u):(p=n(u))==="Object"&&i(u.callee)?"Arguments":p}}),7740:((o,e,t)=>{var s=t(9297),i=t(5031),n=t(7347),r=t(4913);o.exports=function(a,l,h){for(var c=i(l),d=r.f,u=n.f,f=0;f<c.length;f++){var p=c[f];!s(a,p)&&!(h&&s(h,p))&&d(a,p,u(l,p))}}}),2211:((o,e,t)=>{var s=t(9039);o.exports=!s(function(){function i(){}return i.prototype.constructor=null,Object.getPrototypeOf(new i)!==i.prototype})}),2529:(o=>{o.exports=function(e,t){return{value:e,done:t}}}),6699:((o,e,t)=>{var s=t(3724),i=t(4913),n=t(6980);o.exports=s?function(r,a,l){return i.f(r,a,n(1,l))}:function(r,a,l){return r[a]=l,r}}),6980:(o=>{o.exports=function(e,t){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:t}}}),4659:((o,e,t)=>{var s=t(3724),i=t(4913),n=t(6980);o.exports=function(r,a,l){s?i.f(r,a,n(0,l)):r[a]=l}}),2106:((o,e,t)=>{var s=t(283),i=t(4913);o.exports=function(n,r,a){return a.get&&s(a.get,r,{getter:!0}),a.set&&s(a.set,r,{setter:!0}),i.f(n,r,a)}}),6840:((o,e,t)=>{var s=t(4901),i=t(4913),n=t(283),r=t(9433);o.exports=function(a,l,h,c){c||(c={});var d=c.enumerable,u=c.name!==void 0?c.name:l;if(s(h)&&n(h,u,c),c.global)d?a[l]=h:r(l,h);else{try{c.unsafe?a[l]&&(d=!0):delete a[l]}catch{}d?a[l]=h:i.f(a,l,{value:h,enumerable:!1,configurable:!c.nonConfigurable,writable:!c.nonWritable})}return a}}),6279:((o,e,t)=>{var s=t(6840);o.exports=function(i,n,r){for(var a in n)s(i,a,n[a],r);return i}}),9433:((o,e,t)=>{var s=t(4576),i=Object.defineProperty;o.exports=function(n,r){try{i(s,n,{value:r,configurable:!0,writable:!0})}catch{s[n]=r}return r}}),3724:((o,e,t)=>{var s=t(9039);o.exports=!s(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})}),4483:((o,e,t)=>{var s=t(4576),i=t(9429),n=t(1548),r=s.structuredClone,a=s.ArrayBuffer,l=s.MessageChannel,h=!1,c,d,u,f;if(n)h=function(p){r(p,{transfer:[p]})};else if(a)try{l||(c=i("worker_threads"),c&&(l=c.MessageChannel)),l&&(d=new l,u=new a(2),f=function(p){d.port1.postMessage(null,[p])},u.byteLength===2&&(f(u),u.byteLength===0&&(h=f)))}catch{}o.exports=h}),4055:((o,e,t)=>{var s=t(4576),i=t(34),n=s.document,r=i(n)&&i(n.createElement);o.exports=function(a){return r?n.createElement(a):{}}}),6837:(o=>{var e=TypeError,t=9007199254740991;o.exports=function(s){if(s>t)throw e("Maximum allowed index exceeded");return s}}),5002:(o=>{o.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}}),8727:(o=>{o.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]}),6193:((o,e,t)=>{var s=t(4215);o.exports=s==="NODE"}),2839:((o,e,t)=>{var s=t(4576),i=s.navigator,n=i&&i.userAgent;o.exports=n?String(n):""}),9519:((o,e,t)=>{var s=t(4576),i=t(2839),n=s.process,r=s.Deno,a=n&&n.versions||r&&r.version,l=a&&a.v8,h,c;l&&(h=l.split("."),c=h[0]>0&&h[0]<4?1:+(h[0]+h[1])),!c&&i&&(h=i.match(/Edge\/(\d+)/),(!h||h[1]>=74)&&(h=i.match(/Chrome\/(\d+)/),h&&(c=+h[1]))),o.exports=c}),4215:((o,e,t)=>{var s=t(4576),i=t(2839),n=t(2195),r=function(a){return i.slice(0,a.length)===a};o.exports=(function(){return r("Bun/")?"BUN":r("Cloudflare-Workers")?"CLOUDFLARE":r("Deno/")?"DENO":r("Node.js/")?"NODE":s.Bun&&typeof Bun.version=="string"?"BUN":s.Deno&&typeof Deno.version=="object"?"DENO":n(s.process)==="process"?"NODE":s.window&&s.document?"BROWSER":"REST"})()}),8574:((o,e,t)=>{var s=t(9504),i=Error,n=s("".replace),r=(function(h){return String(new i(h).stack)})("zxcasd"),a=/\n\s*at [^:]*:[^\n]*/,l=a.test(r);o.exports=function(h,c){if(l&&typeof h=="string"&&!i.prepareStackTrace)for(;c--;)h=n(h,a,"");return h}}),6518:((o,e,t)=>{var s=t(4576),i=t(7347).f,n=t(6699),r=t(6840),a=t(9433),l=t(7740),h=t(2796);o.exports=function(c,d){var u=c.target,f=c.global,p=c.stat,g,m,v,b,A,w;if(f?m=s:p?m=s[u]||a(u,{}):m=s[u]&&s[u].prototype,m)for(v in d){if(A=d[v],c.dontCallGetSet?(w=i(m,v),b=w&&w.value):b=m[v],g=h(f?v:u+(p?".":"#")+v,c.forced),!g&&b!==void 0){if(typeof A==typeof b)continue;l(A,b)}(c.sham||b&&b.sham)&&n(A,"sham",!0),r(m,v,A,c)}}}),9039:(o=>{o.exports=function(e){try{return!!e()}catch{return!0}}}),8745:((o,e,t)=>{var s=t(616),i=Function.prototype,n=i.apply,r=i.call;o.exports=typeof Reflect=="object"&&Reflect.apply||(s?r.bind(n):function(){return r.apply(n,arguments)})}),6080:((o,e,t)=>{var s=t(7476),i=t(9306),n=t(616),r=s(s.bind);o.exports=function(a,l){return i(a),l===void 0?a:n?r(a,l):function(){return a.apply(l,arguments)}}}),616:((o,e,t)=>{var s=t(9039);o.exports=!s(function(){var i=(function(){}).bind();return typeof i!="function"||i.hasOwnProperty("prototype")})}),9565:((o,e,t)=>{var s=t(616),i=Function.prototype.call;o.exports=s?i.bind(i):function(){return i.apply(i,arguments)}}),350:((o,e,t)=>{var s=t(3724),i=t(9297),n=Function.prototype,r=s&&Object.getOwnPropertyDescriptor,a=i(n,"name"),l=a&&(function(){}).name==="something",h=a&&(!s||s&&r(n,"name").configurable);o.exports={EXISTS:a,PROPER:l,CONFIGURABLE:h}}),6706:((o,e,t)=>{var s=t(9504),i=t(9306);o.exports=function(n,r,a){try{return s(i(Object.getOwnPropertyDescriptor(n,r)[a]))}catch{}}}),7476:((o,e,t)=>{var s=t(2195),i=t(9504);o.exports=function(n){if(s(n)==="Function")return i(n)}}),9504:((o,e,t)=>{var s=t(616),i=Function.prototype,n=i.call,r=s&&i.bind.bind(n,n);o.exports=s?r:function(a){return function(){return n.apply(a,arguments)}}}),9429:((o,e,t)=>{var s=t(4576),i=t(6193);o.exports=function(n){if(i){try{return s.process.getBuiltinModule(n)}catch{}try{return Function('return require("'+n+'")')()}catch{}}}}),7751:((o,e,t)=>{var s=t(4576),i=t(4901),n=function(r){return i(r)?r:void 0};o.exports=function(r,a){return arguments.length<2?n(s[r]):s[r]&&s[r][a]}}),1767:(o=>{o.exports=function(e){return{iterator:e,next:e.next,done:!1}}}),8646:((o,e,t)=>{var s=t(9565),i=t(8551),n=t(1767),r=t(851);o.exports=function(a,l){(!l||typeof a!="string")&&i(a);var h=r(a);return n(i(h!==void 0?s(h,a):a))}}),851:((o,e,t)=>{var s=t(6955),i=t(5966),n=t(4117),r=t(6269),a=t(8227),l=a("iterator");o.exports=function(h){if(!n(h))return i(h,l)||i(h,"@@iterator")||r[s(h)]}}),81:((o,e,t)=>{var s=t(9565),i=t(9306),n=t(8551),r=t(6823),a=t(851),l=TypeError;o.exports=function(h,c){var d=arguments.length<2?a(h):c;if(i(d))return n(s(d,h));throw new l(r(h)+" is not iterable")}}),5966:((o,e,t)=>{var s=t(9306),i=t(4117);o.exports=function(n,r){var a=n[r];return i(a)?void 0:s(a)}}),3789:((o,e,t)=>{var s=t(9306),i=t(8551),n=t(9565),r=t(1291),a=t(1767),l="Invalid size",h=RangeError,c=TypeError,d=Math.max,u=function(f,p){this.set=f,this.size=d(p,0),this.has=s(f.has),this.keys=s(f.keys)};u.prototype={getIterator:function(){return a(i(n(this.keys,this.set)))},includes:function(f){return n(this.has,this.set,f)}},o.exports=function(f){i(f);var p=+f.size;if(p!==p)throw new c(l);var g=r(p);if(g<0)throw new h(l);return new u(f,g)}}),4576:(function(o){var e=function(t){return t&&t.Math===Math&&t};o.exports=e(typeof globalThis=="object"&&globalThis)||e(typeof window=="object"&&window)||e(typeof self=="object"&&self)||e(typeof global=="object"&&global)||e(typeof this=="object"&&this)||(function(){return this})()||Function("return this")()}),9297:((o,e,t)=>{var s=t(9504),i=t(8981),n=s({}.hasOwnProperty);o.exports=Object.hasOwn||function(a,l){return n(i(a),l)}}),421:(o=>{o.exports={}}),397:((o,e,t)=>{var s=t(7751);o.exports=s("document","documentElement")}),5917:((o,e,t)=>{var s=t(3724),i=t(9039),n=t(4055);o.exports=!s&&!i(function(){return Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a!==7})}),7055:((o,e,t)=>{var s=t(9504),i=t(9039),n=t(2195),r=Object,a=s("".split);o.exports=i(function(){return!r("z").propertyIsEnumerable(0)})?function(l){return n(l)==="String"?a(l,""):r(l)}:r}),3167:((o,e,t)=>{var s=t(4901),i=t(34),n=t(2967);o.exports=function(r,a,l){var h,c;return n&&s(h=a.constructor)&&h!==l&&i(c=h.prototype)&&c!==l.prototype&&n(r,c),r}}),3706:((o,e,t)=>{var s=t(9504),i=t(4901),n=t(7629),r=s(Function.toString);i(n.inspectSource)||(n.inspectSource=function(a){return r(a)}),o.exports=n.inspectSource}),1181:((o,e,t)=>{var s=t(8622),i=t(4576),n=t(34),r=t(6699),a=t(9297),l=t(7629),h=t(6119),c=t(421),d="Object already initialized",u=i.TypeError,f=i.WeakMap,p,g,m,v=function(y){return m(y)?g(y):p(y,{})},b=function(y){return function(x){var E;if(!n(x)||(E=g(x)).type!==y)throw new u("Incompatible receiver, "+y+" required");return E}};if(s||l.state){var A=l.state||(l.state=new f);A.get=A.get,A.has=A.has,A.set=A.set,p=function(y,x){if(A.has(y))throw new u(d);return x.facade=y,A.set(y,x),x},g=function(y){return A.get(y)||{}},m=function(y){return A.has(y)}}else{var w=h("state");c[w]=!0,p=function(y,x){if(a(y,w))throw new u(d);return x.facade=y,r(y,w,x),x},g=function(y){return a(y,w)?y[w]:{}},m=function(y){return a(y,w)}}o.exports={set:p,get:g,has:m,enforce:v,getterFor:b}}),4209:((o,e,t)=>{var s=t(8227),i=t(6269),n=s("iterator"),r=Array.prototype;o.exports=function(a){return a!==void 0&&(i.Array===a||r[n]===a)}}),4376:((o,e,t)=>{var s=t(2195);o.exports=Array.isArray||function(n){return s(n)==="Array"}}),1108:((o,e,t)=>{var s=t(6955);o.exports=function(i){var n=s(i);return n==="BigInt64Array"||n==="BigUint64Array"}}),4901:(o=>{var e=typeof document=="object"&&document.all;o.exports=typeof e>"u"&&e!==void 0?function(t){return typeof t=="function"||t===e}:function(t){return typeof t=="function"}}),2796:((o,e,t)=>{var s=t(9039),i=t(4901),n=/#|\.prototype\./,r=function(d,u){var f=l[a(d)];return f===c?!0:f===h?!1:i(u)?s(u):!!u},a=r.normalize=function(d){return String(d).replace(n,".").toLowerCase()},l=r.data={},h=r.NATIVE="N",c=r.POLYFILL="P";o.exports=r}),4117:(o=>{o.exports=function(e){return e==null}}),34:((o,e,t)=>{var s=t(4901);o.exports=function(i){return typeof i=="object"?i!==null:s(i)}}),3925:((o,e,t)=>{var s=t(34);o.exports=function(i){return s(i)||i===null}}),6395:(o=>{o.exports=!1}),757:((o,e,t)=>{var s=t(7751),i=t(4901),n=t(1625),r=t(7040),a=Object;o.exports=r?function(l){return typeof l=="symbol"}:function(l){var h=s("Symbol");return i(h)&&n(h.prototype,a(l))}}),507:((o,e,t)=>{var s=t(9565);o.exports=function(i,n,r){for(var a=r?i:i.iterator,l=i.next,h,c;!(h=s(l,a)).done;)if(c=n(h.value),c!==void 0)return c}}),2652:((o,e,t)=>{var s=t(6080),i=t(9565),n=t(8551),r=t(6823),a=t(4209),l=t(6198),h=t(1625),c=t(81),d=t(851),u=t(9539),f=TypeError,p=function(m,v){this.stopped=m,this.result=v},g=p.prototype;o.exports=function(m,v,b){var A=b&&b.that,w=!!(b&&b.AS_ENTRIES),y=!!(b&&b.IS_RECORD),x=!!(b&&b.IS_ITERATOR),E=!!(b&&b.INTERRUPTED),C=s(v,A),S,M,L,G,H,U,q,P=function(X){return S&&u(S,"normal",X),new p(!0,X)},R=function(X){return w?(n(X),E?C(X[0],X[1],P):C(X[0],X[1])):E?C(X,P):C(X)};if(y)S=m.iterator;else if(x)S=m;else{if(M=d(m),!M)throw new f(r(m)+" is not iterable");if(a(M)){for(L=0,G=l(m);G>L;L++)if(H=R(m[L]),H&&h(g,H))return H;return new p(!1)}S=c(m,M)}for(U=y?m.next:S.next;!(q=i(U,S)).done;){try{H=R(q.value)}catch(X){u(S,"throw",X)}if(typeof H=="object"&&H&&h(g,H))return H}return new p(!1)}}),9539:((o,e,t)=>{var s=t(9565),i=t(8551),n=t(5966);o.exports=function(r,a,l){var h,c;i(r);try{if(h=n(r,"return"),!h){if(a==="throw")throw l;return l}h=s(h,r)}catch(d){c=!0,h=d}if(a==="throw")throw l;if(c)throw h;return i(h),l}}),9462:((o,e,t)=>{var s=t(9565),i=t(2360),n=t(6699),r=t(6279),a=t(8227),l=t(1181),h=t(5966),c=t(7657).IteratorPrototype,d=t(2529),u=t(9539),f=a("toStringTag"),p="IteratorHelper",g="WrapForValidIterator",m=l.set,v=function(w){var y=l.getterFor(w?g:p);return r(i(c),{next:function(){var E=y(this);if(w)return E.nextHandler();try{var C=E.done?void 0:E.nextHandler();return d(C,E.done)}catch(S){throw E.done=!0,S}},return:function(){var x=y(this),E=x.iterator;if(x.done=!0,w){var C=h(E,"return");return C?s(C,E):d(void 0,!0)}if(x.inner)try{u(x.inner.iterator,"normal")}catch(S){return u(E,"throw",S)}return E&&u(E,"normal"),d(void 0,!0)}})},b=v(!0),A=v(!1);n(A,f,"Iterator Helper"),o.exports=function(w,y){var x=function(C,S){S?(S.iterator=C.iterator,S.next=C.next):S=C,S.type=y?g:p,S.nextHandler=w,S.counter=0,S.done=!1,m(this,S)};return x.prototype=y?b:A,x}}),713:((o,e,t)=>{var s=t(9565),i=t(9306),n=t(8551),r=t(1767),a=t(9462),l=t(6319),h=a(function(){var c=this.iterator,d=n(s(this.next,c)),u=this.done=!!d.done;if(!u)return l(c,this.mapper,[d.value,this.counter++],!0)});o.exports=function(d){return n(this),i(d),new h(r(this),{mapper:d})}}),7657:((o,e,t)=>{var s=t(9039),i=t(4901),n=t(34),r=t(2360),a=t(2787),l=t(6840),h=t(8227),c=t(6395),d=h("iterator"),u=!1,f,p,g;[].keys&&(g=[].keys(),"next"in g?(p=a(a(g)),p!==Object.prototype&&(f=p)):u=!0);var m=!n(f)||s(function(){var v={};return f[d].call(v)!==v});m?f={}:c&&(f=r(f)),i(f[d])||l(f,d,function(){return this}),o.exports={IteratorPrototype:f,BUGGY_SAFARI_ITERATORS:u}}),6269:(o=>{o.exports={}}),6198:((o,e,t)=>{var s=t(8014);o.exports=function(i){return s(i.length)}}),283:((o,e,t)=>{var s=t(9504),i=t(9039),n=t(4901),r=t(9297),a=t(3724),l=t(350).CONFIGURABLE,h=t(3706),c=t(1181),d=c.enforce,u=c.get,f=String,p=Object.defineProperty,g=s("".slice),m=s("".replace),v=s([].join),b=a&&!i(function(){return p(function(){},"length",{value:8}).length!==8}),A=String(String).split("String"),w=o.exports=function(y,x,E){g(f(x),0,7)==="Symbol("&&(x="["+m(f(x),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),E&&E.getter&&(x="get "+x),E&&E.setter&&(x="set "+x),(!r(y,"name")||l&&y.name!==x)&&(a?p(y,"name",{value:x,configurable:!0}):y.name=x),b&&E&&r(E,"arity")&&y.length!==E.arity&&p(y,"length",{value:E.arity});try{E&&r(E,"constructor")&&E.constructor?a&&p(y,"prototype",{writable:!1}):y.prototype&&(y.prototype=void 0)}catch{}var C=d(y);return r(C,"source")||(C.source=v(A,typeof x=="string"?x:"")),y};Function.prototype.toString=w(function(){return n(this)&&u(this).source||h(this)},"toString")}),741:(o=>{var e=Math.ceil,t=Math.floor;o.exports=Math.trunc||function(i){var n=+i;return(n>0?t:e)(n)}}),6043:((o,e,t)=>{var s=t(9306),i=TypeError,n=function(r){var a,l;this.promise=new r(function(h,c){if(a!==void 0||l!==void 0)throw new i("Bad Promise constructor");a=h,l=c}),this.resolve=s(a),this.reject=s(l)};o.exports.f=function(r){return new n(r)}}),2603:((o,e,t)=>{var s=t(655);o.exports=function(i,n){return i===void 0?arguments.length<2?"":n:s(i)}}),4149:(o=>{var e=RangeError;o.exports=function(t){if(t===t)return t;throw new e("NaN is not allowed")}}),2360:((o,e,t)=>{var s=t(8551),i=t(6801),n=t(8727),r=t(421),a=t(397),l=t(4055),h=t(6119),c=">",d="<",u="prototype",f="script",p=h("IE_PROTO"),g=function(){},m=function(y){return d+f+c+y+d+"/"+f+c},v=function(y){y.write(m("")),y.close();var x=y.parentWindow.Object;return y=null,x},b=function(){var y=l("iframe"),x="java"+f+":",E;return y.style.display="none",a.appendChild(y),y.src=String(x),E=y.contentWindow.document,E.open(),E.write(m("document.F=Object")),E.close(),E.F},A,w=function(){try{A=new ActiveXObject("htmlfile")}catch{}w=typeof document<"u"?document.domain&&A?v(A):b():v(A);for(var y=n.length;y--;)delete w[u][n[y]];return w()};r[p]=!0,o.exports=Object.create||function(x,E){var C;return x!==null?(g[u]=s(x),C=new g,g[u]=null,C[p]=x):C=w(),E===void 0?C:i.f(C,E)}}),6801:((o,e,t)=>{var s=t(3724),i=t(8686),n=t(4913),r=t(8551),a=t(5397),l=t(1072);e.f=s&&!i?Object.defineProperties:function(c,d){r(c);for(var u=a(d),f=l(d),p=f.length,g=0,m;p>g;)n.f(c,m=f[g++],u[m]);return c}}),4913:((o,e,t)=>{var s=t(3724),i=t(5917),n=t(8686),r=t(8551),a=t(6969),l=TypeError,h=Object.defineProperty,c=Object.getOwnPropertyDescriptor,d="enumerable",u="configurable",f="writable";e.f=s?n?function(g,m,v){if(r(g),m=a(m),r(v),typeof g=="function"&&m==="prototype"&&"value"in v&&f in v&&!v[f]){var b=c(g,m);b&&b[f]&&(g[m]=v.value,v={configurable:u in v?v[u]:b[u],enumerable:d in v?v[d]:b[d],writable:!1})}return h(g,m,v)}:h:function(g,m,v){if(r(g),m=a(m),r(v),i)try{return h(g,m,v)}catch{}if("get"in v||"set"in v)throw new l("Accessors not supported");return"value"in v&&(g[m]=v.value),g}}),7347:((o,e,t)=>{var s=t(3724),i=t(9565),n=t(8773),r=t(6980),a=t(5397),l=t(6969),h=t(9297),c=t(5917),d=Object.getOwnPropertyDescriptor;e.f=s?d:function(f,p){if(f=a(f),p=l(p),c)try{return d(f,p)}catch{}if(h(f,p))return r(!i(n.f,f,p),f[p])}}),8480:((o,e,t)=>{var s=t(1828),i=t(8727),n=i.concat("length","prototype");e.f=Object.getOwnPropertyNames||function(a){return s(a,n)}}),3717:((o,e)=>{e.f=Object.getOwnPropertySymbols}),2787:((o,e,t)=>{var s=t(9297),i=t(4901),n=t(8981),r=t(6119),a=t(2211),l=r("IE_PROTO"),h=Object,c=h.prototype;o.exports=a?h.getPrototypeOf:function(d){var u=n(d);if(s(u,l))return u[l];var f=u.constructor;return i(f)&&u instanceof f?f.prototype:u instanceof h?c:null}}),1625:((o,e,t)=>{var s=t(9504);o.exports=s({}.isPrototypeOf)}),1828:((o,e,t)=>{var s=t(9504),i=t(9297),n=t(5397),r=t(9617).indexOf,a=t(421),l=s([].push);o.exports=function(h,c){var d=n(h),u=0,f=[],p;for(p in d)!i(a,p)&&i(d,p)&&l(f,p);for(;c.length>u;)i(d,p=c[u++])&&(~r(f,p)||l(f,p));return f}}),1072:((o,e,t)=>{var s=t(1828),i=t(8727);o.exports=Object.keys||function(r){return s(r,i)}}),8773:((o,e)=>{var t={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,i=s&&!t.call({1:2},1);e.f=i?function(r){var a=s(this,r);return!!a&&a.enumerable}:t}),2967:((o,e,t)=>{var s=t(6706),i=t(34),n=t(7750),r=t(3506);o.exports=Object.setPrototypeOf||("__proto__"in{}?(function(){var a=!1,l={},h;try{h=s(Object.prototype,"__proto__","set"),h(l,[]),a=l instanceof Array}catch{}return function(d,u){return n(d),r(u),i(d)&&(a?h(d,u):d.__proto__=u),d}})():void 0)}),4270:((o,e,t)=>{var s=t(9565),i=t(4901),n=t(34),r=TypeError;o.exports=function(a,l){var h,c;if(l==="string"&&i(h=a.toString)&&!n(c=s(h,a))||i(h=a.valueOf)&&!n(c=s(h,a))||l!=="string"&&i(h=a.toString)&&!n(c=s(h,a)))return c;throw new r("Can't convert object to primitive value")}}),5031:((o,e,t)=>{var s=t(7751),i=t(9504),n=t(8480),r=t(3717),a=t(8551),l=i([].concat);o.exports=s("Reflect","ownKeys")||function(c){var d=n.f(a(c)),u=r.f;return u?l(d,u(c)):d}}),8235:((o,e,t)=>{var s=t(9504),i=t(9297),n=SyntaxError,r=parseInt,a=String.fromCharCode,l=s("".charAt),h=s("".slice),c=s(/./.exec),d={'\\"':'"',"\\\\":"\\","\\/":"/","\\b":"\b","\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	"},u=/^[\da-f]{4}$/i,f=/^[\u0000-\u001F]$/;o.exports=function(p,g){for(var m=!0,v="";g<p.length;){var b=l(p,g);if(b==="\\"){var A=h(p,g,g+2);if(i(d,A))v+=d[A],g+=2;else if(A==="\\u"){g+=2;var w=h(p,g,g+4);if(!c(u,w))throw new n("Bad Unicode escape at: "+g);v+=a(r(w,16)),g+=4}else throw new n('Unknown escape sequence: "'+A+'"')}else if(b==='"'){m=!1,g++;break}else{if(c(f,b))throw new n("Bad control character in string literal at: "+g);v+=b,g++}}if(m)throw new n("Unterminated string at: "+g);return{value:v,end:g}}}),1103:(o=>{o.exports=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}}}),7750:((o,e,t)=>{var s=t(4117),i=TypeError;o.exports=function(n){if(s(n))throw new i("Can't call method on "+n);return n}}),9286:((o,e,t)=>{var s=t(4402),i=t(8469),n=s.Set,r=s.add;o.exports=function(a){var l=new n;return i(a,function(h){r(l,h)}),l}}),3440:((o,e,t)=>{var s=t(7080),i=t(4402),n=t(9286),r=t(5170),a=t(3789),l=t(8469),h=t(507),c=i.has,d=i.remove;o.exports=function(f){var p=s(this),g=a(f),m=n(p);return r(p)<=g.size?l(p,function(v){g.includes(v)&&d(m,v)}):h(g.getIterator(),function(v){c(p,v)&&d(m,v)}),m}}),4402:((o,e,t)=>{var s=t(9504),i=Set.prototype;o.exports={Set,add:s(i.add),has:s(i.has),remove:s(i.delete),proto:i}}),8750:((o,e,t)=>{var s=t(7080),i=t(4402),n=t(5170),r=t(3789),a=t(8469),l=t(507),h=i.Set,c=i.add,d=i.has;o.exports=function(f){var p=s(this),g=r(f),m=new h;return n(p)>g.size?l(g.getIterator(),function(v){d(p,v)&&c(m,v)}):a(p,function(v){g.includes(v)&&c(m,v)}),m}}),4449:((o,e,t)=>{var s=t(7080),i=t(4402).has,n=t(5170),r=t(3789),a=t(8469),l=t(507),h=t(9539);o.exports=function(d){var u=s(this),f=r(d);if(n(u)<=f.size)return a(u,function(g){if(f.includes(g))return!1},!0)!==!1;var p=f.getIterator();return l(p,function(g){if(i(u,g))return h(p,"normal",!1)})!==!1}}),3838:((o,e,t)=>{var s=t(7080),i=t(5170),n=t(8469),r=t(3789);o.exports=function(l){var h=s(this),c=r(l);return i(h)>c.size?!1:n(h,function(d){if(!c.includes(d))return!1},!0)!==!1}}),8527:((o,e,t)=>{var s=t(7080),i=t(4402).has,n=t(5170),r=t(3789),a=t(507),l=t(9539);o.exports=function(c){var d=s(this),u=r(c);if(n(d)<u.size)return!1;var f=u.getIterator();return a(f,function(p){if(!i(d,p))return l(f,"normal",!1)})!==!1}}),8469:((o,e,t)=>{var s=t(9504),i=t(507),n=t(4402),r=n.Set,a=n.proto,l=s(a.forEach),h=s(a.keys),c=h(new r).next;o.exports=function(d,u,f){return f?i({iterator:h(d),next:c},u):l(d,u)}}),4916:((o,e,t)=>{var s=t(7751),i=function(n){return{size:n,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}};o.exports=function(n){var r=s("Set");try{new r()[n](i(0));try{return new r()[n](i(-1)),!1}catch{return!0}}catch{return!1}}}),5170:((o,e,t)=>{var s=t(6706),i=t(4402);o.exports=s(i.proto,"size","get")||function(n){return n.size}}),3650:((o,e,t)=>{var s=t(7080),i=t(4402),n=t(9286),r=t(3789),a=t(507),l=i.add,h=i.has,c=i.remove;o.exports=function(u){var f=s(this),p=r(u).getIterator(),g=n(f);return a(p,function(m){h(f,m)?c(g,m):l(g,m)}),g}}),4204:((o,e,t)=>{var s=t(7080),i=t(4402).add,n=t(9286),r=t(3789),a=t(507);o.exports=function(h){var c=s(this),d=r(h).getIterator(),u=n(c);return a(d,function(f){i(u,f)}),u}}),6119:((o,e,t)=>{var s=t(5745),i=t(3392),n=s("keys");o.exports=function(r){return n[r]||(n[r]=i(r))}}),7629:((o,e,t)=>{var s=t(6395),i=t(4576),n=t(9433),r="__core-js_shared__",a=o.exports=i[r]||n(r,{});(a.versions||(a.versions=[])).push({version:"3.39.0",mode:s?"pure":"global",copyright:"\xA9 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"})}),5745:((o,e,t)=>{var s=t(7629);o.exports=function(i,n){return s[i]||(s[i]=n||{})}}),1548:((o,e,t)=>{var s=t(4576),i=t(9039),n=t(9519),r=t(4215),a=s.structuredClone;o.exports=!!a&&!i(function(){if(r==="DENO"&&n>92||r==="NODE"&&n>94||r==="BROWSER"&&n>97)return!1;var l=new ArrayBuffer(8),h=a(l,{transfer:[l]});return l.byteLength!==0||h.byteLength!==8})}),4495:((o,e,t)=>{var s=t(9519),i=t(9039),n=t(4576),r=n.String;o.exports=!!Object.getOwnPropertySymbols&&!i(function(){var a=Symbol("symbol detection");return!r(a)||!(Object(a)instanceof Symbol)||!Symbol.sham&&s&&s<41})}),5610:((o,e,t)=>{var s=t(1291),i=Math.max,n=Math.min;o.exports=function(r,a){var l=s(r);return l<0?i(l+a,0):n(l,a)}}),5854:((o,e,t)=>{var s=t(2777),i=TypeError;o.exports=function(n){var r=s(n,"number");if(typeof r=="number")throw new i("Can't convert number to bigint");return BigInt(r)}}),7696:((o,e,t)=>{var s=t(1291),i=t(8014),n=RangeError;o.exports=function(r){if(r===void 0)return 0;var a=s(r),l=i(a);if(a!==l)throw new n("Wrong length or index");return l}}),5397:((o,e,t)=>{var s=t(7055),i=t(7750);o.exports=function(n){return s(i(n))}}),1291:((o,e,t)=>{var s=t(741);o.exports=function(i){var n=+i;return n!==n||n===0?0:s(n)}}),8014:((o,e,t)=>{var s=t(1291),i=Math.min;o.exports=function(n){var r=s(n);return r>0?i(r,9007199254740991):0}}),8981:((o,e,t)=>{var s=t(7750),i=Object;o.exports=function(n){return i(s(n))}}),9590:((o,e,t)=>{var s=t(1291),i=RangeError;o.exports=function(n){var r=s(n);if(r<0)throw new i("The argument can't be less than 0");return r}}),2777:((o,e,t)=>{var s=t(9565),i=t(34),n=t(757),r=t(5966),a=t(4270),l=t(8227),h=TypeError,c=l("toPrimitive");o.exports=function(d,u){if(!i(d)||n(d))return d;var f=r(d,c),p;if(f){if(u===void 0&&(u="default"),p=s(f,d,u),!i(p)||n(p))return p;throw new h("Can't convert object to primitive value")}return u===void 0&&(u="number"),a(d,u)}}),6969:((o,e,t)=>{var s=t(2777),i=t(757);o.exports=function(n){var r=s(n,"string");return i(r)?r:r+""}}),2140:((o,e,t)=>{var s=t(8227),i=s("toStringTag"),n={};n[i]="z",o.exports=String(n)==="[object z]"}),655:((o,e,t)=>{var s=t(6955),i=String;o.exports=function(n){if(s(n)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return i(n)}}),6823:(o=>{var e=String;o.exports=function(t){try{return e(t)}catch{return"Object"}}}),3392:((o,e,t)=>{var s=t(9504),i=0,n=Math.random(),r=s(1 .toString);o.exports=function(a){return"Symbol("+(a===void 0?"":a)+")_"+r(++i+n,36)}}),7040:((o,e,t)=>{var s=t(4495);o.exports=s&&!Symbol.sham&&typeof Symbol.iterator=="symbol"}),8686:((o,e,t)=>{var s=t(3724),i=t(9039);o.exports=s&&i(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42})}),2812:(o=>{var e=TypeError;o.exports=function(t,s){if(t<s)throw new e("Not enough arguments");return t}}),8622:((o,e,t)=>{var s=t(4576),i=t(4901),n=s.WeakMap;o.exports=i(n)&&/native code/.test(String(n))}),8227:((o,e,t)=>{var s=t(4576),i=t(5745),n=t(9297),r=t(3392),a=t(4495),l=t(7040),h=s.Symbol,c=i("wks"),d=l?h.for||h:h&&h.withoutSetter||r;o.exports=function(u){return n(c,u)||(c[u]=a&&n(h,u)?h[u]:d("Symbol."+u)),c[u]}}),6573:((o,e,t)=>{var s=t(3724),i=t(2106),n=t(3238),r=ArrayBuffer.prototype;s&&!("detached"in r)&&i(r,"detached",{configurable:!0,get:function(){return n(this)}})}),7936:((o,e,t)=>{var s=t(6518),i=t(5636);i&&s({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return i(this,arguments.length?arguments[0]:void 0,!1)}})}),8100:((o,e,t)=>{var s=t(6518),i=t(5636);i&&s({target:"ArrayBuffer",proto:!0},{transfer:function(){return i(this,arguments.length?arguments[0]:void 0,!0)}})}),4114:((o,e,t)=>{var s=t(6518),i=t(8981),n=t(6198),r=t(4527),a=t(6837),l=t(9039),h=l(function(){return[].push.call({length:4294967296},1)!==4294967297}),c=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(u){return u instanceof TypeError}},d=h||!c();s({target:"Array",proto:!0,arity:1,forced:d},{push:function(f){var p=i(this),g=n(p),m=arguments.length;a(g+m);for(var v=0;v<m;v++)p[g]=arguments[v],g++;return r(p,g),g}})}),8111:((o,e,t)=>{var s=t(6518),i=t(4576),n=t(679),r=t(8551),a=t(4901),l=t(2787),h=t(2106),c=t(4659),d=t(9039),u=t(9297),f=t(8227),p=t(7657).IteratorPrototype,g=t(3724),m=t(6395),v="constructor",b="Iterator",A=f("toStringTag"),w=TypeError,y=i[b],x=m||!a(y)||y.prototype!==p||!d(function(){y({})}),E=function(){if(n(this,p),l(this)===p)throw new w("Abstract class Iterator not directly constructable")},C=function(S,M){g?h(p,S,{configurable:!0,get:function(){return M},set:function(L){if(r(this),this===p)throw new w("You can't redefine this property");u(this,S)?this[S]=L:c(this,S,L)}}):p[S]=M};u(p,A)||C(A,b),(x||!u(p,v)||p[v]===Object)&&C(v,E),E.prototype=p,s({global:!0,constructor:!0,forced:x},{Iterator:E})}),9314:((o,e,t)=>{var s=t(6518),i=t(9565),n=t(8551),r=t(1767),a=t(4149),l=t(9590),h=t(9462),c=t(6395),d=h(function(){for(var u=this.iterator,f=this.next,p,g;this.remaining;)if(this.remaining--,p=n(i(f,u)),g=this.done=!!p.done,g)return;if(p=n(i(f,u)),g=this.done=!!p.done,!g)return p.value});s({target:"Iterator",proto:!0,real:!0,forced:c},{drop:function(f){n(this);var p=l(a(+f));return new d(r(this),{remaining:p})}})}),1148:((o,e,t)=>{var s=t(6518),i=t(2652),n=t(9306),r=t(8551),a=t(1767);s({target:"Iterator",proto:!0,real:!0},{every:function(h){r(this),n(h);var c=a(this),d=0;return!i(c,function(u,f){if(!h(u,d++))return f()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})}),2489:((o,e,t)=>{var s=t(6518),i=t(9565),n=t(9306),r=t(8551),a=t(1767),l=t(9462),h=t(6319),c=t(6395),d=l(function(){for(var u=this.iterator,f=this.predicate,p=this.next,g,m,v;;){if(g=r(i(p,u)),m=this.done=!!g.done,m)return;if(v=g.value,h(u,f,[v,this.counter++],!0))return v}});s({target:"Iterator",proto:!0,real:!0,forced:c},{filter:function(f){return r(this),n(f),new d(a(this),{predicate:f})}})}),531:((o,e,t)=>{var s=t(6518),i=t(9565),n=t(9306),r=t(8551),a=t(1767),l=t(8646),h=t(9462),c=t(9539),d=t(6395),u=h(function(){for(var f=this.iterator,p=this.mapper,g,m;;){if(m=this.inner)try{if(g=r(i(m.next,m.iterator)),!g.done)return g.value;this.inner=null}catch(v){c(f,"throw",v)}if(g=r(i(this.next,f)),this.done=!!g.done)return;try{this.inner=l(p(g.value,this.counter++),!1)}catch(v){c(f,"throw",v)}}});s({target:"Iterator",proto:!0,real:!0,forced:d},{flatMap:function(p){return r(this),n(p),new u(a(this),{mapper:p,inner:null})}})}),1701:((o,e,t)=>{var s=t(6518),i=t(713),n=t(6395);s({target:"Iterator",proto:!0,real:!0,forced:n},{map:i})}),3579:((o,e,t)=>{var s=t(6518),i=t(2652),n=t(9306),r=t(8551),a=t(1767);s({target:"Iterator",proto:!0,real:!0},{some:function(h){r(this),n(h);var c=a(this),d=0;return i(c,function(u,f){if(h(u,d++))return f()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})}),1689:((o,e,t)=>{var s=t(6518),i=t(4576),n=t(8745),r=t(7680),a=t(6043),l=t(9306),h=t(1103),c=i.Promise,d=!1,u=!c||!c.try||h(function(){c.try(function(f){d=f===8},8)}).error||!d;s({target:"Promise",stat:!0,forced:u},{try:function(f){var p=arguments.length>1?r(arguments,1):[],g=a.f(this),m=h(function(){return n(l(f),void 0,p)});return(m.error?g.reject:g.resolve)(m.value),g.promise}})}),4628:((o,e,t)=>{var s=t(6518),i=t(6043);s({target:"Promise",stat:!0},{withResolvers:function(){var r=i.f(this);return{promise:r.promise,resolve:r.resolve,reject:r.reject}}})}),7642:((o,e,t)=>{var s=t(6518),i=t(3440),n=t(4916);s({target:"Set",proto:!0,real:!0,forced:!n("difference")},{difference:i})}),8004:((o,e,t)=>{var s=t(6518),i=t(9039),n=t(8750),r=t(4916),a=!r("intersection")||i(function(){return String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))!=="3,2"});s({target:"Set",proto:!0,real:!0,forced:a},{intersection:n})}),3853:((o,e,t)=>{var s=t(6518),i=t(4449),n=t(4916);s({target:"Set",proto:!0,real:!0,forced:!n("isDisjointFrom")},{isDisjointFrom:i})}),5876:((o,e,t)=>{var s=t(6518),i=t(3838),n=t(4916);s({target:"Set",proto:!0,real:!0,forced:!n("isSubsetOf")},{isSubsetOf:i})}),2475:((o,e,t)=>{var s=t(6518),i=t(8527),n=t(4916);s({target:"Set",proto:!0,real:!0,forced:!n("isSupersetOf")},{isSupersetOf:i})}),5024:((o,e,t)=>{var s=t(6518),i=t(3650),n=t(4916);s({target:"Set",proto:!0,real:!0,forced:!n("symmetricDifference")},{symmetricDifference:i})}),1698:((o,e,t)=>{var s=t(6518),i=t(4204),n=t(4916);s({target:"Set",proto:!0,real:!0,forced:!n("union")},{union:i})}),7467:((o,e,t)=>{var s=t(7628),i=t(4644),n=i.aTypedArray,r=i.exportTypedArrayMethod,a=i.getTypedArrayConstructor;r("toReversed",function(){return s(n(this),a(this))})}),4732:((o,e,t)=>{var s=t(4644),i=t(9504),n=t(9306),r=t(5370),a=s.aTypedArray,l=s.getTypedArrayConstructor,h=s.exportTypedArrayMethod,c=i(s.TypedArrayPrototype.sort);h("toSorted",function(u){u!==void 0&&n(u);var f=a(this),p=r(l(f),f);return c(p,u)})}),9577:((o,e,t)=>{var s=t(9928),i=t(4644),n=t(1108),r=t(1291),a=t(5854),l=i.aTypedArray,h=i.getTypedArrayConstructor,c=i.exportTypedArrayMethod,d=!!(function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(u){return u===8}})();c("with",function(u,f){var p=l(this),g=r(u),m=n(p)?a(f):+f;return s(p,h(p),g,m)},!d)}),8992:((o,e,t)=>{t(8111)}),4743:((o,e,t)=>{t(9314)}),3215:((o,e,t)=>{t(1148)}),4520:((o,e,t)=>{t(2489)}),670:((o,e,t)=>{t(531)}),1454:((o,e,t)=>{t(1701)}),7550:((o,e,t)=>{t(3579)}),8335:((o,e,t)=>{var s=t(6518),i=t(3724),n=t(4576),r=t(7751),a=t(9504),l=t(9565),h=t(4901),c=t(34),d=t(4376),u=t(9297),f=t(655),p=t(6198),g=t(4659),m=t(9039),v=t(8235),b=t(4495),A=n.JSON,w=n.Number,y=n.SyntaxError,x=A&&A.parse,E=r("Object","keys"),C=Object.getOwnPropertyDescriptor,S=a("".charAt),M=a("".slice),L=a(/./.exec),G=a([].push),H=/^\d$/,U=/^[1-9]$/,q=/^[\d-]$/,P=/^[\t\n\r ]$/,R=0,X=1,Y=function(_,T){_=f(_);var I=new Q(_,0,""),$=I.parse(),J=$.value,N=I.skip(P,$.end);if(N<_.length)throw new y('Unexpected extra character: "'+S(_,N)+'" after the parsed data at: '+N);return h(T)?st({"":J},"",T,$):J},st=function(_,T,I,$){var J=_[T],N=$&&J===$.value,rt=N&&typeof $.source=="string"?{source:$.source}:{},at,Rt,mt,dt,Yt;if(c(J)){var As=d(J),Se=N?$.nodes:As?[]:{};if(As)for(at=Se.length,mt=p(J),dt=0;dt<mt;dt++)nt(J,dt,st(J,""+dt,I,dt<at?Se[dt]:void 0));else for(Rt=E(J),mt=p(Rt),dt=0;dt<mt;dt++)Yt=Rt[dt],nt(J,Yt,st(J,Yt,I,u(Se,Yt)?Se[Yt]:void 0))}return l(I,_,T,J,rt)},nt=function(_,T,I){if(i){var $=C(_,T);if($&&!$.configurable)return}I===void 0?delete _[T]:g(_,T,I)},K=function(_,T,I,$){this.value=_,this.end=T,this.source=I,this.nodes=$},Q=function(_,T){this.source=_,this.index=T};Q.prototype={fork:function(_){return new Q(this.source,_)},parse:function(){var _=this.source,T=this.skip(P,this.index),I=this.fork(T),$=S(_,T);if(L(q,$))return I.number();switch($){case"{":return I.object();case"[":return I.array();case'"':return I.string();case"t":return I.keyword(!0);case"f":return I.keyword(!1);case"n":return I.keyword(null)}throw new y('Unexpected character: "'+$+'" at: '+T)},node:function(_,T,I,$,J){return new K(T,$,_?null:M(this.source,I,$),J)},object:function(){for(var _=this.source,T=this.index+1,I=!1,$={},J={};T<_.length;){if(T=this.until(['"',"}"],T),S(_,T)==="}"&&!I){T++;break}var N=this.fork(T).string(),rt=N.value;T=N.end,T=this.until([":"],T)+1,T=this.skip(P,T),N=this.fork(T).parse(),g(J,rt,N),g($,rt,N.value),T=this.until([",","}"],N.end);var at=S(_,T);if(at===",")I=!0,T++;else if(at==="}"){T++;break}}return this.node(X,$,this.index,T,J)},array:function(){for(var _=this.source,T=this.index+1,I=!1,$=[],J=[];T<_.length;){if(T=this.skip(P,T),S(_,T)==="]"&&!I){T++;break}var N=this.fork(T).parse();if(G(J,N),G($,N.value),T=this.until([",","]"],N.end),S(_,T)===",")I=!0,T++;else if(S(_,T)==="]"){T++;break}}return this.node(X,$,this.index,T,J)},string:function(){var _=this.index,T=v(this.source,this.index+1);return this.node(R,T.value,_,T.end)},number:function(){var _=this.source,T=this.index,I=T;if(S(_,I)==="-"&&I++,S(_,I)==="0")I++;else if(L(U,S(_,I)))I=this.skip(H,I+1);else throw new y("Failed to parse number at: "+I);if(S(_,I)==="."&&(I=this.skip(H,I+1)),S(_,I)==="e"||S(_,I)==="E"){I++,(S(_,I)==="+"||S(_,I)==="-")&&I++;var $=I;if(I=this.skip(H,I),$===I)throw new y("Failed to parse number's exponent value at: "+I)}return this.node(R,w(M(_,T,I)),T,I)},keyword:function(_){var T=""+_,I=this.index,$=I+T.length;if(M(this.source,I,$)!==T)throw new y("Failed to parse value at: "+I);return this.node(R,_,I,$)},skip:function(_,T){for(var I=this.source;T<I.length&&L(_,S(I,T));T++);return T},until:function(_,T){T=this.skip(P,T);for(var I=S(this.source,T),$=0;$<_.length;$++)if(_[$]===I)return T;throw new y('Unexpected character: "'+I+'" at: '+T)}};var Tt=m(function(){var _="9007199254740993",T;return x(_,function(I,$,J){T=J.source}),T!==_}),Ct=b&&!m(function(){return 1/x("-0 	")!==-1/0});s({target:"JSON",stat:!0,forced:Tt},{parse:function(T,I){return Ct&&!h(I)?x(T):Y(T,I)}})}),5247:((o,e,t)=>{t(1689)}),4979:((o,e,t)=>{var s=t(6518),i=t(4576),n=t(7751),r=t(6980),a=t(4913).f,l=t(9297),h=t(679),c=t(3167),d=t(2603),u=t(5002),f=t(8574),p=t(3724),g=t(6395),m="DOMException",v=n("Error"),b=n(m),A=function(){h(this,w);var P=arguments.length,R=d(P<1?void 0:arguments[0]),X=d(P<2?void 0:arguments[1],"Error"),Y=new b(R,X),st=new v(R);return st.name=m,a(Y,"stack",r(1,f(st.stack,1))),c(Y,this,A),Y},w=A.prototype=b.prototype,y="stack"in new v(m),x="stack"in new b(1,2),E=b&&p&&Object.getOwnPropertyDescriptor(i,m),C=!!E&&!(E.writable&&E.configurable),S=y&&!C&&!x;s({global:!0,constructor:!0,forced:g||S},{DOMException:S?A:b});var M=n(m),L=M.prototype;if(L.constructor!==M){g||a(L,"constructor",r(1,M));for(var G in u)if(l(u,G)){var H=u[G],U=H.s;l(M,U)||a(M,U,r(6,H.c))}}}),4603:((o,e,t)=>{var s=t(6840),i=t(9504),n=t(655),r=t(2812),a=URLSearchParams,l=a.prototype,h=i(l.append),c=i(l.delete),d=i(l.forEach),u=i([].push),f=new a("a=1&a=2&b=3");f.delete("a",1),f.delete("b",void 0),f+""!="a=2"&&s(l,"delete",function(p){var g=arguments.length,m=g<2?void 0:arguments[1];if(g&&m===void 0)return c(this,p);var v=[];d(this,function(S,M){u(v,{key:M,value:S})}),r(g,1);for(var b=n(p),A=n(m),w=0,y=0,x=!1,E=v.length,C;w<E;)C=v[w++],x||C.key===b?(x=!0,c(this,C.key)):y++;for(;y<E;)C=v[y++],C.key===b&&C.value===A||h(this,C.key,C.value)},{enumerable:!0,unsafe:!0})}),7566:((o,e,t)=>{var s=t(6840),i=t(9504),n=t(655),r=t(2812),a=URLSearchParams,l=a.prototype,h=i(l.getAll),c=i(l.has),d=new a("a=1");(d.has("a",2)||!d.has("a",void 0))&&s(l,"has",function(f){var p=arguments.length,g=p<2?void 0:arguments[1];if(p&&g===void 0)return c(this,f);var m=h(this,f);r(p,1);for(var v=n(g),b=0;b<m.length;)if(m[b++]===v)return!0;return!1},{enumerable:!0,unsafe:!0})}),8721:((o,e,t)=>{var s=t(3724),i=t(9504),n=t(2106),r=URLSearchParams.prototype,a=i(r.forEach);s&&!("size"in r)&&n(r,"size",{get:function(){var h=0;return a(this,function(){h++}),h},configurable:!0,enumerable:!0})})},Qi={};function W(o){var e=Qi[o];if(e!==void 0)return e.exports;var t=Qi[o]={exports:{}};return xn[o].call(t.exports,t,t.exports,W),t.exports}W.d=(o,e)=>{for(var t in e)W.o(e,t)&&!W.o(o,t)&&Object.defineProperty(o,t,{enumerable:!0,get:e[t]})};W.o=(o,e)=>Object.prototype.hasOwnProperty.call(o,e);var F=globalThis.pdfjsLib={};W.d(F,{AbortException:()=>Mt,AnnotationEditorLayer:()=>yr,AnnotationEditorParamsType:()=>V,AnnotationEditorType:()=>j,AnnotationEditorUIManager:()=>fe,AnnotationLayer:()=>ki,AnnotationMode:()=>kt,ColorPicker:()=>ls,DOMSVGFactory:()=>be,DrawLayer:()=>zi,FeatureTest:()=>ut,GlobalWorkerOptions:()=>Gt,ImageKind:()=>Le,InvalidPDFException:()=>he,MissingPDFException:()=>zt,OPS:()=>Et,OutputScale:()=>ue,PDFDataRangeTransport:()=>Qe,PDFDateString:()=>Fe,PDFWorker:()=>qt,PasswordResponses:()=>Rn,PermissionFlag:()=>Cn,PixelsPerInch:()=>Ft,RenderingCancelledException:()=>de,TextLayer:()=>me,TouchManager:()=>He,UnexpectedResponseException:()=>se,Util:()=>k,VerbosityLevel:()=>us,XfaLayer:()=>qe,build:()=>mr,createValidAbsoluteUrl:()=>Mn,fetchData:()=>ms,getDocument:()=>ur,getFilenameFromUrl:()=>Hn,getPdfFilenameFromUrl:()=>$n,getXfaPageViewport:()=>jn,isDataScheme:()=>vs,isPdfFile:()=>Xi,noContextMenu:()=>St,normalizeUnicode:()=>Nn,setLayerDimensions:()=>Vt,shadow:()=>z,stopEvent:()=>wt,version:()=>gr});var Ar=W(4114),wr=W(6573),xr=W(8100),Er=W(7936),Sr=W(7467),Tr=W(4732),Cr=W(9577),Rr=W(5247),Ir=W(4979),Pr=W(4603),_r=W(7566),Mr=W(8721),gt=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),fn=[1,0,0,1,0,0],Cs=[.001,0,0,.001,0,0],En=1e7,Me=1.35,Sn=.35,Lr=Sn/Me,At={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},kt={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Tn="pdfjs_internal_editor_",j={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},V={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},Cn={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},ft={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Le={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},ct={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};var ie={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};var us={ERRORS:0,WARNINGS:1,INFOS:5},Et={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},Rn={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},fs=us.WARNINGS;function In(o){Number.isInteger(o)&&(fs=o)}function Pn(){return fs}function ps(o){fs>=us.INFOS&&console.log(`Info: ${o}`)}function B(o){fs>=us.WARNINGS&&console.log(`Warning: ${o}`)}function Z(o){throw new Error(o)}function ht(o,e){o||Z(e)}function _n(o){switch(o?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Mn(o,e=null,t=null){if(!o)return null;try{if(t&&typeof o=="string"&&(t.addDefaultProtocol&&o.startsWith("www.")&&o.match(/\./g)?.length>=2&&(o=`http://${o}`),t.tryConvertEncoding))try{o=kn(o)}catch{}let s=e?new URL(o,e):new URL(o);if(_n(s))return s}catch{}return null}function z(o,e,t,s=!1){return Object.defineProperty(o,e,{value:t,enumerable:!s,configurable:!0,writable:!1}),t}var Bt=(function(){function e(t,s){this.message=t,this.name=s}return e.prototype=new Error,e.constructor=e,e})(),ke=class extends Bt{constructor(e,t){super(e,"PasswordException"),this.code=t}},le=class extends Bt{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}},he=class extends Bt{constructor(e){super(e,"InvalidPDFException")}},zt=class extends Bt{constructor(e){super(e,"MissingPDFException")}},se=class extends Bt{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}},Rs=class extends Bt{constructor(e){super(e,"FormatError")}},Mt=class extends Bt{constructor(e){super(e,"AbortException")}};function pn(o){(typeof o!="object"||o?.length===void 0)&&Z("Invalid argument for bytesToString");let e=o.length,t=8192;if(e<t)return String.fromCharCode.apply(null,o);let s=[];for(let i=0;i<e;i+=t){let n=Math.min(i+t,e),r=o.subarray(i,n);s.push(String.fromCharCode.apply(null,r))}return s.join("")}function gs(o){typeof o!="string"&&Z("Invalid argument for stringToBytes");let e=o.length,t=new Uint8Array(e);for(let s=0;s<e;++s)t[s]=o.charCodeAt(s)&255;return t}function Ln(o){return String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,o&255)}function Vi(o){let e=Object.create(null);for(let[t,s]of o)e[t]=s;return e}function On(){let o=new Uint8Array(4);return o[0]=1,new Uint32Array(o.buffer,0,1)[0]===1}function Dn(){try{return new Function(""),!0}catch{return!1}}var ut=class{static get isLittleEndian(){return z(this,"isLittleEndian",On())}static get isEvalSupported(){return z(this,"isEvalSupported",Dn())}static get isOffscreenCanvasSupported(){return z(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return z(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?z(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof navigator?.userAgent=="string"&&navigator.userAgent.includes("Firefox")}):z(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){return z(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}},ws=Array.from(Array(256).keys(),o=>o.toString(16).padStart(2,"0")),k=class{static makeHexColor(e,t,s){return`#${ws[e]}${ws[t]}${ws[s]}`}static scaleMinMax(e,t){let s;e[0]?(e[0]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[3],t[3]*=e[3]):(s=t[0],t[0]=t[1],t[1]=s,s=t[2],t[2]=t[3],t[3]=s,e[1]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){let s=e[0]*t[0]+e[1]*t[2]+t[4],i=e[0]*t[1]+e[1]*t[3]+t[5];return[s,i]}static applyInverseTransform(e,t){let s=t[0]*t[3]-t[1]*t[2],i=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/s,n=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/s;return[i,n]}static getAxialAlignedBoundingBox(e,t){let s=this.applyTransform(e,t),i=this.applyTransform(e.slice(2,4),t),n=this.applyTransform([e[0],e[3]],t),r=this.applyTransform([e[2],e[1]],t);return[Math.min(s[0],i[0],n[0],r[0]),Math.min(s[1],i[1],n[1],r[1]),Math.max(s[0],i[0],n[0],r[0]),Math.max(s[1],i[1],n[1],r[1])]}static inverseTransform(e){let t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){let t=[e[0],e[2],e[1],e[3]],s=e[0]*t[0]+e[1]*t[2],i=e[0]*t[1]+e[1]*t[3],n=e[2]*t[0]+e[3]*t[2],r=e[2]*t[1]+e[3]*t[3],a=(s+r)/2,l=Math.sqrt((s+r)**2-4*(s*r-n*i))/2,h=a+l||1,c=a-l||1;return[Math.sqrt(h),Math.sqrt(c)]}static normalizeRect(e){let t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){let s=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(s>i)return null;let n=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),r=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return n>r?null:[s,n,i,r]}static#t(e,t,s,i,n,r,a,l,h,c){if(h<=0||h>=1)return;let d=1-h,u=h*h,f=u*h,p=d*(d*(d*e+3*h*t)+3*u*s)+f*i,g=d*(d*(d*n+3*h*r)+3*u*a)+f*l;c[0]=Math.min(c[0],p),c[1]=Math.min(c[1],g),c[2]=Math.max(c[2],p),c[3]=Math.max(c[3],g)}static#e(e,t,s,i,n,r,a,l,h,c,d,u){if(Math.abs(h)<1e-12){Math.abs(c)>=1e-12&&this.#t(e,t,s,i,n,r,a,l,-d/c,u);return}let f=c**2-4*d*h;if(f<0)return;let p=Math.sqrt(f),g=2*h;this.#t(e,t,s,i,n,r,a,l,(-c+p)/g,u),this.#t(e,t,s,i,n,r,a,l,(-c-p)/g,u)}static bezierBoundingBox(e,t,s,i,n,r,a,l,h){return h?(h[0]=Math.min(h[0],e,a),h[1]=Math.min(h[1],t,l),h[2]=Math.max(h[2],e,a),h[3]=Math.max(h[3],t,l)):h=[Math.min(e,a),Math.min(t,l),Math.max(e,a),Math.max(t,l)],this.#e(e,s,n,a,t,i,r,l,3*(-e+3*(s-n)+a),6*(e-2*s+n),3*(s-e),h),this.#e(e,s,n,a,t,i,r,l,3*(-t+3*(i-r)+l),6*(t-2*i+r),3*(i-t),h),h}};function kn(o){return decodeURIComponent(escape(o))}var xs=null,Ji=null;function Nn(o){return xs||(xs=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Ji=new Map([["\uFB05","\u017Ft"]])),o.replaceAll(xs,(e,t,s)=>t?t.normalize("NFKC"):Ji.get(s))}function Fn(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();let o=new Uint8Array(32);return crypto.getRandomValues(o),pn(o)}var Wi="pdfjs_internal_id_";function Bn(o){return Uint8Array.prototype.toBase64?o.toBase64():btoa(pn(o))}var Or=W(4628),Dr=W(7642),kr=W(8004),Nr=W(3853),Fr=W(5876),Br=W(2475),Hr=W(5024),$r=W(1698),jr=W(1454),Ur=W(8992),Gr=W(4743),zr=W(3215),Vr=W(7550),Wr=W(8335),Ot="http://www.w3.org/2000/svg",Ft=class{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF};function ms(o,e="text"){return D(this,null,function*(){if(oe(o,document.baseURI)){let t=yield fetch(o);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,s)=>{let i=new XMLHttpRequest;i.open("GET",o,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})})}var ce=class o{constructor({viewBox:e,userUnit:t,scale:s,rotation:i,offsetX:n=0,offsetY:r=0,dontFlip:a=!1}){this.viewBox=e,this.userUnit=t,this.scale=s,this.rotation=i,this.offsetX=n,this.offsetY=r,s*=t;let l=(e[2]+e[0])/2,h=(e[3]+e[1])/2,c,d,u,f;switch(i%=360,i<0&&(i+=360),i){case 180:c=-1,d=0,u=0,f=1;break;case 90:c=0,d=1,u=1,f=0;break;case 270:c=0,d=-1,u=-1,f=0;break;case 0:c=1,d=0,u=0,f=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(u=-u,f=-f);let p,g,m,v;c===0?(p=Math.abs(h-e[1])*s+n,g=Math.abs(l-e[0])*s+r,m=(e[3]-e[1])*s,v=(e[2]-e[0])*s):(p=Math.abs(l-e[0])*s+n,g=Math.abs(h-e[1])*s+r,m=(e[2]-e[0])*s,v=(e[3]-e[1])*s),this.transform=[c*s,d*s,u*s,f*s,p-c*s*l-u*s*h,g-d*s*l-f*s*h],this.width=m,this.height=v}get rawDims(){let{userUnit:e,viewBox:t}=this,s=t.map(i=>i*e);return z(this,"rawDims",{pageWidth:s[2]-s[0],pageHeight:s[3]-s[1],pageX:s[0],pageY:s[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:n=!1}={}){return new o({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:n})}convertToViewportPoint(e,t){return k.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){let t=k.applyTransform([e[0],e[1]],this.transform),s=k.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],s[0],s[1]]}convertToPdfPoint(e,t){return k.applyInverseTransform([e,t],this.transform)}},de=class extends Bt{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}};function vs(o){let e=o.length,t=0;for(;t<e&&o[t].trim()==="";)t++;return o.substring(t,t+5).toLowerCase()==="data:"}function Xi(o){return typeof o=="string"&&/\.pdf$/i.test(o)}function Hn(o){return[o]=o.split(/[#?]/,1),o.substring(o.lastIndexOf("/")+1)}function $n(o,e="document.pdf"){if(typeof o!="string")return e;if(vs(o))return B('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;let t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,s=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=t.exec(o),n=s.exec(i[1])||s.exec(i[2])||s.exec(i[3]);if(n&&(n=n[0],n.includes("%")))try{n=s.exec(decodeURIComponent(n))[0]}catch{}return n||e}var Ne=class{started=Object.create(null);times=[];time(e){e in this.started&&B(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||B(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){let e=[],t=0;for(let{name:s}of this.times)t=Math.max(s.length,t);for(let{name:s,start:i,end:n}of this.times)e.push(`${s.padEnd(t)} ${n-i}ms
`);return e.join("")}};function oe(o,e){try{let{protocol:t}=e?new URL(o,e):new URL(o);return t==="http:"||t==="https:"}catch{return!1}}function St(o){o.preventDefault()}function wt(o){o.preventDefault(),o.stopPropagation()}var Fe=class{static#t;static toDateObject(e){if(!e||typeof e!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");let t=this.#t.exec(e);if(!t)return null;let s=parseInt(t[1],10),i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let n=parseInt(t[3],10);n=n>=1&&n<=31?n:1;let r=parseInt(t[4],10);r=r>=0&&r<=23?r:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;let h=t[7]||"Z",c=parseInt(t[8],10);c=c>=0&&c<=23?c:0;let d=parseInt(t[9],10)||0;return d=d>=0&&d<=59?d:0,h==="-"?(r+=c,a+=d):h==="+"&&(r-=c,a-=d),new Date(Date.UTC(s,i,n,r,a,l))}};function jn(o,{scale:e=1,rotation:t=0}){let{width:s,height:i}=o.attributes.style,n=[0,0,parseInt(s),parseInt(i)];return new ce({viewBox:n,userUnit:1,scale:e,rotation:t})}function Yi(o){if(o.startsWith("#")){let e=parseInt(o.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return o.startsWith("rgb(")?o.slice(4,-1).split(",").map(e=>parseInt(e)):o.startsWith("rgba(")?o.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(B(`Not a valid color format: "${o}"`),[0,0,0])}function Un(o){let e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(let t of o.keys()){e.style.color=t;let s=window.getComputedStyle(e).color;o.set(t,Yi(s))}e.remove()}function et(o){let{a:e,b:t,c:s,d:i,e:n,f:r}=o.getTransform();return[e,t,s,i,n,r]}function Pt(o){let{a:e,b:t,c:s,d:i,e:n,f:r}=o.getTransform().invertSelf();return[e,t,s,i,n,r]}function Vt(o,e,t=!1,s=!0){if(e instanceof ce){let{pageWidth:i,pageHeight:n}=e.rawDims,{style:r}=o,a=ut.isCSSRoundSupported,l=`var(--scale-factor) * ${i}px`,h=`var(--scale-factor) * ${n}px`,c=a?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,d=a?`round(down, ${h}, var(--scale-round-y, 1px))`:`calc(${h})`;!t||e.rotation%180===0?(r.width=c,r.height=d):(r.width=d,r.height=c)}s&&o.setAttribute("data-main-rotation",e.rotation)}var ue=class{constructor(){let e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}},Is=class o{#t=null;#e=null;#s;#i=null;#r=null;static#n=null;constructor(e){this.#s=e,o.#n||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"})}render(){let e=this.#t=document.createElement("div");e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");let t=this.#s._uiManager._signal;e.addEventListener("contextmenu",St,{signal:t}),e.addEventListener("pointerdown",o.#l,{signal:t});let s=this.#i=document.createElement("div");s.className="buttons",e.append(s);let i=this.#s.toolbarPosition;if(i){let{style:n}=e,r=this.#s._uiManager.direction==="ltr"?1-i[0]:i[0];n.insetInlineEnd=`${100*r}%`,n.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return this.#u(),e}get div(){return this.#t}static#l(e){e.stopPropagation()}#o(e){this.#s._focusEventsAllowed=!1,wt(e)}#c(e){this.#s._focusEventsAllowed=!0,wt(e)}#h(e){let t=this.#s._uiManager._signal;e.addEventListener("focusin",this.#o.bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",this.#c.bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",St,{signal:t})}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#r?.shown()}#u(){let{editorType:e,_uiManager:t}=this.#s,s=document.createElement("button");s.className="delete",s.tabIndex=0,s.setAttribute("data-l10n-id",o.#n[e]),this.#h(s),s.addEventListener("click",i=>{t.delete()},{signal:t._signal}),this.#i.append(s)}get#d(){let e=document.createElement("div");return e.className="divider",e}addAltText(e){return D(this,null,function*(){let t=yield e.render();this.#h(t),this.#i.prepend(t,this.#d),this.#r=e})}addColorPicker(e){this.#e=e;let t=e.renderButton();this.#h(t),this.#i.prepend(t,this.#d)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}},Ps=class{#t=null;#e=null;#s;constructor(e){this.#s=e}#i(){let e=this.#e=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",St,{signal:this.#s._signal});let t=this.#t=document.createElement("div");return t.className="buttons",e.append(t),this.#n(),e}#r(e,t){let s=0,i=0;for(let n of e){let r=n.y+n.height;if(r<s)continue;let a=n.x+(t?n.width:0);if(r>s){i=a,s=r;continue}t?a>i&&(i=a):a<i&&(i=a)}return[t?1-i:i,s]}show(e,t,s){let[i,n]=this.#r(t,s),{style:r}=this.#e||=this.#i();e.append(this.#e),r.insetInlineEnd=`${100*i}%`,r.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#n(){let e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");let t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");let s=this.#s._signal;e.addEventListener("contextmenu",St,{signal:s}),e.addEventListener("click",()=>{this.#s.highlightSelection("floating_button")},{signal:s}),this.#t.append(e)}};function Be(o,e,t){for(let s of t)e.addEventListener(s,o[s].bind(o))}var _s=class{#t=0;get id(){return`${Tn}${this.#t++}`}},Ms=class o{#t=Fn();#e=0;#s=null;static get _isSVGFittingCanvas(){let e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;let n=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return z(this,"_isSVGFittingCanvas",n)}#i(e,t){return D(this,null,function*(){this.#s||=new Map;let s=this.#s.get(e);if(s===null)return null;if(s?.bitmap)return s.refCounter+=1,s;try{s||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let i;if(typeof t=="string"?(s.url=t,i=yield ms(t,"blob")):t instanceof File?i=s.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){let n=o._isSVGFittingCanvas,r=new FileReader,a=new Image,l=new Promise((h,c)=>{a.onload=()=>{s.bitmap=a,s.isSvg=!0,h()},r.onload=()=>D(this,null,function*(){let d=s.svgUrl=r.result;a.src=(yield n)?`${d}#svgView(preserveAspectRatio(none))`:d}),a.onerror=r.onerror=c});r.readAsDataURL(i),yield l}else s.bitmap=yield createImageBitmap(i);s.refCounter=1}catch(i){B(i),s=null}return this.#s.set(e,s),s&&this.#s.set(s.id,s),s})}getFromFile(e){return D(this,null,function*(){let{lastModified:t,name:s,size:i,type:n}=e;return this.#i(`${t}_${s}_${i}_${n}`,e)})}getFromUrl(e){return D(this,null,function*(){return this.#i(e,e)})}getFromBlob(e,t){return D(this,null,function*(){let s=yield t;return this.#i(e,s)})}getFromId(e){return D(this,null,function*(){this.#s||=new Map;let t=this.#s.get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){let{blobPromise:s}=t;return delete t.blobPromise,this.getFromBlob(t.id,s)}return this.getFromUrl(t.url)})}getFromCanvas(e,t){this.#s||=new Map;let s=this.#s.get(e);if(s?.bitmap)return s.refCounter+=1,s;let i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#s.set(e,s),this.#s.set(s.id,s),s}getSvgUrl(e){let t=this.#s.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#s||=new Map;let t=this.#s.get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;let{bitmap:s}=t;if(!t.url&&!t.file){let i=new OffscreenCanvas(s.width,s.height);i.getContext("bitmaprenderer").transferFromImageBitmap(s),t.blobPromise=i.convertToBlob()}s.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#t}_`)}},Ls=class{#t=[];#e=!1;#s;#i=-1;constructor(e=128){this.#s=e}add({cmd:e,undo:t,post:s,mustExec:i,type:n=NaN,overwriteIfSameType:r=!1,keepUndo:a=!1}){if(i&&e(),this.#e)return;let l={cmd:e,undo:t,post:s,type:n};if(this.#i===-1){this.#t.length>0&&(this.#t.length=0),this.#i=0,this.#t.push(l);return}if(r&&this.#t[this.#i].type===n){a&&(l.undo=this.#t[this.#i].undo),this.#t[this.#i]=l;return}let h=this.#i+1;h===this.#s?this.#t.splice(0,1):(this.#i=h,h<this.#t.length&&this.#t.splice(h)),this.#t.push(l)}undo(){if(this.#i===-1)return;this.#e=!0;let{undo:e,post:t}=this.#t[this.#i];e(),t?.(),this.#e=!1,this.#i-=1}redo(){if(this.#i<this.#t.length-1){this.#i+=1,this.#e=!0;let{cmd:e,post:t}=this.#t[this.#i];e(),t?.(),this.#e=!1}}hasSomethingToUndo(){return this.#i!==-1}hasSomethingToRedo(){return this.#i<this.#t.length-1}cleanType(e){if(this.#i!==-1){for(let t=this.#i;t>=0;t--)if(this.#t[t].type!==e){this.#t.splice(t+1,this.#i-t),this.#i=t;return}this.#t.length=0,this.#i=-1}}destroy(){this.#t=null}},Wt=class{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:t}=ut.platform;for(let[s,i,n={}]of e)for(let r of s){let a=r.startsWith("mac+");t&&a?(this.callbacks.set(r.slice(4),{callback:i,options:n}),this.allKeys.add(r.split("+").at(-1))):!t&&!a&&(this.callbacks.set(r,{callback:i,options:n}),this.allKeys.add(r.split("+").at(-1)))}}#t(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);let t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;let s=this.callbacks.get(this.#t(t));if(!s)return;let{callback:i,options:{bubbles:n=!1,args:r=[],checker:a=null}}=s;a&&!a(e,t)||(i.bind(e,...r,t)(),n||wt(t))}},Os=class o{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){let e=new Map([["CanvasText",null],["Canvas",null]]);return Un(e),z(this,"_colors",e)}convert(e){let t=Yi(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(let[s,i]of this._colors)if(i.every((n,r)=>n===t[r]))return o._colorsMapping.get(s);return t}getHexCode(e){let t=this._colors.get(e);return t?k.makeHexColor(...t):e}},fe=(()=>{class o{#t=new AbortController;#e=null;#s=new Map;#i=new Map;#r=null;#n=null;#l=null;#o=new Ls;#c=null;#h=null;#u=0;#d=new Set;#f=null;#a=null;#p=new Set;_editorUndoBar=null;#m=!1;#g=!1;#v=!1;#A=null;#b=null;#w=null;#E=null;#T=!1;#R=null;#P=new _s;#x=!1;#I=!1;#C=null;#M=null;#D=null;#N=null;#S=j.NONE;#y=new Set;#O=null;#j=null;#U=null;#G={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#F=[0,0];#k=null;#B=null;#z=null;#L=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){let t=o.prototype,s=a=>a.#B.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),i=(a,{target:l})=>{if(l instanceof HTMLInputElement){let{type:h}=l;return h!=="text"&&h!=="number"}return!0},n=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return z(this,"_keyboardManager",new Wt([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],t.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:i}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(a,{target:l})=>!(l instanceof HTMLButtonElement)&&a.#B.contains(l)&&!a.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(a,{target:l})=>!(l instanceof HTMLButtonElement)&&a.#B.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-r,0],checker:s}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[r,0],checker:s}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-r],checker:s}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,r],checker:s}]]))}constructor(t,s,i,n,r,a,l,h,c,d,u,f,p){let g=this._signal=this.#t.signal;this.#B=t,this.#z=s,this.#r=i,this._eventBus=n,n._on("editingaction",this.onEditingAction.bind(this),{signal:g}),n._on("pagechanging",this.onPageChanging.bind(this),{signal:g}),n._on("scalechanging",this.onScaleChanging.bind(this),{signal:g}),n._on("rotationchanging",this.onRotationChanging.bind(this),{signal:g}),n._on("setpreference",this.onSetPreference.bind(this),{signal:g}),n._on("switchannotationeditorparams",m=>this.updateParams(m.type,m.value),{signal:g}),this.#et(),this.#rt(),this.#Y(),this.#n=r.annotationStorage,this.#A=r.filterFactory,this.#j=a,this.#E=l||null,this.#m=h,this.#g=c,this.#v=d,this.#N=u||null,this.viewParameters={realScale:Ft.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=f||null,this._supportsPinchToZoom=p!==!1}destroy(){this.#L?.resolve(),this.#L=null,this.#t?.abort(),this.#t=null,this._signal=null;for(let t of this.#i.values())t.destroy();this.#i.clear(),this.#s.clear(),this.#p.clear(),this.#e=null,this.#y.clear(),this.#o.destroy(),this.#r?.destroy(),this.#R?.hide(),this.#R=null,this.#b&&(clearTimeout(this.#b),this.#b=null),this.#k&&(clearTimeout(this.#k),this.#k=null),this._editorUndoBar?.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#N}get useNewAltTextFlow(){return this.#g}get useNewAltTextWhenAddingImage(){return this.#v}get hcmFilter(){return z(this,"hcmFilter",this.#j?this.#A.addHCMFilter(this.#j.foreground,this.#j.background):"none")}get direction(){return z(this,"direction",getComputedStyle(this.#B).direction)}get highlightColors(){return z(this,"highlightColors",this.#E?new Map(this.#E.split(",").map(t=>t.split("=").map(s=>s.trim()))):null)}get highlightColorNames(){return z(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#h=t}setMainHighlightColorPicker(t){this.#D=t}editAltText(t,s=!1){this.#r?.editAltText(this,t,s)}switchToMode(t,s){this._eventBus.on("annotationeditormodechanged",s,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,s){this._eventBus.dispatch("setpreference",{source:this,name:t,value:s})}onSetPreference({name:t,value:s}){switch(t){case"enableNewAltTextWhenAddingImage":this.#v=s;break}}onPageChanging({pageNumber:t}){this.#u=t-1}focusMainContainer(){this.#B.focus()}findParent(t,s){for(let i of this.#i.values()){let{x:n,y:r,width:a,height:l}=i.div.getBoundingClientRect();if(t>=n&&t<=n+a&&s>=r&&s<=r+l)return i}return null}disableUserSelect(t=!1){this.#z.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#p.add(t)}removeShouldRescale(t){this.#p.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*Ft.PDF_TO_CSS_UNITS;for(let s of this.#p)s.onScaleChanging();this.#h?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#H({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#X(t){let{currentLayer:s}=this;if(s.hasTextLayer(t))return s;for(let i of this.#i.values())if(i.hasTextLayer(t))return i;return null}highlightSelection(t=""){let s=document.getSelection();if(!s||s.isCollapsed)return;let{anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:a}=s,l=s.toString(),c=this.#H(s).closest(".textLayer"),d=this.getSelectionBoxes(c);if(!d)return;s.empty();let u=this.#X(c),f=this.#S===j.NONE,p=()=>{u?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:d,anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:a,text:l}),f&&this.showAllEditors("highlight",!0,!0)};if(f){this.switchToMode(j.HIGHLIGHT,p);return}p()}#q(){let t=document.getSelection();if(!t||t.isCollapsed)return;let i=this.#H(t).closest(".textLayer"),n=this.getSelectionBoxes(i);n&&(this.#R||=new Ps(this),this.#R.show(i,n,this.direction==="ltr"))}addToAnnotationStorage(t){!t.isEmpty()&&this.#n&&!this.#n.has(t.id)&&this.#n.setValue(t.id,t)}#tt(){let t=document.getSelection();if(!t||t.isCollapsed){this.#O&&(this.#R?.hide(),this.#O=null,this.#_({hasSelectedText:!1}));return}let{anchorNode:s}=t;if(s===this.#O)return;let n=this.#H(t).closest(".textLayer");if(!n){this.#O&&(this.#R?.hide(),this.#O=null,this.#_({hasSelectedText:!1}));return}if(this.#R?.hide(),this.#O=s,this.#_({hasSelectedText:!0}),!(this.#S!==j.HIGHLIGHT&&this.#S!==j.NONE)&&(this.#S===j.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#T=this.isShiftKeyDown,!this.isShiftKeyDown)){let r=this.#S===j.HIGHLIGHT?this.#X(n):null;r?.toggleDrawing();let a=new AbortController,l=this.combinedSignal(a),h=c=>{c.type==="pointerup"&&c.button!==0||(a.abort(),r?.toggleDrawing(!0),c.type==="pointerup"&&this.#W("main_toolbar"))};window.addEventListener("pointerup",h,{signal:l}),window.addEventListener("blur",h,{signal:l})}}#W(t=""){this.#S===j.HIGHLIGHT?this.highlightSelection(t):this.#m&&this.#q()}#et(){document.addEventListener("selectionchange",this.#tt.bind(this),{signal:this._signal})}#st(){if(this.#w)return;this.#w=new AbortController;let t=this.combinedSignal(this.#w);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#it(){this.#w?.abort(),this.#w=null}blur(){if(this.isShiftKeyDown=!1,this.#T&&(this.#T=!1,this.#W("main_toolbar")),!this.hasSelection)return;let{activeElement:t}=document;for(let s of this.#y)if(s.div.contains(t)){this.#M=[s,t],s._focusEventsAllowed=!1;break}}focus(){if(!this.#M)return;let[t,s]=this.#M;this.#M=null,s.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),s.focus()}#Y(){if(this.#C)return;this.#C=new AbortController;let t=this.combinedSignal(this.#C);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#nt(){this.#C?.abort(),this.#C=null}#K(){if(this.#c)return;this.#c=new AbortController;let t=this.combinedSignal(this.#c);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#Q(){this.#c?.abort(),this.#c=null}#rt(){let t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#Y(),this.#K()}removeEditListeners(){this.#nt(),this.#Q()}dragOver(t){for(let{type:s}of t.dataTransfer.items)for(let i of this.#a)if(i.isHandlingMimeForPasting(s)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(let s of t.dataTransfer.items)for(let i of this.#a)if(i.isHandlingMimeForPasting(s.type)){i.paste(s,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;let s=[];for(let i of this.#y){let n=i.serialize(!0);n&&s.push(n)}s.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(s))}cut(t){this.copy(t),this.delete()}paste(t){return D(this,null,function*(){t.preventDefault();let{clipboardData:s}=t;for(let r of s.items)for(let a of this.#a)if(a.isHandlingMimeForPasting(r.type)){a.paste(r,this.currentLayer);return}let i=s.getData("application/pdfjs");if(!i)return;try{i=JSON.parse(i)}catch(r){B(`paste: "${r.message}".`);return}if(!Array.isArray(i))return;this.unselectAll();let n=this.currentLayer;try{let r=[];for(let h of i){let c=yield n.deserialize(h);if(!c)return;r.push(c)}let a=()=>{for(let h of r)this.#J(h);this.#Z(r)},l=()=>{for(let h of r)h.remove()};this.addCommands({cmd:a,undo:l,mustExec:!0})}catch(r){B(`paste: "${r.message}".`)}})}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#S!==j.NONE&&!this.isEditorHandlingKeyboard&&o._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#T&&(this.#T=!1,this.#W("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#_(t){Object.entries(t).some(([i,n])=>this.#G[i]!==n)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#G,t)}),this.#S===j.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#$([[V.HIGHLIGHT_FREE,!0]]))}#$(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#st(),this.#K(),this.#_({isEditing:this.#S!==j.NONE,isEmpty:this.#V(),hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:this.#o.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#it(),this.#Q(),this.#_({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#a){this.#a=t;for(let s of this.#a)this.#$(s.defaultPropertiesToUpdate)}}getId(){return this.#P.id}get currentLayer(){return this.#i.get(this.#u)}getLayer(t){return this.#i.get(t)}get currentPageIndex(){return this.#u}addLayer(t){this.#i.set(t.pageIndex,t),this.#x?t.enable():t.disable()}removeLayer(t){this.#i.delete(t.pageIndex)}updateMode(t,s=null,i=!1){return D(this,null,function*(){if(this.#S!==t&&!(this.#L&&(yield this.#L.promise,!this.#L))){if(this.#L=Promise.withResolvers(),this.#S=t,t===j.NONE){this.setEditingState(!1),this.#ot(),this._editorUndoBar?.hide(),this.#L.resolve();return}this.setEditingState(!0),yield this.#at(),this.unselectAll();for(let n of this.#i.values())n.updateMode(t);if(!s){i&&this.addNewEditorFromKeyboard(),this.#L.resolve();return}for(let n of this.#s.values())n.annotationElementId===s?(this.setSelected(n),n.enterInEditMode()):n.unselect();this.#L.resolve()}})}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t!==this.#S&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,s){if(this.#a){switch(t){case V.CREATE:this.currentLayer.addNewEditor();return;case V.HIGHLIGHT_DEFAULT_COLOR:this.#D?.updateColor(s);break;case V.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#U||=new Map).set(t,s),this.showAllEditors("highlight",s);break}for(let i of this.#y)i.updateParams(t,s);for(let i of this.#a)i.updateDefaultParams(t,s)}}showAllEditors(t,s,i=!1){for(let r of this.#s.values())r.editorType===t&&r.show(s);(this.#U?.get(V.HIGHLIGHT_SHOW_ALL)??!0)!==s&&this.#$([[V.HIGHLIGHT_SHOW_ALL,s]])}enableWaiting(t=!1){if(this.#I!==t){this.#I=t;for(let s of this.#i.values())t?s.disableClick():s.enableClick(),s.div.classList.toggle("waiting",t)}}#at(){return D(this,null,function*(){if(!this.#x){this.#x=!0;let t=[];for(let s of this.#i.values())t.push(s.enable());yield Promise.all(t);for(let s of this.#s.values())s.enable()}})}#ot(){if(this.unselectAll(),this.#x){this.#x=!1;for(let t of this.#i.values())t.disable();for(let t of this.#s.values())t.disable()}}getEditors(t){let s=[];for(let i of this.#s.values())i.pageIndex===t&&s.push(i);return s}getEditor(t){return this.#s.get(t)}addEditor(t){this.#s.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#b&&clearTimeout(this.#b),this.#b=setTimeout(()=>{this.focusMainContainer(),this.#b=null},0)),this.#s.delete(t.id),this.unselect(t),(!t.annotationElementId||!this.#d.has(t.annotationElementId))&&this.#n?.remove(t.id)}addDeletedAnnotationElement(t){this.#d.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#d.has(t)}removeDeletedAnnotationElement(t){this.#d.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#J(t){let s=this.#i.get(t.pageIndex);s?s.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#$(t.propertiesToUpdate))}get#lt(){let t=null;for(t of this.#y);return t}updateUI(t){this.#lt===t&&this.#$(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#$(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#y.has(t)){this.#y.delete(t),t.unselect(),this.#_({hasSelectedEditor:this.hasSelection});return}this.#y.add(t),t.select(),this.#$(t.propertiesToUpdate),this.#_({hasSelectedEditor:!0})}setSelected(t){this.#h?.commitOrRemove();for(let s of this.#y)s!==t&&s.unselect();this.#y.clear(),this.#y.add(t),t.select(),this.#$(t.propertiesToUpdate),this.#_({hasSelectedEditor:!0})}isSelected(t){return this.#y.has(t)}get firstSelectedEditor(){return this.#y.values().next().value}unselect(t){t.unselect(),this.#y.delete(t),this.#_({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#y.size!==0}get isEnterHandled(){return this.#y.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#o.undo(),this.#_({hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#V()}),this._editorUndoBar?.hide()}redo(){this.#o.redo(),this.#_({hasSomethingToUndo:!0,hasSomethingToRedo:this.#o.hasSomethingToRedo(),isEmpty:this.#V()})}addCommands(t){this.#o.add(t),this.#_({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#V()})}cleanUndoStack(t){this.#o.cleanType(t)}#V(){if(this.#s.size===0)return!0;if(this.#s.size===1)for(let t of this.#s.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();let t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;let s=t?[t]:[...this.#y],i=()=>{this._editorUndoBar?.show(n,s.length===1?s[0].editorType:s.length);for(let r of s)r.remove()},n=()=>{for(let r of s)this.#J(r)};this.addCommands({cmd:i,undo:n,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#Z(t){for(let s of this.#y)s.unselect();this.#y.clear();for(let s of t)s.isEmpty()||(this.#y.add(s),s.select());this.#_({hasSelectedEditor:this.hasSelection})}selectAll(){for(let t of this.#y)t.commit();this.#Z(this.#s.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#S!==j.NONE))&&!this.#h?.commitOrRemove()&&this.hasSelection){for(let t of this.#y)t.unselect();this.#y.clear(),this.#_({hasSelectedEditor:!1})}}translateSelectedEditors(t,s,i=!1){if(i||this.commitOrRemove(),!this.hasSelection)return;this.#F[0]+=t,this.#F[1]+=s;let[n,r]=this.#F,a=[...this.#y],l=1e3;this.#k&&clearTimeout(this.#k),this.#k=setTimeout(()=>{this.#k=null,this.#F[0]=this.#F[1]=0,this.addCommands({cmd:()=>{for(let h of a)this.#s.has(h.id)&&h.translateInPage(n,r)},undo:()=>{for(let h of a)this.#s.has(h.id)&&h.translateInPage(-n,-r)},mustExec:!1})},l);for(let h of a)h.translateInPage(t,s)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#f=new Map;for(let t of this.#y)this.#f.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#f)return!1;this.disableUserSelect(!1);let t=this.#f;this.#f=null;let s=!1;for(let[{x:n,y:r,pageIndex:a},l]of t)l.newX=n,l.newY=r,l.newPageIndex=a,s||=n!==l.savedX||r!==l.savedY||a!==l.savedPageIndex;if(!s)return!1;let i=(n,r,a,l)=>{if(this.#s.has(n.id)){let h=this.#i.get(l);h?n._setParentAndPosition(h,r,a):(n.pageIndex=l,n.x=r,n.y=a)}};return this.addCommands({cmd:()=>{for(let[n,{newX:r,newY:a,newPageIndex:l}]of t)i(n,r,a,l)},undo:()=>{for(let[n,{savedX:r,savedY:a,savedPageIndex:l}]of t)i(n,r,a,l)},mustExec:!0}),!0}dragSelectedEditors(t,s){if(this.#f)for(let i of this.#f.keys())i.drag(t,s)}rebuild(t){if(t.parent===null){let s=this.getLayer(t.pageIndex);s?(s.changeParent(t),s.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#y.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#S}get imageManager(){return z(this,"imageManager",new Ms)}getSelectionBoxes(t){if(!t)return null;let s=document.getSelection();for(let c=0,d=s.rangeCount;c<d;c++)if(!t.contains(s.getRangeAt(c).commonAncestorContainer))return null;let{x:i,y:n,width:r,height:a}=t.getBoundingClientRect(),l;switch(t.getAttribute("data-main-rotation")){case"90":l=(c,d,u,f)=>({x:(d-n)/a,y:1-(c+u-i)/r,width:f/a,height:u/r});break;case"180":l=(c,d,u,f)=>({x:1-(c+u-i)/r,y:1-(d+f-n)/a,width:u/r,height:f/a});break;case"270":l=(c,d,u,f)=>({x:1-(d+f-n)/a,y:(c-i)/r,width:f/a,height:u/r});break;default:l=(c,d,u,f)=>({x:(c-i)/r,y:(d-n)/a,width:u/r,height:f/a});break}let h=[];for(let c=0,d=s.rangeCount;c<d;c++){let u=s.getRangeAt(c);if(!u.collapsed)for(let{x:f,y:p,width:g,height:m}of u.getClientRects())g===0||m===0||h.push(l(f,p,g,m))}return h.length===0?null:h}addChangedExistingAnnotation({annotationElementId:t,id:s}){(this.#l||=new Map).set(t,s)}removeChangedExistingAnnotation({annotationElementId:t}){this.#l?.delete(t)}renderAnnotationElement(t){let s=this.#l?.get(t.data.id);if(!s)return;let i=this.#n.getRawValue(s);i&&(this.#S===j.NONE&&!i.hasBeenModified||i.renderAnnotationElement(t))}}return o})(),Zi=(()=>{class o{#t=null;#e=!1;#s=null;#i=null;#r=null;#n=null;#l=!1;#o=null;#c=null;#h=null;#u=null;#d=!1;static#f=null;static _l10n=null;constructor(t){this.#c=t,this.#d=t._uiManager.useNewAltTextFlow,o.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){o._l10n??=t}render(){return D(this,null,function*(){let t=this.#s=document.createElement("button");t.className="altText",t.tabIndex="0";let s=this.#i=document.createElement("span");t.append(s),this.#d?(t.classList.add("new"),t.setAttribute("data-l10n-id",o.#f.missing),s.setAttribute("data-l10n-id",o.#f["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),s.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));let i=this.#c._uiManager._signal;t.addEventListener("contextmenu",St,{signal:i}),t.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:i});let n=r=>{r.preventDefault(),this.#c._uiManager.editAltText(this.#c),this.#d&&this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#a}})};return t.addEventListener("click",n,{capture:!0,signal:i}),t.addEventListener("keydown",r=>{r.target===t&&r.key==="Enter"&&(this.#l=!0,n(r))},{signal:i}),yield this.#p(),t})}get#a(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#s&&(this.#s.focus({focusVisible:this.#l}),this.#l=!1)}isEmpty(){return this.#d?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#d?this.#t!==null||!!this.#h:this.isEmpty()}get guessedText(){return this.#h}setGuessedText(t){return D(this,null,function*(){this.#t===null&&(this.#h=t,this.#u=yield o._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#p())})}toggleAltTextBadge(t=!1){if(!this.#d||this.#t){this.#o?.remove(),this.#o=null;return}if(!this.#o){let s=this.#o=document.createElement("div");s.className="noAltTextBadge",this.#c.div.append(s)}this.#o.classList.toggle("hidden",!t)}serialize(t){let s=this.#t;return!t&&this.#h===s&&(s=this.#u),{altText:s,decorative:this.#e,guessedText:this.#h,textWithDisclaimer:this.#u}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:s,guessedText:i,textWithDisclaimer:n,cancel:r=!1}){i&&(this.#h=i,this.#u=n),!(this.#t===t&&this.#e===s)&&(r||(this.#t=t,this.#e=s),this.#p())}toggle(t=!1){this.#s&&(!t&&this.#n&&(clearTimeout(this.#n),this.#n=null),this.#s.disabled=!t)}shown(){this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#a}})}destroy(){this.#s?.remove(),this.#s=null,this.#i=null,this.#r=null,this.#o?.remove(),this.#o=null}#p(){return D(this,null,function*(){let t=this.#s;if(!t)return;if(this.#d){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",o.#f[this.#a]),this.#i?.setAttribute("data-l10n-id",o.#f[`${this.#a}-label`]),!this.#t){this.#r?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#r?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let s=this.#r;if(!s){this.#r=s=document.createElement("span"),s.className="tooltip",s.setAttribute("role","tooltip"),s.id=`alt-text-tooltip-${this.#c.id}`;let n=100,r=this.#c._uiManager._signal;r.addEventListener("abort",()=>{clearTimeout(this.#n),this.#n=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#n=setTimeout(()=>{this.#n=null,this.#r.classList.add("show"),this.#c._reportTelemetry({action:"alt_text_tooltip"})},n)},{signal:r}),t.addEventListener("mouseleave",()=>{this.#n&&(clearTimeout(this.#n),this.#n=null),this.#r?.classList.remove("show")},{signal:r})}this.#e?s.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(s.removeAttribute("data-l10n-id"),s.textContent=this.#t),s.parentNode||t.append(s),this.#c.getImageForAltText()?.setAttribute("aria-describedby",s.id)})}}return o})(),He=class o{#t;#e=!1;#s=null;#i;#r;#n;#l;#o;#c=null;#h;#u=null;constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:n=null,onPinchEnd:r=null,signal:a}){this.#t=e,this.#s=s,this.#i=t,this.#r=i,this.#n=n,this.#l=r,this.#h=new AbortController,this.#o=AbortSignal.any([a,this.#h.signal]),e.addEventListener("touchstart",this.#d.bind(this),{passive:!1,signal:this.#o})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return z(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}#d(e){if(this.#i?.()||e.touches.length<2)return;if(!this.#u){this.#u=new AbortController;let i=AbortSignal.any([this.#o,this.#u.signal]),n=this.#t,r={signal:i,passive:!1};n.addEventListener("touchmove",this.#f.bind(this),r),n.addEventListener("touchend",this.#a.bind(this),r),n.addEventListener("touchcancel",this.#a.bind(this),r),this.#r?.()}if(wt(e),e.touches.length!==2||this.#s?.()){this.#c=null;return}let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]),this.#c={touch0X:t.screenX,touch0Y:t.screenY,touch1X:s.screenX,touch1Y:s.screenY}}#f(e){if(!this.#c||e.touches.length!==2)return;let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]);let{screenX:i,screenY:n}=t,{screenX:r,screenY:a}=s,l=this.#c,{touch0X:h,touch0Y:c,touch1X:d,touch1Y:u}=l,f=d-h,p=u-c,g=r-i,m=a-n,v=Math.hypot(g,m)||1,b=Math.hypot(f,p)||1;if(!this.#e&&Math.abs(b-v)<=o.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=i,l.touch0Y=n,l.touch1X=r,l.touch1Y=a,e.preventDefault(),!this.#e){this.#e=!0;return}let A=[(i+r)/2,(n+a)/2];this.#n?.(A,b,v)}#a(e){this.#u.abort(),this.#u=null,this.#l?.(),this.#c&&(e.preventDefault(),this.#c=null,this.#e=!1)}destroy(){this.#h?.abort(),this.#h=null}},it=class o{#t=null;#e=null;#s=null;#i=!1;#r=null;#n="";#l=!1;#o=null;#c=null;#h=null;#u=null;#d="";#f=!1;#a=null;#p=!1;#m=!1;#g=!1;#v=null;#A=0;#b=0;#w=null;#E=null;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#T=!1;#R=o._zIndex++;static _borderLineWidth=-1;static _colorManager=new Os;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){let e=o.prototype._resizeWithKeyboard,t=fe.TRANSLATE_SMALL,s=fe.TRANSLATE_BIG;return z(this,"_resizerKeyboardManager",new Wt([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,s]}],[["Escape","mac+Escape"],o.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;let{rotation:t,rawDims:{pageWidth:s,pageHeight:i,pageX:n,pageY:r}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[n,r];let[a,l]=this.parentDimensions;this.x=e.x/a,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return z(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){let t=new Ds({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(o._l10n??=e,o._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),o._borderLineWidth!==-1)return;let s=getComputedStyle(document.documentElement);o._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Z("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#T}set _isDraggable(e){this.#T=e,this.div?.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){let[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#R}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):this.#H(),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#f?this.#f=!1:this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,s,i){let[n,r]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(e+s)/n,this.y=(t+i)/r,this.fixAndSetPosition()}#P([e,t],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/e,this.y+=i/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,t){this.#P(this.parentDimensions,e,t)}translateInPage(e,t){this.#a||=[this.x,this.y,this.width,this.height],this.#P(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){this.#a||=[this.x,this.y,this.width,this.height];let{div:s,parentDimensions:[i,n]}=this;if(this.x+=e/i,this.y+=t/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:d,y:u}=this.div.getBoundingClientRect();this.parent.findNewParent(this,d,u)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:a}=this,[l,h]=this.getBaseTranslation();r+=l,a+=h;let{style:c}=s;c.left=`${(100*r).toFixed(2)}%`,c.top=`${(100*a).toFixed(2)}%`,this._onTranslating(r,a),s.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!this.#a&&(this.#a[0]!==this.x||this.#a[1]!==this.y)}get _hasBeenResized(){return!!this.#a&&(this.#a[2]!==this.width||this.#a[3]!==this.height)}getBaseTranslation(){let[e,t]=this.parentDimensions,{_borderLineWidth:s}=o,i=s/e,n=s/t;switch(this.rotation){case 90:return[-i,n];case 180:return[i,n];case 270:return[i,-n];default:return[-i,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){let{div:{style:t},pageDimensions:[s,i]}=this,{x:n,y:r,width:a,height:l}=this;if(a*=s,l*=i,n*=s,r*=i,this._mustFixPosition)switch(e){case 0:n=Math.max(0,Math.min(s-a,n)),r=Math.max(0,Math.min(i-l,r));break;case 90:n=Math.max(0,Math.min(s-l,n)),r=Math.min(i,Math.max(a,r));break;case 180:n=Math.min(s,Math.max(a,n)),r=Math.min(i,Math.max(l,r));break;case 270:n=Math.min(s,Math.max(l,n)),r=Math.max(0,Math.min(i-a,r));break}this.x=n/=s,this.y=r/=i;let[h,c]=this.getBaseTranslation();n+=h,r+=c,t.left=`${(100*n).toFixed(2)}%`,t.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}static#x(e,t,s){switch(s){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return o.#x(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return o.#x(e,t,360-this.parentRotation)}#I(e){switch(e){case 90:{let[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{let[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:e,pageDimensions:[t,s]}=this;return[t*e,s*e]}setDims(e,t){let[s,i]=this.parentDimensions,{style:n}=this.div;n.width=`${(100*e/s).toFixed(2)}%`,this.#l||(n.height=`${(100*t/i).toFixed(2)}%`)}fixDims(){let{style:e}=this.div,{height:t,width:s}=e,i=s.endsWith("%"),n=!this.#l&&t.endsWith("%");if(i&&n)return;let[r,a]=this.parentDimensions;i||(e.width=`${(100*parseFloat(s)/r).toFixed(2)}%`),!this.#l&&!n&&(e.height=`${(100*parseFloat(t)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#C(){if(this.#o)return;this.#o=document.createElement("div"),this.#o.classList.add("resizers");let e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(let s of e){let i=document.createElement("div");this.#o.append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",this.#M.bind(this,s),{signal:t}),i.addEventListener("contextmenu",St,{signal:t}),i.tabIndex=-1}this.div.prepend(this.#o)}#M(e,t){t.preventDefault();let{isMac:s}=ut.platform;if(t.button!==0||t.ctrlKey&&s)return;this.#s?.toggle(!1);let i=this._isDraggable;this._isDraggable=!1,this.#c=[t.screenX,t.screenY];let n=new AbortController,r=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#S.bind(this,e),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",wt,{passive:!1,signal:r}),window.addEventListener("contextmenu",St,{signal:r}),this.#h={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;let h=()=>{n.abort(),this.parent.togglePointerEvents(!0),this.#s?.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=a,this.div.style.cursor=l,this.#N()};window.addEventListener("pointerup",h,{signal:r}),window.addEventListener("blur",h,{signal:r})}#D(e,t,s,i){this.width=s,this.height=i,this.x=e,this.y=t;let[n,r]=this.parentDimensions;this.setDims(n*s,r*i),this.fixAndSetPosition(),this._onResized()}_onResized(){}#N(){if(!this.#h)return;let{savedX:e,savedY:t,savedWidth:s,savedHeight:i}=this.#h;this.#h=null;let n=this.x,r=this.y,a=this.width,l=this.height;n===e&&r===t&&a===s&&l===i||this.addCommands({cmd:this.#D.bind(this,n,r,a,l),undo:this.#D.bind(this,e,t,s,i),mustExec:!0})}static _round(e){return Math.round(e*1e4)/1e4}#S(e,t){let[s,i]=this.parentDimensions,n=this.x,r=this.y,a=this.width,l=this.height,h=o.MIN_SIZE/s,c=o.MIN_SIZE/i,d=this.#I(this.rotation),u=(P,R)=>[d[0]*P+d[2]*R,d[1]*P+d[3]*R],f=this.#I(360-this.rotation),p=(P,R)=>[f[0]*P+f[2]*R,f[1]*P+f[3]*R],g,m,v=!1,b=!1;switch(e){case"topLeft":v=!0,g=(P,R)=>[0,0],m=(P,R)=>[P,R];break;case"topMiddle":g=(P,R)=>[P/2,0],m=(P,R)=>[P/2,R];break;case"topRight":v=!0,g=(P,R)=>[P,0],m=(P,R)=>[0,R];break;case"middleRight":b=!0,g=(P,R)=>[P,R/2],m=(P,R)=>[0,R/2];break;case"bottomRight":v=!0,g=(P,R)=>[P,R],m=(P,R)=>[0,0];break;case"bottomMiddle":g=(P,R)=>[P/2,R],m=(P,R)=>[P/2,0];break;case"bottomLeft":v=!0,g=(P,R)=>[0,R],m=(P,R)=>[P,0];break;case"middleLeft":b=!0,g=(P,R)=>[0,R/2],m=(P,R)=>[P,R/2];break}let A=g(a,l),w=m(a,l),y=u(...w),x=o._round(n+y[0]),E=o._round(r+y[1]),C=1,S=1,M,L;if(t.fromKeyboard)({deltaX:M,deltaY:L}=t);else{let{screenX:P,screenY:R}=t,[X,Y]=this.#c;[M,L]=this.screenToPageTranslation(P-X,R-Y),this.#c[0]=P,this.#c[1]=R}if([M,L]=p(M/s,L/i),v){let P=Math.hypot(a,l);C=S=Math.max(Math.min(Math.hypot(w[0]-A[0]-M,w[1]-A[1]-L)/P,1/a,1/l),h/a,c/l)}else b?C=Math.max(h,Math.min(1,Math.abs(w[0]-A[0]-M)))/a:S=Math.max(c,Math.min(1,Math.abs(w[1]-A[1]-L)))/l;let G=o._round(a*C),H=o._round(l*S);y=u(...m(G,H));let U=x-y[0],q=E-y[1];this.#a||=[this.x,this.y,this.width,this.height],this.width=G,this.height=H,this.x=U,this.y=q,this.setDims(s*G,i*H),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#s?.finish()}addEditToolbar(){return D(this,null,function*(){return this._editToolbar||this.#m?this._editToolbar:(this._editToolbar=new Is(this),this.div.append(this._editToolbar.render()),this.#s&&(yield this._editToolbar.addAltText(this.#s)),this._editToolbar)})}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#s?.destroy())}addContainer(e){let t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}addAltTextButton(){return D(this,null,function*(){this.#s||(Zi.initialize(o._l10n),this.#s=new Zi(this),this.#t&&(this.#s.data=this.#t,this.#t=null),yield this.addEditToolbar())})}get altTextData(){return this.#s?.data}set altTextData(e){this.#s&&(this.#s.data=e)}get guessedAltText(){return this.#s?.guessedText}setGuessedAltText(e){return D(this,null,function*(){yield this.#s?.setGuessedText(e)})}serializeAltText(e){return this.#s?.serialize(e)}hasAltText(){return!!this.#s&&!this.#s.isEmpty()}hasAltTextData(){return this.#s?.hasData()??!1}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=this.#i?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),this.#F();let[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);let[s,i]=this.getInitialTranslation();return this.translate(s,i),Be(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#E||=new He({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#y.bind(this),onPinching:this.#O.bind(this),onPinchEnd:this.#j.bind(this),signal:this._uiManager._signal})),this._uiManager._editorUndoBar?.hide(),this.div}#y(){this.#h={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#s?.toggle(!1),this.parent.togglePointerEvents(!1)}#O(e,t,s){let n=.7*(s/t)+1-.7;if(n===1)return;let r=this.#I(this.rotation),a=(x,E)=>[r[0]*x+r[2]*E,r[1]*x+r[3]*E],[l,h]=this.parentDimensions,c=this.x,d=this.y,u=this.width,f=this.height,p=o.MIN_SIZE/l,g=o.MIN_SIZE/h;n=Math.max(Math.min(n,1/u,1/f),p/u,g/f);let m=o._round(u*n),v=o._round(f*n);if(m===u&&v===f)return;this.#a||=[c,d,u,f];let b=a(u/2,f/2),A=o._round(c+b[0]),w=o._round(d+b[1]),y=a(m/2,v/2);this.x=A-y[0],this.y=w-y[1],this.width=m,this.height=v,this.setDims(l*m,h*v),this.fixAndSetPosition(),this._onResizing()}#j(){this.#s?.toggle(!0),this.parent.togglePointerEvents(!0),this.#N()}pointerdown(e){let{isMac:t}=ut.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(this.#f=!0,this._isDraggable){this.#G(e);return}this.#U(e)}get isSelected(){return this._uiManager.isSelected(this)}#U(e){let{isMac:t}=ut.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#G(e){let{isSelected:t}=this;this._uiManager.setUpDragSession();let s=!1,i=new AbortController,n=this._uiManager.combinedSignal(i),r={capture:!0,passive:!1,signal:n},a=h=>{i.abort(),this.#r=null,this.#f=!1,this._uiManager.endDragSession()||this.#U(h),s&&this._onStopDragging()};t&&(this.#A=e.clientX,this.#b=e.clientY,this.#r=e.pointerId,this.#n=e.pointerType,window.addEventListener("pointermove",h=>{s||(s=!0,this._onStartDragging());let{clientX:c,clientY:d,pointerId:u}=h;if(u!==this.#r){wt(h);return}let[f,p]=this.screenToPageTranslation(c-this.#A,d-this.#b);this.#A=c,this.#b=d,this._uiManager.dragSelectedEditors(f,p)},r),window.addEventListener("touchmove",wt,r),window.addEventListener("pointerdown",h=>{h.pointerType===this.#n&&(this.#E||h.isPrimary)&&a(h),wt(h)},r));let l=h=>{if(!this.#r||this.#r===h.pointerId){a(h);return}wt(h)};window.addEventListener("pointerup",l,{signal:n}),window.addEventListener("blur",l,{signal:n})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#v&&clearTimeout(this.#v),this.#v=setTimeout(()=>{this.#v=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,t,s){e.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,s=this.rotation){let i=this.parentScale,[n,r]=this.pageDimensions,[a,l]=this.pageTranslation,h=e/i,c=t/i,d=this.x*n,u=this.y*r,f=this.width*n,p=this.height*r;switch(s){case 0:return[d+h+a,r-u-c-p+l,d+h+f+a,r-u-c+l];case 90:return[d+c+a,r-u+h+l,d+c+p+a,r-u+h+f+l];case 180:return[d-h-f+a,r-u+c+l,d-h+a,r-u+c+p+l];case 270:return[d-c-p+a,r-u-h-f+l,d-c+a,r-u-h+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){let[s,i,n,r]=e,a=n-s,l=r-i;switch(this.rotation){case 0:return[s,t-r,a,l];case 90:return[s,t-i,l,a];case 180:return[n,t-i,a,l];case 270:return[n,t-r,l,a];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){this.#m=!0}disableEditMode(){this.#m=!1}isInEditMode(){return this.#m}shouldGetKeyboardEvents(){return this.#g}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){let{top:e,left:t,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:n,innerWidth:r}=window;return t<r&&i>0&&e<n&&s>0}#F(){if(this.#u||!this.div)return;this.#u=new AbortController;let e=this._uiManager.combinedSignal(this.#u);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}rebuild(){this.#F()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,t=null){Z("An editor must be serializable")}static deserialize(e,t,s){return D(this,null,function*(){let i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s});i.rotation=e.rotation,i.#t=e.accessibilityData;let[n,r]=i.pageDimensions,[a,l,h,c]=i.getRectInCurrentCoords(e.rect,r);return i.x=a/n,i.y=l/r,i.width=h/n,i.height=c/r,i})}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#u?.abort(),this.#u=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#v&&(clearTimeout(this.#v),this.#v=null),this.#H(),this.removeEditToolbar(),this.#w){for(let e of this.#w.values())clearTimeout(e);this.#w=null}this.parent=null,this.#E?.destroy(),this.#E=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#C(),this.#o.classList.remove("hidden"),Be(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),this.#h={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let t=this.#o.children;if(!this.#e){this.#e=Array.from(t);let r=this.#k.bind(this),a=this.#B.bind(this),l=this._uiManager._signal;for(let h of this.#e){let c=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",r,{signal:l}),h.addEventListener("blur",a,{signal:l}),h.addEventListener("focus",this.#z.bind(this,c),{signal:l}),h.setAttribute("data-l10n-id",o._l10nResizer[c])}}let s=this.#e[0],i=0;for(let r of t){if(r===s)break;i++}let n=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(n!==i){if(n<i)for(let a=0;a<i-n;a++)this.#o.append(this.#o.firstChild);else if(n>i)for(let a=0;a<n-i;a++)this.#o.firstChild.before(this.#o.lastChild);let r=0;for(let a of t){let h=this.#e[r++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",o._l10nResizer[h])}}this.#L(0),this.#g=!0,this.#o.firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#k(e){o._resizerKeyboardManager.exec(this,e)}#B(e){this.#g&&e.relatedTarget?.parentNode!==this.#o&&this.#H()}#z(e){this.#d=this.#g?e:""}#L(e){if(this.#e)for(let t of this.#e)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#g&&this.#S(this.#d,{deltaX:e,deltaY:t,fromKeyboard:!0})}#H(){this.#g=!1,this.#L(-1),this.#N()}_stopResizingWithKeyboard(){this.#H(),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#s?.toggleAltTextBadge(!1)}unselect(){this.#o?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#s?.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(e){this.#p=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){this.#l=!0;let s=e/t,{style:i}=this.div;i.aspectRatio=s,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){this.#w||=new Map;let{action:s}=e,i=this.#w.get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),this.#w.delete(s),this.#w.size===0&&(this.#w=null)},o._telemetryTimeout),this.#w.set(s,i);return}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#i=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#i=!0}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){let s=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),s.before(t)}return t}resetAnnotationElement(e){let{firstChild:t}=e.container;t?.nodeName==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}},Ds=class extends it{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}},qi=3285377520,xt=4294901760,_t=65535,$e=class{constructor(e){this.h1=e?e&4294967295:qi,this.h2=e?e&4294967295:qi}update(e){let t,s;if(typeof e=="string"){t=new Uint8Array(e.length*2),s=0;for(let g=0,m=e.length;g<m;g++){let v=e.charCodeAt(g);v<=255?t[s++]=v:(t[s++]=v>>>8,t[s++]=v&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),s=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");let i=s>>2,n=s-i*4,r=new Uint32Array(t.buffer,0,i),a=0,l=0,h=this.h1,c=this.h2,d=3432918353,u=461845907,f=d&_t,p=u&_t;for(let g=0;g<i;g++)g&1?(a=r[g],a=a*d&xt|a*f&_t,a=a<<15|a>>>17,a=a*u&xt|a*p&_t,h^=a,h=h<<13|h>>>19,h=h*5+3864292196):(l=r[g],l=l*d&xt|l*f&_t,l=l<<15|l>>>17,l=l*u&xt|l*p&_t,c^=l,c=c<<13|c>>>19,c=c*5+3864292196);switch(a=0,n){case 3:a^=t[i*4+2]<<16;case 2:a^=t[i*4+1]<<8;case 1:a^=t[i*4],a=a*d&xt|a*f&_t,a=a<<15|a>>>17,a=a*u&xt|a*p&_t,i&1?h^=a:c^=a}this.h1=h,this.h2=c}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&xt|e*36045&_t,t=t*4283543511&xt|((t<<16|e>>>16)*2950163797&xt)>>>16,e^=t>>>1,e=e*444984403&xt|e*60499&_t,t=t*3301882366&xt|((t<<16|e>>>16)*3120437893&xt)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}},ks=Object.freeze({map:null,hash:"",transfer:void 0}),pe=class{#t=!1;#e=null;#s=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){let s=this.#s.get(e);return s===void 0?t:Object.assign(t,s)}getRawValue(e){return this.#s.get(e)}remove(e){if(this.#s.delete(e),this.#s.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let t of this.#s.values())if(t instanceof it)return;this.onAnnotationEditor(null)}}setValue(e,t){let s=this.#s.get(e),i=!1;if(s!==void 0)for(let[n,r]of Object.entries(t))s[n]!==r&&(i=!0,s[n]=r);else i=!0,this.#s.set(e,t);i&&this.#i(),t instanceof it&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return this.#s.has(e)}getAll(){return this.#s.size>0?Vi(this.#s):null}setAll(e){for(let[t,s]of Object.entries(e))this.setValue(t,s)}get size(){return this.#s.size}#i(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new je(this)}get serializable(){if(this.#s.size===0)return ks;let e=new Map,t=new $e,s=[],i=Object.create(null),n=!1;for(let[r,a]of this.#s){let l=a instanceof it?a.serialize(!1,i):a;l&&(e.set(r,l),t.update(`${r}:${JSON.stringify(l)}`),n||=!!l.bitmap)}if(n)for(let r of e.values())r.bitmap&&s.push(r.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:s}:ks}get editorStats(){let e=null,t=new Map;for(let s of this.#s.values()){if(!(s instanceof it))continue;let i=s.telemetryFinalData;if(!i)continue;let{type:n}=i;t.has(n)||t.set(n,Object.getPrototypeOf(s).constructor),e||=Object.create(null);let r=e[n]||=new Map;for(let[a,l]of Object.entries(i)){if(a==="type")continue;let h=r.get(a);h||(h=new Map,r.set(a,h));let c=h.get(l)??0;h.set(l,c+1)}}for(let[s,i]of t)e[s]=i.computeTelemetryFinalData(e[s]);return e}resetModifiedIds(){this.#e=null}get modifiedIds(){if(this.#e)return this.#e;let e=[];for(let t of this.#s.values())!(t instanceof it)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return this.#e={ids:new Set(e),hash:e.join(",")}}},je=class extends pe{#t;constructor(e){super();let{map:t,hash:s,transfer:i}=e.serializable,n=structuredClone(t,i?{transfer:i}:null);this.#t={map:n,hash:s,transfer:i}}get print(){Z("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return z(this,"modifiedIds",{ids:new Set,hash:""})}},Ns=class{#t=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(let e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}loadSystemFont(s){return D(this,arguments,function*({systemFontInfo:e,_inspectFont:t}){if(!(!e||this.#t.has(e.loadedName))){if(ht(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:i,src:n,style:r}=e,a=new FontFace(i,n,r);this.addNativeFontFace(a);try{yield a.load(),this.#t.add(i),t?.(e)}catch{B(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}Z("Not implemented: loadSystemFont without the Font Loading API.")}})}bind(e){return D(this,null,function*(){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){yield this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){let s=e.createNativeFontFace();if(s){this.addNativeFontFace(s);try{yield s.loaded}catch(i){throw B(`Failed to load font '${s.family}': '${i}'.`),e.disableFontFace=!0,i}}return}let t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;yield new Promise(s=>{let i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(e,i)})}})}get isFontLoadingAPISupported(){let e=!!this._document?.fonts;return z(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(gt||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),z(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(ht(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){let n=s.shift();setTimeout(n.callback,0)}}let{loadingRequests:s}=this,i={done:!1,complete:t,callback:e};return s.push(i),i}get _loadTestFont(){let e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return z(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function s(w,y){return w.charCodeAt(y)<<24|w.charCodeAt(y+1)<<16|w.charCodeAt(y+2)<<8|w.charCodeAt(y+3)&255}function i(w,y,x,E){let C=w.substring(0,y),S=w.substring(y+x);return C+E+S}let n,r,a=this._document.createElement("canvas");a.width=1,a.height=1;let l=a.getContext("2d"),h=0;function c(w,y){if(++h>30){B("Load test font never loaded."),y();return}if(l.font="30px "+w,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){y();return}setTimeout(c.bind(null,w,y))}let d=`lt${Date.now()}${this.loadTestFontId++}`,u=this._loadTestFont;u=i(u,976,d.length,d);let p=16,g=1482184792,m=s(u,p);for(n=0,r=d.length-3;n<r;n+=4)m=m-g+s(d,n)|0;n<d.length&&(m=m-g+s(d+"XXX",n)|0),u=i(u,p,4,Ln(m));let v=`url(data:font/opentype;base64,${btoa(u)});`,b=`@font-face {font-family:"${d}";src:${v}}`;this.insertRule(b);let A=this._document.createElement("div");A.style.visibility="hidden",A.style.width=A.style.height="10px",A.style.position="absolute",A.style.top=A.style.left="0px";for(let w of[e.loadedName,d]){let y=this._document.createElement("span");y.textContent="Hi",y.style.fontFamily=w,A.append(y)}this._document.body.append(A),c(d,()=>{A.remove(),t.complete()})}},Fs=class{constructor(e,{disableFontFace:t=!1,fontExtraProperties:s=!1,inspectFont:i=null}){this.compiledGlyphs=Object.create(null);for(let n in e)this[n]=e[n];this.disableFontFace=t===!0,this.fontExtraProperties=s===!0,this._inspectFont=i}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{let t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;let e=`url(data:${this.mimetype};base64,${Bn(this.data)});`,t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${e}}`}return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];let s=this.loadedName+"_path_"+t,i;try{i=e.get(s)}catch(r){B(`getPathGenerator - ignoring character: "${r}".`)}let n=new Path2D(i||"");return this.fontExtraProperties||e.delete(s),this.compiledGlyphs[t]=n}},Re={DATA:1,ERROR:2},lt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function tn(){}function bt(o){if(o instanceof Mt||o instanceof he||o instanceof zt||o instanceof ke||o instanceof se||o instanceof le)return o;switch(o instanceof Error||typeof o=="object"&&o!==null||Z('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),o.name){case"AbortException":return new Mt(o.message);case"InvalidPDFException":return new he(o.message);case"MissingPDFException":return new zt(o.message);case"PasswordException":return new ke(o.message,o.code);case"UnexpectedResponseException":return new se(o.message,o.status);case"UnknownErrorException":return new le(o.message,o.details)}return new le(o.message,o.toString())}var $t=class{#t=new AbortController;constructor(e,t,s){this.sourceName=e,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){this.#i(e);return}if(e.callback){let s=e.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],e.callback===Re.DATA)i.resolve(e.data);else if(e.callback===Re.ERROR)i.reject(bt(e.reason));else throw new Error("Unexpected callback case");return}let t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){let s=this.sourceName,i=e.sourceName,n=this.comObj;Promise.try(t,e.data).then(function(r){n.postMessage({sourceName:s,targetName:i,callback:Re.DATA,callbackId:e.callbackId,data:r})},function(r){n.postMessage({sourceName:s,targetName:i,callback:Re.ERROR,callbackId:e.callbackId,reason:bt(r)})});return}if(e.streamId){this.#s(e);return}t(e.data)}on(e,t){let s=this.actionHandler;if(s[e])throw new Error(`There is already an actionName called "${e}"`);s[e]=t}send(e,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},s)}sendWithPromise(e,t,s){let i=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[i]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},s)}catch(r){n.reject(r)}return n.promise}sendWithStream(e,t,s,i){let n=this.streamId++,r=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:h=>{let c=Promise.withResolvers();return this.streamControllers[n]={controller:h,startCall:c,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:r,targetName:a,action:e,streamId:n,data:t,desiredSize:h.desiredSize},i),c.promise},pull:h=>{let c=Promise.withResolvers();return this.streamControllers[n].pullCall=c,l.postMessage({sourceName:r,targetName:a,stream:lt.PULL,streamId:n,desiredSize:h.desiredSize}),c.promise},cancel:h=>{ht(h instanceof Error,"cancel must have a valid reason");let c=Promise.withResolvers();return this.streamControllers[n].cancelCall=c,this.streamControllers[n].isClosed=!0,l.postMessage({sourceName:r,targetName:a,stream:lt.CANCEL,streamId:n,reason:bt(h)}),c.promise}},s)}#s(e){let t=e.streamId,s=this.sourceName,i=e.sourceName,n=this.comObj,r=this,a=this.actionHandler[e.action],l={enqueue(h,c=1,d){if(this.isCancelled)return;let u=this.desiredSize;this.desiredSize-=c,u>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:s,targetName:i,stream:lt.ENQUEUE,streamId:t,chunk:h},d)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:lt.CLOSE,streamId:t}),delete r.streamSinks[t])},error(h){ht(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:lt.ERROR,streamId:t,reason:bt(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(a,e.data,l).then(function(){n.postMessage({sourceName:s,targetName:i,stream:lt.START_COMPLETE,streamId:t,success:!0})},function(h){n.postMessage({sourceName:s,targetName:i,stream:lt.START_COMPLETE,streamId:t,reason:bt(h)})})}#i(e){let t=e.streamId,s=this.sourceName,i=e.sourceName,n=this.comObj,r=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case lt.START_COMPLETE:e.success?r.startCall.resolve():r.startCall.reject(bt(e.reason));break;case lt.PULL_COMPLETE:e.success?r.pullCall.resolve():r.pullCall.reject(bt(e.reason));break;case lt.PULL:if(!a){n.postMessage({sourceName:s,targetName:i,stream:lt.PULL_COMPLETE,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,Promise.try(a.onPull||tn).then(function(){n.postMessage({sourceName:s,targetName:i,stream:lt.PULL_COMPLETE,streamId:t,success:!0})},function(h){n.postMessage({sourceName:s,targetName:i,stream:lt.PULL_COMPLETE,streamId:t,reason:bt(h)})});break;case lt.ENQUEUE:if(ht(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(e.chunk);break;case lt.CLOSE:if(ht(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),this.#r(r,t);break;case lt.ERROR:ht(r,"error should have stream controller"),r.controller.error(bt(e.reason)),this.#r(r,t);break;case lt.CANCEL_COMPLETE:e.success?r.cancelCall.resolve():r.cancelCall.reject(bt(e.reason)),this.#r(r,t);break;case lt.CANCEL:if(!a)break;let l=bt(e.reason);Promise.try(a.onCancel||tn,l).then(function(){n.postMessage({sourceName:s,targetName:i,stream:lt.CANCEL_COMPLETE,streamId:t,success:!0})},function(h){n.postMessage({sourceName:s,targetName:i,stream:lt.CANCEL_COMPLETE,streamId:t,reason:bt(h)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}#r(e,t){return D(this,null,function*(){yield Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]})}destroy(){this.#t?.abort(),this.#t=null}},Ue=class{#t=!1;constructor({enableHWA:e=!1}){this.#t=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");let s=this._createCanvas(e,t);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!this.#t})}}reset(e,t,s){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||s<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=s}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Z("Abstract method `_createCanvas` called.")}},Bs=class extends Ue{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){let s=this._document.createElement("canvas");return s.width=e,s.height=t,s}},Ge=class{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}fetch(t){return D(this,arguments,function*({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");let s=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(s).then(i=>({cMapData:i,isCompressed:this.isCompressed})).catch(i=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${s}`)})})}_fetch(e){return D(this,null,function*(){Z("Abstract method `_fetch` called.")})}},ze=class extends Ge{_fetch(e){return D(this,null,function*(){let t=yield ms(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):gs(t)})}},Xr=W(4520),Ve=class{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,s,i,n){return"none"}destroy(e=!1){}},Hs=class extends Ve{#t;#e;#s;#i;#r;#n;#l=0;constructor({docId:e,ownerDocument:t=globalThis.document}){super(),this.#i=e,this.#r=t}get#o(){return this.#e||=new Map}get#c(){return this.#n||=new Map}get#h(){if(!this.#s){let e=this.#r.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;let s=this.#r.createElementNS(Ot,"svg");s.setAttribute("width",0),s.setAttribute("height",0),this.#s=this.#r.createElementNS(Ot,"defs"),e.append(s),s.append(this.#s),this.#r.body.append(e)}return this.#s}#u(e){if(e.length===1){let l=e[0],h=new Array(256);for(let d=0;d<256;d++)h[d]=l[d]/255;let c=h.join(",");return[c,c,c]}let[t,s,i]=e,n=new Array(256),r=new Array(256),a=new Array(256);for(let l=0;l<256;l++)n[l]=t[l]/255,r[l]=s[l]/255,a[l]=i[l]/255;return[n.join(","),r.join(","),a.join(",")]}#d(e){if(this.#t===void 0){this.#t="";let t=this.#r.URL;t!==this.#r.baseURI&&(vs(t)?B('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=t.split("#",1)[0])}return`url(${this.#t}#${e})`}addFilter(e){if(!e)return"none";let t=this.#o.get(e);if(t)return t;let[s,i,n]=this.#u(e),r=e.length===1?s:`${s}${i}${n}`;if(t=this.#o.get(r),t)return this.#o.set(e,t),t;let a=`g_${this.#i}_transfer_map_${this.#l++}`,l=this.#d(a);this.#o.set(e,l),this.#o.set(r,l);let h=this.#p(a);return this.#g(s,i,n,h),l}addHCMFilter(e,t){let s=`${e}-${t}`,i="base",n=this.#c.get(i);if(n?.key===s||(n?(n.filter?.remove(),n.key=s,n.url="none",n.filter=null):(n={key:s,url:"none",filter:null},this.#c.set(i,n)),!e||!t))return n.url;let r=this.#A(e);e=k.makeHexColor(...r);let a=this.#A(t);if(t=k.makeHexColor(...a),this.#h.style.color="",e==="#000000"&&t==="#ffffff"||e===t)return n.url;let l=new Array(256);for(let f=0;f<=255;f++){let p=f/255;l[f]=p<=.03928?p/12.92:((p+.055)/1.055)**2.4}let h=l.join(","),c=`g_${this.#i}_hcm_filter`,d=n.filter=this.#p(c);this.#g(h,h,h,d),this.#a(d);let u=(f,p)=>{let g=r[f]/255,m=a[f]/255,v=new Array(p+1);for(let b=0;b<=p;b++)v[b]=g+b/p*(m-g);return v.join(",")};return this.#g(u(0,5),u(1,5),u(2,5),d),n.url=this.#d(c),n.url}addAlphaFilter(e){let t=this.#o.get(e);if(t)return t;let[s]=this.#u([e]),i=`alpha_${s}`;if(t=this.#o.get(i),t)return this.#o.set(e,t),t;let n=`g_${this.#i}_alpha_map_${this.#l++}`,r=this.#d(n);this.#o.set(e,r),this.#o.set(i,r);let a=this.#p(n);return this.#v(s,a),r}addLuminosityFilter(e){let t=this.#o.get(e||"luminosity");if(t)return t;let s,i;if(e?([s]=this.#u([e]),i=`luminosity_${s}`):i="luminosity",t=this.#o.get(i),t)return this.#o.set(e,t),t;let n=`g_${this.#i}_luminosity_map_${this.#l++}`,r=this.#d(n);this.#o.set(e,r),this.#o.set(i,r);let a=this.#p(n);return this.#f(a),e&&this.#v(s,a),r}addHighlightHCMFilter(e,t,s,i,n){let r=`${t}-${s}-${i}-${n}`,a=this.#c.get(e);if(a?.key===r||(a?(a.filter?.remove(),a.key=r,a.url="none",a.filter=null):(a={key:r,url:"none",filter:null},this.#c.set(e,a)),!t||!s))return a.url;let[l,h]=[t,s].map(this.#A.bind(this)),c=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),d=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),[u,f]=[i,n].map(this.#A.bind(this));d<c&&([c,d,u,f]=[d,c,f,u]),this.#h.style.color="";let p=(v,b,A)=>{let w=new Array(256),y=(d-c)/A,x=v/255,E=(b-v)/(255*A),C=0;for(let S=0;S<=A;S++){let M=Math.round(c+S*y),L=x+S*E;for(let G=C;G<=M;G++)w[G]=L;C=M+1}for(let S=C;S<256;S++)w[S]=w[C-1];return w.join(",")},g=`g_${this.#i}_hcm_${e}_filter`,m=a.filter=this.#p(g);return this.#a(m),this.#g(p(u[0],f[0],5),p(u[1],f[1],5),p(u[2],f[2],5),m),a.url=this.#d(g),a.url}destroy(e=!1){e&&this.#n?.size||(this.#s?.parentNode.parentNode.remove(),this.#s=null,this.#e?.clear(),this.#e=null,this.#n?.clear(),this.#n=null,this.#l=0)}#f(e){let t=this.#r.createElementNS(Ot,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}#a(e){let t=this.#r.createElementNS(Ot,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#p(e){let t=this.#r.createElementNS(Ot,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#h.append(t),t}#m(e,t,s){let i=this.#r.createElementNS(Ot,t);i.setAttribute("type","discrete"),i.setAttribute("tableValues",s),e.append(i)}#g(e,t,s,i){let n=this.#r.createElementNS(Ot,"feComponentTransfer");i.append(n),this.#m(n,"feFuncR",e),this.#m(n,"feFuncG",t),this.#m(n,"feFuncB",s)}#v(e,t){let s=this.#r.createElementNS(Ot,"feComponentTransfer");t.append(s),this.#m(s,"feFuncA",e)}#A(e){return this.#h.style.color=e,Yi(getComputedStyle(this.#h).getPropertyValue("color"))}},We=class{constructor({baseUrl:e=null}){this.baseUrl=e}fetch(t){return D(this,arguments,function*({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");let s=`${this.baseUrl}${e}`;return this._fetch(s).catch(i=>{throw new Error(`Unable to load font data at: ${s}`)})})}_fetch(e){return D(this,null,function*(){Z("Abstract method `_fetch` called.")})}},Xe=class extends We{_fetch(e){return D(this,null,function*(){let t=yield ms(e,"arraybuffer");return new Uint8Array(t)})}};if(gt){let o;try{let e=process.getBuiltinModule("module").createRequire(import.meta.url);try{o=e("@napi-rs/canvas")}catch(t){B(`Cannot load "@napi-rs/canvas" package: "${t}".`)}}catch(e){B(`Cannot access the \`require\` function: "${e}".`)}globalThis.DOMMatrix||(o?.DOMMatrix?globalThis.DOMMatrix=o.DOMMatrix:B("Cannot polyfill `DOMMatrix`, rendering may be broken.")),globalThis.ImageData||(o?.ImageData?globalThis.ImageData=o.ImageData:B("Cannot polyfill `ImageData`, rendering may be broken.")),globalThis.Path2D||(o?.Path2D?globalThis.Path2D=o.Path2D:B("Cannot polyfill `Path2D`, rendering may be broken."))}function gn(o){return D(this,null,function*(){let t=yield process.getBuiltinModule("fs").promises.readFile(o);return new Uint8Array(t)})}var $s=class extends Ve{},js=class extends Ue{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}},Us=class extends Ge{_fetch(e){return D(this,null,function*(){return gn(e)})}},Gs=class extends We{_fetch(e){return D(this,null,function*(){return gn(e)})}},pt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function zs(o,e){if(!e)return;let t=e[2]-e[0],s=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,s),o.clip(i)}var ge=class{getPattern(){Z("Abstract method `getPattern` called.")}},Vs=class extends ge{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let s of this._colorStops)t.addColorStop(s[0],s[1]);return t}getPattern(e,t,s,i){let n;if(i===pt.STROKE||i===pt.FILL){let r=t.current.getClippedPathBoundingBox(i,et(e))||[0,0,0,0],a=Math.ceil(r[2]-r[0])||1,l=Math.ceil(r[3]-r[1])||1,h=t.cachedCanvases.getCanvas("pattern",a,l),c=h.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-r[0],-r[1]),s=k.transform(s,[1,0,0,1,r[0],r[1]]),c.transform(...t.baseTransform),this.matrix&&c.transform(...this.matrix),zs(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),n=e.createPattern(h.canvas,"no-repeat");let d=new DOMMatrix(s);n.setTransform(d)}else zs(e,this._bbox),n=this._createGradient(e);return n}};function Es(o,e,t,s,i,n,r,a){let l=e.coords,h=e.colors,c=o.data,d=o.width*4,u;l[t+1]>l[s+1]&&(u=t,t=s,s=u,u=n,n=r,r=u),l[s+1]>l[i+1]&&(u=s,s=i,i=u,u=r,r=a,a=u),l[t+1]>l[s+1]&&(u=t,t=s,s=u,u=n,n=r,r=u);let f=(l[t]+e.offsetX)*e.scaleX,p=(l[t+1]+e.offsetY)*e.scaleY,g=(l[s]+e.offsetX)*e.scaleX,m=(l[s+1]+e.offsetY)*e.scaleY,v=(l[i]+e.offsetX)*e.scaleX,b=(l[i+1]+e.offsetY)*e.scaleY;if(p>=b)return;let A=h[n],w=h[n+1],y=h[n+2],x=h[r],E=h[r+1],C=h[r+2],S=h[a],M=h[a+1],L=h[a+2],G=Math.round(p),H=Math.round(b),U,q,P,R,X,Y,st,nt;for(let K=G;K<=H;K++){if(K<m){let T=K<p?0:(p-K)/(p-m);U=f-(f-g)*T,q=A-(A-x)*T,P=w-(w-E)*T,R=y-(y-C)*T}else{let T;K>b?T=1:m===b?T=0:T=(m-K)/(m-b),U=g-(g-v)*T,q=x-(x-S)*T,P=E-(E-M)*T,R=C-(C-L)*T}let Q;K<p?Q=0:K>b?Q=1:Q=(p-K)/(p-b),X=f-(f-v)*Q,Y=A-(A-S)*Q,st=w-(w-M)*Q,nt=y-(y-L)*Q;let Tt=Math.round(Math.min(U,X)),Ct=Math.round(Math.max(U,X)),_=d*K+Tt*4;for(let T=Tt;T<=Ct;T++)Q=(U-T)/(U-X),Q<0?Q=0:Q>1&&(Q=1),c[_++]=q-(q-Y)*Q|0,c[_++]=P-(P-st)*Q|0,c[_++]=R-(R-nt)*Q|0,c[_++]=255}}function Gn(o,e,t){let s=e.coords,i=e.colors,n,r;switch(e.type){case"lattice":let a=e.verticesPerRow,l=Math.floor(s.length/a)-1,h=a-1;for(n=0;n<l;n++){let c=n*a;for(let d=0;d<h;d++,c++)Es(o,t,s[c],s[c+1],s[c+a],i[c],i[c+1],i[c+a]),Es(o,t,s[c+a+1],s[c+1],s[c+a],i[c+a+1],i[c+1],i[c+a])}break;case"triangles":for(n=0,r=s.length;n<r;n+=3)Es(o,t,s[n],s[n+1],s[n+2],i[n],i[n+1],i[n+2]);break;default:throw new Error("illegal figure")}}var Ws=class extends ge{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,s){let a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-a,c=Math.ceil(this._bounds[3])-l,d=Math.min(Math.ceil(Math.abs(h*e[0]*1.1)),3e3),u=Math.min(Math.ceil(Math.abs(c*e[1]*1.1)),3e3),f=h/d,p=c/u,g={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/f,scaleY:1/p},m=d+4,v=u+4,b=s.getCanvas("mesh",m,v),A=b.context,w=A.createImageData(d,u);if(t){let x=w.data;for(let E=0,C=x.length;E<C;E+=4)x[E]=t[0],x[E+1]=t[1],x[E+2]=t[2],x[E+3]=255}for(let x of this._figures)Gn(w,x,g);return A.putImageData(w,2,2),{canvas:b.canvas,offsetX:a-2*f,offsetY:l-2*p,scaleX:f,scaleY:p}}getPattern(e,t,s,i){zs(e,this._bbox);let n;if(i===pt.SHADING)n=k.singularValueDecompose2dScale(et(e));else if(n=k.singularValueDecompose2dScale(t.baseTransform),this.matrix){let a=k.singularValueDecompose2dScale(this.matrix);n=[n[0]*a[0],n[1]*a[1]]}let r=this._createMeshCanvas(n,i===pt.SHADING?null:this._background,t.cachedCanvases);return i!==pt.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(r.offsetX,r.offsetY),e.scale(r.scaleX,r.scaleY),e.createPattern(r.canvas,"no-repeat")}},Xs=class extends ge{getPattern(){return"hotpink"}};function zn(o){switch(o[0]){case"RadialAxial":return new Vs(o);case"Mesh":return new Ws(o);case"Dummy":return new Xs}throw new Error(`Unknown IR type: ${o[0]}`)}var en={COLORED:1,UNCOLORED:2},Vn=(()=>{class o{static MAX_PATTERN_SIZE=3e3;constructor(t,s,i,n,r){this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.color=s,this.ctx=i,this.canvasGraphicsFactory=n,this.baseTransform=r}createPatternCanvas(t){let{bbox:s,operatorList:i,paintType:n,tilingType:r,color:a,canvasGraphicsFactory:l}=this,{xstep:h,ystep:c}=this;h=Math.abs(h),c=Math.abs(c),ps("TilingType: "+r);let d=s[0],u=s[1],f=s[2],p=s[3],g=f-d,m=p-u,v=k.singularValueDecompose2dScale(this.matrix),b=k.singularValueDecompose2dScale(this.baseTransform),A=v[0]*b[0],w=v[1]*b[1],y=g,x=m,E=!1,C=!1,S=Math.ceil(h*A),M=Math.ceil(c*w),L=Math.ceil(g*A),G=Math.ceil(m*w);S>=L?y=h:E=!0,M>=G?x=c:C=!0;let H=this.getSizeAndScale(y,this.ctx.canvas.width,A),U=this.getSizeAndScale(x,this.ctx.canvas.height,w),q=t.cachedCanvases.getCanvas("pattern",H.size,U.size),P=q.context,R=l.createCanvasGraphics(P);if(R.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(R,n,a),P.translate(-H.scale*d,-U.scale*u),R.transform(H.scale,0,0,U.scale,0,0),P.save(),this.clipBbox(R,d,u,f,p),R.baseTransform=et(R.ctx),R.executeOperatorList(i),R.endDrawing(),P.restore(),E||C){let X=q.canvas;E&&(y=h),C&&(x=c);let Y=this.getSizeAndScale(y,this.ctx.canvas.width,A),st=this.getSizeAndScale(x,this.ctx.canvas.height,w),nt=Y.size,K=st.size,Q=t.cachedCanvases.getCanvas("pattern-workaround",nt,K),Tt=Q.context,Ct=E?Math.floor(g/h):0,_=C?Math.floor(m/c):0;for(let T=0;T<=Ct;T++)for(let I=0;I<=_;I++)Tt.drawImage(X,nt*T,K*I,nt,K,0,0,nt,K);return{canvas:Q.canvas,scaleX:Y.scale,scaleY:st.scale,offsetX:d,offsetY:u}}return{canvas:q.canvas,scaleX:H.scale,scaleY:U.scale,offsetX:d,offsetY:u}}getSizeAndScale(t,s,i){let n=Math.max(o.MAX_PATTERN_SIZE,s),r=Math.ceil(t*i);return r>=n?r=n:i=r/t,{scale:i,size:r}}clipBbox(t,s,i,n,r){let a=n-s,l=r-i;t.ctx.rect(s,i,a,l),t.current.updateRectMinMax(et(t.ctx),[s,i,n,r]),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,s,i){let n=t.ctx,r=t.current;switch(s){case en.COLORED:let a=this.ctx;n.fillStyle=a.fillStyle,n.strokeStyle=a.strokeStyle,r.fillColor=a.fillStyle,r.strokeColor=a.strokeStyle;break;case en.UNCOLORED:let l=k.makeHexColor(i[0],i[1],i[2]);n.fillStyle=l,n.strokeStyle=l,r.fillColor=l,r.strokeColor=l;break;default:throw new Rs(`Unsupported paint type: ${s}`)}}getPattern(t,s,i,n){let r=i;n!==pt.SHADING&&(r=k.transform(r,s.baseTransform),this.matrix&&(r=k.transform(r,this.matrix)));let a=this.createPatternCanvas(s),l=new DOMMatrix(r);l=l.translate(a.offsetX,a.offsetY),l=l.scale(1/a.scaleX,1/a.scaleY);let h=t.createPattern(a.canvas,"repeat");return h.setTransform(l),h}}return o})();function Wn({src:o,srcPos:e=0,dest:t,width:s,height:i,nonBlackColor:n=4294967295,inverseDecode:r=!1}){let a=ut.isLittleEndian?4278190080:255,[l,h]=r?[n,a]:[a,n],c=s>>3,d=s&7,u=o.length;t=new Uint32Array(t.buffer);let f=0;for(let p=0;p<i;p++){for(let m=e+c;e<m;e++){let v=e<u?o[e]:255;t[f++]=v&128?h:l,t[f++]=v&64?h:l,t[f++]=v&32?h:l,t[f++]=v&16?h:l,t[f++]=v&8?h:l,t[f++]=v&4?h:l,t[f++]=v&2?h:l,t[f++]=v&1?h:l}if(d===0)continue;let g=e<u?o[e++]:255;for(let m=0;m<d;m++)t[f++]=g&1<<7-m?h:l}return{srcPos:e,destPos:f}}var sn=16,nn=100,Xn=15,rn=10,an=1e3,yt=16;function Yn(o,e){if(o._removeMirroring)throw new Error("Context is already forwarding operations.");o.__originalSave=o.save,o.__originalRestore=o.restore,o.__originalRotate=o.rotate,o.__originalScale=o.scale,o.__originalTranslate=o.translate,o.__originalTransform=o.transform,o.__originalSetTransform=o.setTransform,o.__originalResetTransform=o.resetTransform,o.__originalClip=o.clip,o.__originalMoveTo=o.moveTo,o.__originalLineTo=o.lineTo,o.__originalBezierCurveTo=o.bezierCurveTo,o.__originalRect=o.rect,o.__originalClosePath=o.closePath,o.__originalBeginPath=o.beginPath,o._removeMirroring=()=>{o.save=o.__originalSave,o.restore=o.__originalRestore,o.rotate=o.__originalRotate,o.scale=o.__originalScale,o.translate=o.__originalTranslate,o.transform=o.__originalTransform,o.setTransform=o.__originalSetTransform,o.resetTransform=o.__originalResetTransform,o.clip=o.__originalClip,o.moveTo=o.__originalMoveTo,o.lineTo=o.__originalLineTo,o.bezierCurveTo=o.__originalBezierCurveTo,o.rect=o.__originalRect,o.closePath=o.__originalClosePath,o.beginPath=o.__originalBeginPath,delete o._removeMirroring},o.save=function(){e.save(),this.__originalSave()},o.restore=function(){e.restore(),this.__originalRestore()},o.translate=function(s,i){e.translate(s,i),this.__originalTranslate(s,i)},o.scale=function(s,i){e.scale(s,i),this.__originalScale(s,i)},o.transform=function(s,i,n,r,a,l){e.transform(s,i,n,r,a,l),this.__originalTransform(s,i,n,r,a,l)},o.setTransform=function(s,i,n,r,a,l){e.setTransform(s,i,n,r,a,l),this.__originalSetTransform(s,i,n,r,a,l)},o.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},o.rotate=function(s){e.rotate(s),this.__originalRotate(s)},o.clip=function(s){e.clip(s),this.__originalClip(s)},o.moveTo=function(t,s){e.moveTo(t,s),this.__originalMoveTo(t,s)},o.lineTo=function(t,s){e.lineTo(t,s),this.__originalLineTo(t,s)},o.bezierCurveTo=function(t,s,i,n,r,a){e.bezierCurveTo(t,s,i,n,r,a),this.__originalBezierCurveTo(t,s,i,n,r,a)},o.rect=function(t,s,i,n){e.rect(t,s,i,n),this.__originalRect(t,s,i,n)},o.closePath=function(){e.closePath(),this.__originalClosePath()},o.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}var Ys=class{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,s){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,s)):(i=this.canvasFactory.create(t,s),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(let e in this.cache){let t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}};function Ie(o,e,t,s,i,n,r,a,l,h){let[c,d,u,f,p,g]=et(o);if(d===0&&u===0){let b=r*c+p,A=Math.round(b),w=a*f+g,y=Math.round(w),x=(r+l)*c+p,E=Math.abs(Math.round(x)-A)||1,C=(a+h)*f+g,S=Math.abs(Math.round(C)-y)||1;return o.setTransform(Math.sign(c),0,0,Math.sign(f),A,y),o.drawImage(e,t,s,i,n,0,0,E,S),o.setTransform(c,d,u,f,p,g),[E,S]}if(c===0&&f===0){let b=a*u+p,A=Math.round(b),w=r*d+g,y=Math.round(w),x=(a+h)*u+p,E=Math.abs(Math.round(x)-A)||1,C=(r+l)*d+g,S=Math.abs(Math.round(C)-y)||1;return o.setTransform(0,Math.sign(d),Math.sign(u),0,A,y),o.drawImage(e,t,s,i,n,0,0,S,E),o.setTransform(c,d,u,f,p,g),[S,E]}o.drawImage(e,t,s,i,n,r,a,l,h);let m=Math.hypot(c,d),v=Math.hypot(u,f);return[m*l,v*h]}function Kn(o){let{width:e,height:t}=o;if(e>an||t>an)return null;let s=1e3,i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),n=e+1,r=new Uint8Array(n*(t+1)),a,l,h,c=e+7&-8,d=new Uint8Array(c*t),u=0;for(let v of o.data){let b=128;for(;b>0;)d[u++]=v&b?0:255,b>>=1}let f=0;for(u=0,d[u]!==0&&(r[0]=1,++f),l=1;l<e;l++)d[u]!==d[u+1]&&(r[l]=d[u]?2:1,++f),u++;for(d[u]!==0&&(r[l]=2,++f),a=1;a<t;a++){u=a*c,h=a*n,d[u-c]!==d[u]&&(r[h]=d[u]?1:8,++f);let v=(d[u]?4:0)+(d[u-c]?8:0);for(l=1;l<e;l++)v=(v>>2)+(d[u+1]?4:0)+(d[u-c+1]?8:0),i[v]&&(r[h+l]=i[v],++f),u++;if(d[u-c]!==d[u]&&(r[h+l]=d[u]?2:4,++f),f>s)return null}for(u=c*(t-1),h=a*n,d[u]!==0&&(r[h]=8,++f),l=1;l<e;l++)d[u]!==d[u+1]&&(r[h+l]=d[u]?4:8,++f),u++;if(d[u]!==0&&(r[h+l]=4,++f),f>s)return null;let p=new Int32Array([0,n,-1,0,-n,0,0,0,1]),g=new Path2D;for(a=0;f&&a<=t;a++){let v=a*n,b=v+e;for(;v<b&&!r[v];)v++;if(v===b)continue;g.moveTo(v%n,a);let A=v,w=r[v];do{let y=p[w];do v+=y;while(!r[v]);let x=r[v];x!==5&&x!==10?(w=x,r[v]=0):(w=x&51*w>>4,r[v]&=w>>2|w<<2),g.lineTo(v%n,v/n|0),r[v]||--f}while(A!==v);--a}return d=null,r=null,function(v){v.save(),v.scale(1/e,-1/t),v.translate(0,-t),v.fill(g),v.beginPath(),v.restore()}}var Ye=class{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=fn,this.textMatrixScale=1,this.fontMatrix=Cs,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=ft.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){let e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,s){[t,s]=k.applyTransform([t,s],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,s)}updateRectMinMax(e,t){let s=k.applyTransform(t,e),i=k.applyTransform(t.slice(2),e),n=k.applyTransform([t[0],t[3]],e),r=k.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,s[0],i[0],n[0],r[0]),this.minY=Math.min(this.minY,s[1],i[1],n[1],r[1]),this.maxX=Math.max(this.maxX,s[0],i[0],n[0],r[0]),this.maxY=Math.max(this.maxY,s[1],i[1],n[1],r[1])}updateScalingPathMinMax(e,t){k.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,s,i,n,r,a,l,h,c){let d=k.bezierBoundingBox(t,s,i,n,r,a,l,h,c);c||this.updateRectMinMax(e,d)}getPathBoundingBox(e=pt.FILL,t=null){let s=[this.minX,this.minY,this.maxX,this.maxY];if(e===pt.STROKE){t||Z("Stroke bounding box must include transform.");let i=k.singularValueDecompose2dScale(t),n=i[0]*this.lineWidth/2,r=i[1]*this.lineWidth/2;s[0]-=n,s[1]-=r,s[2]+=n,s[3]+=r}return s}updateClipFromPath(){let e=k.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=pt.FILL,t=null){return k.intersect(this.clipBox,this.getPathBoundingBox(e,t))}};function on(o,e){if(e instanceof ImageData){o.putImageData(e,0,0);return}let t=e.height,s=e.width,i=t%yt,n=(t-i)/yt,r=i===0?n:n+1,a=o.createImageData(s,yt),l=0,h,c=e.data,d=a.data,u,f,p,g;if(e.kind===Le.GRAYSCALE_1BPP){let m=c.byteLength,v=new Uint32Array(d.buffer,0,d.byteLength>>2),b=v.length,A=s+7>>3,w=4294967295,y=ut.isLittleEndian?4278190080:255;for(u=0;u<r;u++){for(p=u<n?yt:i,h=0,f=0;f<p;f++){let x=m-l,E=0,C=x>A?s:x*8-7,S=C&-8,M=0,L=0;for(;E<S;E+=8)L=c[l++],v[h++]=L&128?w:y,v[h++]=L&64?w:y,v[h++]=L&32?w:y,v[h++]=L&16?w:y,v[h++]=L&8?w:y,v[h++]=L&4?w:y,v[h++]=L&2?w:y,v[h++]=L&1?w:y;for(;E<C;E++)M===0&&(L=c[l++],M=128),v[h++]=L&M?w:y,M>>=1}for(;h<b;)v[h++]=0;o.putImageData(a,0,u*yt)}}else if(e.kind===Le.RGBA_32BPP){for(f=0,g=s*yt*4,u=0;u<n;u++)d.set(c.subarray(l,l+g)),l+=g,o.putImageData(a,0,f),f+=yt;u<r&&(g=s*i*4,d.set(c.subarray(l,l+g)),o.putImageData(a,0,f))}else if(e.kind===Le.RGB_24BPP)for(p=yt,g=s*p,u=0;u<r;u++){for(u>=n&&(p=i,g=s*p),h=0,f=g;f--;)d[h++]=c[l++],d[h++]=c[l++],d[h++]=c[l++],d[h++]=255;o.putImageData(a,0,u*yt)}else throw new Error(`bad image kind: ${e.kind}`)}function ln(o,e){if(e.bitmap){o.drawImage(e.bitmap,0,0);return}let t=e.height,s=e.width,i=t%yt,n=(t-i)/yt,r=i===0?n:n+1,a=o.createImageData(s,yt),l=0,h=e.data,c=a.data;for(let d=0;d<r;d++){let u=d<n?yt:i;({srcPos:l}=Wn({src:h,srcPos:l,dest:c,width:s,height:u,nonBlackColor:0})),o.putImageData(a,0,d*yt)}}function ne(o,e){let t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(let s of t)o[s]!==void 0&&(e[s]=o[s]);o.setLineDash!==void 0&&(e.setLineDash(o.getLineDash()),e.lineDashOffset=o.lineDashOffset)}function Pe(o){if(o.strokeStyle=o.fillStyle="#000000",o.fillRule="nonzero",o.globalAlpha=1,o.lineWidth=1,o.lineCap="butt",o.lineJoin="miter",o.miterLimit=10,o.globalCompositeOperation="source-over",o.font="10px sans-serif",o.setLineDash!==void 0&&(o.setLineDash([]),o.lineDashOffset=0),!gt){let{filter:e}=o;e!=="none"&&e!==""&&(o.filter="none")}}function hn(o,e){if(e)return!0;let t=k.singularValueDecompose2dScale(o);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);let s=Math.fround((globalThis.devicePixelRatio||1)*Ft.PDF_TO_CSS_UNITS);return t[0]<=s&&t[1]<=s}var Qn=["butt","round","square"],Jn=["miter","round","bevel"],Zn={},cn={},Zt=class o{constructor(e,t,s,i,n,{optionalContentConfig:r,markedContentStack:a=null},l,h){this.ctx=e,this.current=new Ye(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=s,this.canvasFactory=i,this.filterFactory=n,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=r,this.cachedCanvases=new Ys(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:s=!1,background:i=null}){let n=this.ctx.canvas.width,r=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,n,r),this.ctx.fillStyle=a,s){let l=this.cachedCanvases.getCanvas("transparent",n,r);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...et(this.compositeCtx))}this.ctx.save(),Pe(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=et(this.ctx)}executeOperatorList(e,t,s,i){let n=e.argsArray,r=e.fnArray,a=t||0,l=n.length;if(l===a)return a;let h=l-a>rn&&typeof s=="function",c=h?Date.now()+Xn:0,d=0,u=this.commonObjs,f=this.objs,p;for(;;){if(i!==void 0&&a===i.nextBreakPoint)return i.breakIt(a,s),a;if(p=r[a],p!==Et.dependency)this[p].apply(this,n[a]);else for(let g of n[a]){let m=g.startsWith("g_")?u:f;if(!m.has(g))return m.get(g,s),a}if(a++,a===l)return a;if(h&&++d>rn){if(Date.now()>c)return s(),a;d=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let e of this._cachedBitmapsMap.values()){for(let t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){let e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){let t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){let s=e.width??e.displayWidth,i=e.height??e.displayHeight,n=Math.max(Math.hypot(t[0],t[1]),1),r=Math.max(Math.hypot(t[2],t[3]),1),a=s,l=i,h="prescale1",c,d;for(;n>2&&a>1||r>2&&l>1;){let u=a,f=l;n>2&&a>1&&(u=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),n/=a/u),r>2&&l>1&&(f=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,r/=l/f),c=this.cachedCanvases.getCanvas(h,u,f),d=c.context,d.clearRect(0,0,u,f),d.drawImage(e,0,0,a,l,0,0,u,f),e=c.canvas,a=u,l=f,h=h==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:a,paintHeight:l}}_createMaskCanvas(e){let t=this.ctx,{width:s,height:i}=e,n=this.current.fillColor,r=this.current.patternFill,a=et(t),l,h,c,d;if((e.bitmap||e.data)&&e.count>1){let C=e.bitmap||e.data.buffer;h=JSON.stringify(r?a:[a.slice(0,4),n]),l=this._cachedBitmapsMap.get(C),l||(l=new Map,this._cachedBitmapsMap.set(C,l));let S=l.get(h);if(S&&!r){let M=Math.round(Math.min(a[0],a[2])+a[4]),L=Math.round(Math.min(a[1],a[3])+a[5]);return{canvas:S,offsetX:M,offsetY:L}}c=S}c||(d=this.cachedCanvases.getCanvas("maskCanvas",s,i),ln(d.context,e));let u=k.transform(a,[1/s,0,0,-1/i,0,0]);u=k.transform(u,[1,0,0,1,0,-i]);let[f,p,g,m]=k.getAxialAlignedBoundingBox([0,0,s,i],u),v=Math.round(g-f)||1,b=Math.round(m-p)||1,A=this.cachedCanvases.getCanvas("fillCanvas",v,b),w=A.context,y=f,x=p;w.translate(-y,-x),w.transform(...u),c||(c=this._scaleImage(d.canvas,Pt(w)),c=c.img,l&&r&&l.set(h,c)),w.imageSmoothingEnabled=hn(et(w),e.interpolate),Ie(w,c,0,0,c.width,c.height,0,0,s,i),w.globalCompositeOperation="source-in";let E=k.transform(Pt(w),[1,0,0,1,-y,-x]);return w.fillStyle=r?n.getPattern(t,this,E,pt.FILL):n,w.fillRect(0,0,s,i),l&&!r&&(this.cachedCanvases.delete("fillCanvas"),l.set(h,A.canvas)),{canvas:A.canvas,offsetX:Math.round(y),offsetY:Math.round(x)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=Qn[e]}setLineJoin(e){this.ctx.lineJoin=Jn[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){let s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(e),s.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(let[t,s]of e)switch(t){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.current.fillAlpha=s,this.ctx.globalAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let e=this.ctx.canvas.width,t=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(s,e,t);this.suspendedCtx=this.ctx,this.ctx=i.context;let n=this.ctx;n.setTransform(...et(this.suspendedCtx)),ne(this.suspendedCtx,n),Yn(n,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),ne(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let t=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,s,i){let n=i[0],r=i[1],a=i[2]-n,l=i[3]-r;a===0||l===0||(this.genericComposeSMask(t.context,s,a,l,t.subtype,t.backdrop,t.transferMap,n,r,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(s.canvas,0,0),e.restore())}genericComposeSMask(e,t,s,i,n,r,a,l,h,c,d){let u=e.canvas,f=l-c,p=h-d;if(r){let m=k.makeHexColor(...r);if(f<0||p<0||f+s>u.width||p+i>u.height){let v=this.cachedCanvases.getCanvas("maskExtension",s,i),b=v.context;b.drawImage(u,-f,-p),b.globalCompositeOperation="destination-atop",b.fillStyle=m,b.fillRect(0,0,s,i),b.globalCompositeOperation="source-over",u=v.canvas,f=p=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);let v=new Path2D;v.rect(f,p,s,i),e.clip(v),e.globalCompositeOperation="destination-atop",e.fillStyle=m,e.fillRect(f,p,s,i),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),n==="Alpha"&&a?t.filter=this.filterFactory.addAlphaFilter(a):n==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(a));let g=new Path2D;g.rect(l,h,s,i),t.clip(g),t.globalCompositeOperation="destination-in",t.drawImage(u,f,p,s,i,l,h,s,i),t.restore()}save(){this.inSMaskMode?(ne(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),ne(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,s,i,n,r){this.ctx.transform(e,t,s,i,n,r),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,s){let i=this.ctx,n=this.current,r=n.x,a=n.y,l,h,c=et(i),d=c[0]===0&&c[3]===0||c[1]===0&&c[2]===0,u=d?s.slice(0):null;for(let f=0,p=0,g=e.length;f<g;f++)switch(e[f]|0){case Et.rectangle:r=t[p++],a=t[p++];let m=t[p++],v=t[p++],b=r+m,A=a+v;i.moveTo(r,a),m===0||v===0?i.lineTo(b,A):(i.lineTo(b,a),i.lineTo(b,A),i.lineTo(r,A)),d||n.updateRectMinMax(c,[r,a,b,A]),i.closePath();break;case Et.moveTo:r=t[p++],a=t[p++],i.moveTo(r,a),d||n.updatePathMinMax(c,r,a);break;case Et.lineTo:r=t[p++],a=t[p++],i.lineTo(r,a),d||n.updatePathMinMax(c,r,a);break;case Et.curveTo:l=r,h=a,r=t[p+4],a=t[p+5],i.bezierCurveTo(t[p],t[p+1],t[p+2],t[p+3],r,a),n.updateCurvePathMinMax(c,l,h,t[p],t[p+1],t[p+2],t[p+3],r,a,u),p+=6;break;case Et.curveTo2:l=r,h=a,i.bezierCurveTo(r,a,t[p],t[p+1],t[p+2],t[p+3]),n.updateCurvePathMinMax(c,l,h,r,a,t[p],t[p+1],t[p+2],t[p+3],u),r=t[p+2],a=t[p+3],p+=4;break;case Et.curveTo3:l=r,h=a,r=t[p+2],a=t[p+3],i.bezierCurveTo(t[p],t[p+1],r,a,r,a),n.updateCurvePathMinMax(c,l,h,t[p],t[p+1],r,a,r,a,u),p+=4;break;case Et.closePath:i.closePath();break}d&&n.updateScalingPathMinMax(c,u),n.setCurrentPoint(r,a)}closePath(){this.ctx.closePath()}stroke(e=!0){let t=this.ctx,s=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof s=="object"&&s?.getPattern?(t.save(),t.strokeStyle=s.getPattern(t,this,Pt(t),pt.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){let t=this.ctx,s=this.current.fillColor,i=this.current.patternFill,n=!1;i&&(t.save(),t.fillStyle=s.getPattern(t,this,Pt(t),pt.FILL),n=!0);let r=this.current.getClippedPathBoundingBox();this.contentVisible&&r!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),n&&t.restore(),e&&this.consumePath(r)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=Zn}eoClip(){this.pendingClip=cn}beginText(){this.current.textMatrix=fn,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}let s=new Path2D,i=t.getTransform().invertSelf();for(let{transform:n,x:r,y:a,fontSize:l,path:h}of e)s.addPath(h,new DOMMatrix(n).preMultiplySelf(i).translate(r,a).scale(l,-l));t.clip(s),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){let s=this.commonObjs.get(e),i=this.current;if(!s)throw new Error(`Can't find font for ${e}`);if(i.fontMatrix=s.fontMatrix||Cs,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&B("Invalid font matrix for font "+e),t<0?(t=-t,i.fontDirection=-1):i.fontDirection=1,this.current.font=s,this.current.fontSize=t,s.isType3Font)return;let n=s.loadedName||"sans-serif",r=s.systemFontInfo?.css||`"${n}", ${s.fallbackName}`,a="normal";s.black?a="900":s.bold&&(a="bold");let l=s.italic?"italic":"normal",h=t;t<sn?h=sn:t>nn&&(h=nn),this.current.fontSizeScale=t/h,this.ctx.font=`${l} ${a} ${h}px ${r}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,s,i,n,r){this.current.textMatrix=[e,t,s,i,n,r],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}#s(e,t,s){let i=new Path2D;return i.addPath(e,new DOMMatrix(s).invertSelf().multiplySelf(t)),i}paintChar(e,t,s,i,n){let r=this.ctx,a=this.current,l=a.font,h=a.textRenderingMode,c=a.fontSize/a.fontSizeScale,d=h&ft.FILL_STROKE_MASK,u=!!(h&ft.ADD_TO_PATH_FLAG),f=a.patternFill&&!l.missingFile,p=a.patternStroke&&!l.missingFile,g;if((l.disableFontFace||u||f||p)&&(g=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||f||p){if(r.save(),r.translate(t,s),r.scale(c,-c),d===ft.FILL||d===ft.FILL_STROKE)if(i){let m=r.getTransform();r.setTransform(...i),r.fill(this.#s(g,m,i))}else r.fill(g);if(d===ft.STROKE||d===ft.FILL_STROKE)if(n){let m=r.getTransform();r.setTransform(...n),r.stroke(this.#s(g,m,n))}else r.lineWidth/=c,r.stroke(g);r.restore()}else(d===ft.FILL||d===ft.FILL_STROKE)&&r.fillText(e,t,s),(d===ft.STROKE||d===ft.FILL_STROKE)&&r.strokeText(e,t,s);u&&(this.pendingTextPaths||=[]).push({transform:et(r),x:t,y:s,fontSize:c,path:g})}get isFontSubpixelAAEnabled(){let{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);let t=e.getImageData(0,0,10,10).data,s=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){s=!0;break}return z(this,"isFontSubpixelAAEnabled",s)}showText(e){let t=this.current,s=t.font;if(s.isType3Font)return this.showType3Text(e);let i=t.fontSize;if(i===0)return;let n=this.ctx,r=t.fontSizeScale,a=t.charSpacing,l=t.wordSpacing,h=t.fontDirection,c=t.textHScale*h,d=e.length,u=s.vertical,f=u?1:-1,p=s.defaultVMetrics,g=i*t.fontMatrix[0],m=t.textRenderingMode===ft.FILL&&!s.disableFontFace&&!t.patternFill;n.save(),n.transform(...t.textMatrix),n.translate(t.x,t.y+t.textRise),h>0?n.scale(c,-1):n.scale(c,1);let v,b;if(t.patternFill){n.save();let E=t.fillColor.getPattern(n,this,Pt(n),pt.FILL);v=et(n),n.restore(),n.fillStyle=E}if(t.patternStroke){n.save();let E=t.strokeColor.getPattern(n,this,Pt(n),pt.STROKE);b=et(n),n.restore(),n.strokeStyle=E}let A=t.lineWidth,w=t.textMatrixScale;if(w===0||A===0){let E=t.textRenderingMode&ft.FILL_STROKE_MASK;(E===ft.STROKE||E===ft.FILL_STROKE)&&(A=this.getSinglePixelWidth())}else A/=w;if(r!==1&&(n.scale(r,r),A/=r),n.lineWidth=A,s.isInvalidPDFjsFont){let E=[],C=0;for(let S of e)E.push(S.unicode),C+=S.width;n.fillText(E.join(""),0,0),t.x+=C*g*c,n.restore(),this.compose();return}let y=0,x;for(x=0;x<d;++x){let E=e[x];if(typeof E=="number"){y+=f*E*i/1e3;continue}let C=!1,S=(E.isSpace?l:0)+a,M=E.fontChar,L=E.accent,G,H,U=E.width;if(u){let P=E.vmetric||p,R=-(E.vmetric?P[1]:U*.5)*g,X=P[2]*g;U=P?-P[0]:U,G=R/r,H=(y+X)/r}else G=y/r,H=0;if(s.remeasure&&U>0){let P=n.measureText(M).width*1e3/i*r;if(U<P&&this.isFontSubpixelAAEnabled){let R=U/P;C=!0,n.save(),n.scale(R,1),G/=R}else U!==P&&(G+=(U-P)/2e3*i/r)}if(this.contentVisible&&(E.isInFont||s.missingFile)){if(m&&!L)n.fillText(M,G,H);else if(this.paintChar(M,G,H,v,b),L){let P=G+i*L.offset.x/r,R=H-i*L.offset.y/r;this.paintChar(L.fontChar,P,R,v,b)}}let q=u?U*g-S*h:U*g+S*h;y+=q,C&&n.restore()}u?t.y-=y:t.x+=y*c,n.restore(),this.compose()}showType3Text(e){let t=this.ctx,s=this.current,i=s.font,n=s.fontSize,r=s.fontDirection,a=i.vertical?1:-1,l=s.charSpacing,h=s.wordSpacing,c=s.textHScale*r,d=s.fontMatrix||Cs,u=e.length,f=s.textRenderingMode===ft.INVISIBLE,p,g,m,v;if(!(f||n===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...s.textMatrix),t.translate(s.x,s.y),t.scale(c,r),p=0;p<u;++p){if(g=e[p],typeof g=="number"){v=a*g*n/1e3,this.ctx.translate(v,0),s.x+=v*c;continue}let b=(g.isSpace?h:0)+l,A=i.charProcOperatorList[g.operatorListId];if(!A){B(`Type3 character "${g.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=g,this.save(),t.scale(n,n),t.transform(...d),this.executeOperatorList(A),this.restore()),m=k.applyTransform([g.width,0],d)[0]*n+b,t.translate(m,0),s.x+=m*c}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,s,i,n,r){this.ctx.rect(s,i,n-s,r-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){let s=e[1],i=this.baseTransform||et(this.ctx),n={createCanvasGraphics:r=>new o(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new Vn(e,s,this.ctx,n,i)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,s){this.ctx.strokeStyle=this.current.strokeColor=k.makeHexColor(e,t,s),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,s){this.ctx.fillStyle=this.current.fillColor=k.makeHexColor(e,t,s),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let s;return this.cachedPatterns.has(e)?s=this.cachedPatterns.get(e):(s=zn(this.getObject(e)),this.cachedPatterns.set(e,s)),t&&(s.matrix=t),s}shadingFill(e){if(!this.contentVisible)return;let t=this.ctx;this.save();let s=this._getPattern(e);t.fillStyle=s.getPattern(t,this,Pt(t),pt.SHADING);let i=Pt(t);if(i){let{width:n,height:r}=t.canvas,[a,l,h,c]=k.getAxialAlignedBoundingBox([0,0,n,r],i);this.ctx.fillRect(a,l,h-a,c-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){Z("Should not call beginInlineImage")}beginImageData(){Z("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=et(this.ctx),t)){let s=t[2]-t[0],i=t[3]-t[1];this.ctx.rect(t[0],t[1],s,i),this.current.updateRectMinMax(et(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let t=this.ctx;e.isolated||ps("TODO: Support non-isolated groups."),e.knockout&&B("Knockout groups not supported.");let s=et(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let i=k.getAxialAlignedBoundingBox(e.bbox,et(t)),n=[0,0,t.canvas.width,t.canvas.height];i=k.intersect(i,n)||[0,0,0,0];let r=Math.floor(i[0]),a=Math.floor(i[1]),l=Math.max(Math.ceil(i[2])-r,1),h=Math.max(Math.ceil(i[3])-a,1);this.current.startNewPathAndClipBox([0,0,l,h]);let c="groupAt"+this.groupLevel;e.smask&&(c+="_smask_"+this.smaskCounter++%2);let d=this.cachedCanvases.getCanvas(c,l,h),u=d.context;u.translate(-r,-a),u.transform(...s),e.smask?this.smaskStack.push({canvas:d.canvas,context:u,offsetX:r,offsetY:a,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(r,a),t.save()),ne(t,u),this.ctx=u,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;let t=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let i=et(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);let n=k.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],i);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(e,t,s,i,n){if(this.#t(),Pe(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){let r=t[2]-t[0],a=t[3]-t[1];if(n&&this.annotationCanvasMap){s=s.slice(),s[4]-=t[0],s[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=r,t[3]=a;let[l,h]=k.singularValueDecompose2dScale(et(this.ctx)),{viewportScale:c}=this,d=Math.ceil(r*this.outputScaleX*c),u=Math.ceil(a*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(d,u);let{canvas:f,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(e,f),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(l,0,0,-h,0,a*h),Pe(this.ctx)}else Pe(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],r,a),this.ctx.clip(),this.ctx.beginPath()}this.current=new Ye(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;let t=e.count;e=this.getObject(e.data,e),e.count=t;let s=this.ctx,i=this.processingType3;if(i&&(i.compiled===void 0&&(i.compiled=Kn(e)),i.compiled)){i.compiled(s);return}let n=this._createMaskCanvas(e),r=n.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(r,n.offsetX,n.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,s=0,i=0,n,r){if(!this.contentVisible)return;e=this.getObject(e.data,e);let a=this.ctx;a.save();let l=et(a);a.transform(t,s,i,n,0,0);let h=this._createMaskCanvas(e);a.setTransform(1,0,0,1,h.offsetX-l[4],h.offsetY-l[5]);for(let c=0,d=r.length;c<d;c+=2){let u=k.transform(l,[t,s,i,n,r[c],r[c+1]]),[f,p]=k.applyTransform([0,0],u);a.drawImage(h.canvas,f,p)}a.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;let t=this.ctx,s=this.current.fillColor,i=this.current.patternFill;for(let n of e){let{data:r,width:a,height:l,transform:h}=n,c=this.cachedCanvases.getCanvas("maskCanvas",a,l),d=c.context;d.save();let u=this.getObject(r,n);ln(d,u),d.globalCompositeOperation="source-in",d.fillStyle=i?s.getPattern(d,this,Pt(t),pt.FILL):s,d.fillRect(0,0,a,l),d.restore(),t.save(),t.transform(...h),t.scale(1,-1),Ie(t,c.canvas,0,0,a,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;let t=this.getObject(e);if(!t){B("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,s,i){if(!this.contentVisible)return;let n=this.getObject(e);if(!n){B("Dependent image isn't ready yet");return}let r=n.width,a=n.height,l=[];for(let h=0,c=i.length;h<c;h+=2)l.push({transform:[t,0,0,s,i[h],i[h+1]],x:0,y:0,w:r,h:a});this.paintInlineImageXObjectGroup(n,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;let{bitmap:t,width:s,height:i}=e,n=this.cachedCanvases.getCanvas("inlineImage",s,i),r=n.context;return r.filter=this.current.transferMaps,r.drawImage(t,0,0),r.filter="none",n.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;let t=e.width,s=e.height,i=this.ctx;if(this.save(),!gt){let{filter:a}=i;a!=="none"&&a!==""&&(i.filter="none")}i.scale(1/t,-1/s);let n;if(e.bitmap)n=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)n=e;else{let l=this.cachedCanvases.getCanvas("inlineImage",t,s).context;on(l,e),n=this.applyTransferMapsToCanvas(l)}let r=this._scaleImage(n,Pt(i));i.imageSmoothingEnabled=hn(et(i),e.interpolate),Ie(i,r.img,0,0,r.paintWidth,r.paintHeight,0,-s,t,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;let s=this.ctx,i;if(e.bitmap)i=e.bitmap;else{let n=e.width,r=e.height,l=this.cachedCanvases.getCanvas("inlineImage",n,r).context;on(l,e),i=this.applyTransferMapsToCanvas(l)}for(let n of t)s.save(),s.transform(...n.transform),s.scale(1,-1),Ie(s,i,n.x,n.y,n.w,n.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){let t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);let s=this.ctx;this.pendingClip&&(t||(this.pendingClip===cn?s.clip("evenodd"):s.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),s.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let e=et(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{let t=Math.abs(e[0]*e[3]-e[2]*e[1]),s=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){let{lineWidth:e}=this.current,{a:t,b:s,c:i,d:n}=this.ctx.getTransform(),r,a;if(s===0&&i===0){let l=Math.abs(t),h=Math.abs(n);if(l===h)if(e===0)r=a=1/l;else{let c=l*e;r=a=c<1?1/c:1}else if(e===0)r=1/l,a=1/h;else{let c=l*e,d=h*e;r=c<1?1/c:1,a=d<1?1/d:1}}else{let l=Math.abs(t*n-s*i),h=Math.hypot(t,s),c=Math.hypot(i,n);if(e===0)r=c/l,a=h/l;else{let d=e*l;r=c>d?c/d:1,a=h>d?h/d:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e){let{ctx:t}=this,{lineWidth:s}=this.current,[i,n]=this.getScaleForStroking();if(t.lineWidth=s||1,i===1&&n===1){t.stroke();return}let r=t.getLineDash();if(e&&t.save(),t.scale(i,n),r.length>0){let a=Math.max(i,n);t.setLineDash(r.map(l=>l/a)),t.lineDashOffset/=a}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};for(let o in Et)Zt.prototype[o]!==void 0&&(Zt.prototype[Et[o]]=Zt.prototype[o]);var Gt=class{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");this.#t=e}static get workerSrc(){return this.#e}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");this.#e=e}},Ks=class{#t;#e;constructor({parsedData:e,rawData:t}){this.#t=e,this.#e=t}getRaw(){return this.#e}get(e){return this.#t.get(e)??null}getAll(){return Vi(this.#t)}has(e){return this.#t.has(e)}},Jt=Symbol("INTERNAL"),Qs=class{#t=!1;#e=!1;#s=!1;#i=!0;constructor(e,{name:t,intent:s,usage:i,rbGroups:n}){this.#t=!!(e&At.DISPLAY),this.#e=!!(e&At.PRINT),this.name=t,this.intent=s,this.usage=i,this.rbGroups=n}get visible(){if(this.#s)return this.#i;if(!this.#i)return!1;let{print:e,view:t}=this.usage;return this.#t?t?.viewState!=="OFF":this.#e?e?.printState!=="OFF":!0}_setVisible(e,t,s=!1){e!==Jt&&Z("Internal method `_setVisible` called."),this.#s=s,this.#i=t}},Js=class{#t=null;#e=new Map;#s=null;#i=null;constructor(e,t=At.DISPLAY){if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,this.#i=e.order;for(let s of e.groups)this.#e.set(s.id,new Qs(t,s));if(e.baseState==="OFF")for(let s of this.#e.values())s._setVisible(Jt,!1);for(let s of e.on)this.#e.get(s)._setVisible(Jt,!0);for(let s of e.off)this.#e.get(s)._setVisible(Jt,!1);this.#s=this.getHash()}}#r(e){let t=e.length;if(t<2)return!0;let s=e[0];for(let i=1;i<t;i++){let n=e[i],r;if(Array.isArray(n))r=this.#r(n);else if(this.#e.has(n))r=this.#e.get(n).visible;else return B(`Optional content group not found: ${n}`),!0;switch(s){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return s==="And"}isVisible(e){if(this.#e.size===0)return!0;if(!e)return ps("Optional content group not defined."),!0;if(e.type==="OCG")return this.#e.has(e.id)?this.#e.get(e.id).visible:(B(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return this.#r(e.expression);if(!e.policy||e.policy==="AnyOn"){for(let t of e.ids){if(!this.#e.has(t))return B(`Optional content group not found: ${t}`),!0;if(this.#e.get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(let t of e.ids){if(!this.#e.has(t))return B(`Optional content group not found: ${t}`),!0;if(!this.#e.get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(let t of e.ids){if(!this.#e.has(t))return B(`Optional content group not found: ${t}`),!0;if(!this.#e.get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(let t of e.ids){if(!this.#e.has(t))return B(`Optional content group not found: ${t}`),!0;if(this.#e.get(t).visible)return!1}return!0}return B(`Unknown optional content policy ${e.policy}.`),!0}return B(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,s=!0){let i=this.#e.get(e);if(!i){B(`Optional content group not found: ${e}`);return}if(s&&t&&i.rbGroups.length)for(let n of i.rbGroups)for(let r of n)r!==e&&this.#e.get(r)?._setVisible(Jt,!1,!0);i._setVisible(Jt,!!t,!0),this.#t=null}setOCGState({state:e,preserveRB:t}){let s;for(let i of e){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}let n=this.#e.get(i);if(n)switch(s){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!n.visible,t);break}}this.#t=null}get hasInitialVisibility(){return this.#s===null||this.getHash()===this.#s}getOrder(){return this.#e.size?this.#i?this.#i.slice():[...this.#e.keys()]:null}getGroups(){return this.#e.size>0?Vi(this.#e):null}getGroup(e){return this.#e.get(e)||null}getHash(){if(this.#t!==null)return this.#t;let e=new $e;for(let[t,s]of this.#e)e.update(`${t}:${s.visible}`);return this.#t=e.hexdigest()}},Zs=class{constructor(e,{disableRange:t=!1,disableStream:s=!1}){ht(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');let{length:i,initialData:n,progressiveDone:r,contentDispositionFilename:a}=e;if(this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=a,n?.length>0){let l=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!s,this._isRangeSupported=!t,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,h)=>{this._onReceiveData({begin:l,chunk:h})}),e.addProgressListener((l,h)=>{this._onProgress({loaded:l,total:h})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){let s=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{let i=this._rangeReaders.some(function(n){return n._begin!==e?!1:(n._enqueue(s),!0)});ht(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){e.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){let t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){ht(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let e=this._queuedChunks;return this._queuedChunks=null,new qs(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let s=new ti(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(s),s}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}},qs=class{constructor(e,t,s=!1,i=null){this._stream=e,this._done=s||!1,this._filename=Xi(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(let n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}read(){return D(this,null,function*(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise})}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}},ti=class{constructor(e,t,s){this._stream=e,this._begin=t,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(let s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}read(){return D(this,null,function*(){if(this._queuedChunk){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise})}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}};function qn(o){let e=!0,t=s("filename\\*","i").exec(o);if(t){t=t[1];let c=a(t);return c=unescape(c),c=l(c),c=h(c),n(c)}if(t=r(o),t){let c=h(t);return n(c)}if(t=s("filename","i").exec(o),t){t=t[1];let c=a(t);return c=h(c),n(c)}function s(c,d){return new RegExp("(?:^|;)\\s*"+c+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',d)}function i(c,d){if(c){if(!/^[\x00-\xFF]+$/.test(d))return d;try{let u=new TextDecoder(c,{fatal:!0}),f=gs(d);d=u.decode(f),e=!1}catch{}}return d}function n(c){return e&&/[\x80-\xff]/.test(c)&&(c=i("utf-8",c),e&&(c=i("iso-8859-1",c))),c}function r(c){let d=[],u,f=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(u=f.exec(c))!==null;){let[,g,m,v]=u;if(g=parseInt(g,10),g in d){if(g===0)break;continue}d[g]=[m,v]}let p=[];for(let g=0;g<d.length&&g in d;++g){let[m,v]=d[g];v=a(v),m&&(v=unescape(v),g===0&&(v=l(v))),p.push(v)}return p.join("")}function a(c){if(c.startsWith('"')){let d=c.slice(1).split('\\"');for(let u=0;u<d.length;++u){let f=d[u].indexOf('"');f!==-1&&(d[u]=d[u].slice(0,f),d.length=u+1),d[u]=d[u].replaceAll(/\\(.)/g,"$1")}c=d.join('"')}return c}function l(c){let d=c.indexOf("'");if(d===-1)return c;let u=c.slice(0,d),p=c.slice(d+1).replace(/^[^']*'/,"");return i(u,p)}function h(c){return!c.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(c)?c:c.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(d,u,f,p){if(f==="q"||f==="Q")return p=p.replaceAll("_"," "),p=p.replaceAll(/=([0-9a-fA-F]{2})/g,function(g,m){return String.fromCharCode(parseInt(m,16))}),i(u,p);try{p=atob(p)}catch{}return i(u,p)})}return""}function mn(o,e){let t=new Headers;if(!o||!e||typeof e!="object")return t;for(let s in e){let i=e[s];i!==void 0&&t.append(s,i)}return t}function bs(o){try{return new URL(o).origin}catch{}return null}function vn({responseHeaders:o,isHttp:e,rangeChunkSize:t,disableRange:s}){let i={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(o.get("Content-Length"),10);return!Number.isInteger(n)||(i.suggestedLength=n,n<=2*t)||s||!e||o.get("Accept-Ranges")!=="bytes"||(o.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function bn(o){let e=o.get("Content-Disposition");if(e){let t=qn(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(Xi(t))return t}return null}function ys(o,e){return o===404||o===0&&e.startsWith("file:")?new zt('Missing PDF "'+e+'".'):new se(`Unexpected server response (${o}) while retrieving PDF "${e}".`,o)}function yn(o){return o===200||o===206}function An(o,e,t){return{method:"GET",headers:o,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function wn(o){return o instanceof Uint8Array?o.buffer:o instanceof ArrayBuffer?o:(B(`getArrayBuffer - unexpected data format: ${o}`),new Uint8Array(o).buffer)}var Ke=class{_responseOrigin=null;constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=mn(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ht(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new ei(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let s=new si(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},ei=class{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;let t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;let s=new Headers(e.headers),i=t.url;fetch(i,An(s,this._withCredentials,this._abortController)).then(n=>{if(e._responseOrigin=bs(n.url),!yn(n.status))throw ys(n.status,i);this._reader=n.body.getReader(),this._headersCapability.resolve();let r=n.headers,{allowRangeRequests:a,suggestedLength:l}=vn({responseHeaders:r,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=bn(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Mt("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){return D(this,null,function*(){yield this._headersCapability.promise;let{value:e,done:t}=yield this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:wn(e),done:!1})})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}},si=class{constructor(e,t,s){this._stream=e,this._reader=null,this._loaded=0;let i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;let n=new Headers(e.headers);n.append("Range",`bytes=${t}-${s-1}`);let r=i.url;fetch(r,An(n,this._withCredentials,this._abortController)).then(a=>{let l=bs(a.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!yn(a.status))throw ys(a.status,r);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}read(){return D(this,null,function*(){yield this._readCapability.promise;let{value:e,done:t}=yield this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:wn(e),done:!1})})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}},Ss=200,Ts=206;function tr(o){let e=o.response;return typeof e!="string"?e:gs(e).buffer}var ii=class{_responseOrigin=null;constructor({url:e,httpHeaders:t,withCredentials:s}){this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=mn(this.isHttp,t),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){let t=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(let[n,r]of this.headers)t.setRequestHeader(n,r);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=Ts):i.expectedStatus=Ss,t.responseType="arraybuffer",ht(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,s),t.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),s}onProgress(e,t){let s=this.pendingRequests[e];s&&s.onProgress?.(t)}onStateChange(e,t){let s=this.pendingRequests[e];if(!s)return;let i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],i.status===0&&this.isHttp){s.onError(i.status);return}let n=i.status||Ss;if(!(n===Ss&&s.expectedStatus===Ts)&&n!==s.expectedStatus){s.onError(i.status);return}let a=tr(i);if(n===Ts){let l=i.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);h?s.onDone({begin:parseInt(h[1],10),chunk:a}):(B('Missing or invalid "Content-Range" header.'),s.onError(0))}else a?s.onDone({begin:0,chunk:a}):s.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){let t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}},ni=class{constructor(e){this._source=e,this._manager=new ii(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){let t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return ht(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new ri(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){let s=new ai(this._manager,e,t);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},ri=class{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=bs(t.responseURL);let s=t.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{let[l,...h]=a.split(": ");return[l,h.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:r}=vn({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=bn(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=ys(e,this._url),this._headersCapability.reject(this._storedError);for(let t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}read(){return D(this,null,function*(){if(yield this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise})}cancel(e){this._done=!0,this._headersCapability.reject(e);for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}},ai=class{constructor(e,t,s){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){let e=bs(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){let t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(let s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??=ys(e,this._url);for(let t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}read(){return D(this,null,function*(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise})}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}},er=/^[a-z][a-z0-9\-+.]+:/i;function sr(o){if(er.test(o))return new URL(o);let e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(o))}var oi=class{constructor(e){this.source=e,this.url=sr(e.url),ht(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ht(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new li(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let s=new hi(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},li=class{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;let t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();let s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=new zt(`Missing PDF "${this._url}".`)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){return D(this,null,function*(){if(yield this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Mt("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}},hi=class{constructor(e,t,s){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();let i=e.source;this._isStreamingSupported=!i.disableStream;let n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:t,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}read(){return D(this,null,function*(){if(yield this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}},ir=1e5,vt=30,nr=.8,me=class o{#t=Promise.withResolvers();#e=null;#s=!1;#i=!!globalThis.FontInspector?.enabled;#r=null;#n=null;#l=0;#o=0;#c=null;#h=null;#u=0;#d=0;#f=Object.create(null);#a=[];#p=null;#m=[];#g=new WeakMap;#v=null;static#A=new Map;static#b=new Map;static#w=new WeakMap;static#E=null;static#T=new Set;constructor({textContentSource:e,container:t,viewport:s}){if(e instanceof ReadableStream)this.#p=e;else if(typeof e=="object")this.#p=new ReadableStream({start(l){l.enqueue(e),l.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#h=t,this.#d=s.scale*(globalThis.devicePixelRatio||1),this.#u=s.rotation,this.#n={div:null,properties:null,ctx:null};let{pageWidth:i,pageHeight:n,pageX:r,pageY:a}=s.rawDims;this.#v=[1,0,0,-1,-r,a+n],this.#o=i,this.#l=n,o.#M(),Vt(t,s),this.#t.promise.finally(()=>{o.#T.delete(this),this.#n=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:e,isFirefox:t}=ut.platform;return z(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){let e=()=>{this.#c.read().then(({value:t,done:s})=>{if(s){this.#t.resolve();return}this.#r??=t.lang,Object.assign(this.#f,t.styles),this.#R(t.items),e()},this.#t.reject)};return this.#c=this.#p.getReader(),o.#T.add(this),e(),this.#t.promise}update({viewport:e,onBefore:t=null}){let s=e.scale*(globalThis.devicePixelRatio||1),i=e.rotation;if(i!==this.#u&&(t?.(),this.#u=i,Vt(this.#h,{rotation:i})),s!==this.#d){t?.(),this.#d=s;let n={div:null,properties:null,ctx:o.#I(this.#r)};for(let r of this.#m)n.properties=this.#g.get(r),n.div=r,this.#x(n)}}cancel(){let e=new Mt("TextLayer task cancelled.");this.#c?.cancel(e).catch(()=>{}),this.#c=null,this.#t.reject(e)}get textDivs(){return this.#m}get textContentItemsStr(){return this.#a}#R(e){if(this.#s)return;this.#n.ctx??=o.#I(this.#r);let t=this.#m,s=this.#a;for(let i of e){if(t.length>ir){B("Ignoring additional textDivs for performance reasons."),this.#s=!0;return}if(i.str===void 0){if(i.type==="beginMarkedContentProps"||i.type==="beginMarkedContent"){let n=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),i.id!==null&&this.#e.setAttribute("id",`${i.id}`),n.append(this.#e)}else i.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}s.push(i.str),this.#P(i)}}#P(e){let t=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};this.#m.push(t);let i=k.transform(this.#v,e.transform),n=Math.atan2(i[1],i[0]),r=this.#f[e.fontName];r.vertical&&(n+=Math.PI/2);let a=this.#i&&r.fontSubstitution||r.fontFamily;a=o.fontFamilyMap.get(a)||a;let l=Math.hypot(i[2],i[3]),h=l*o.#D(a,this.#r),c,d;n===0?(c=i[4],d=i[5]-h):(c=i[4]+h*Math.sin(n),d=i[5]-h*Math.cos(n));let u="calc(var(--scale-factor)*",f=t.style;this.#e===this.#h?(f.left=`${(100*c/this.#o).toFixed(2)}%`,f.top=`${(100*d/this.#l).toFixed(2)}%`):(f.left=`${u}${c.toFixed(2)}px)`,f.top=`${u}${d.toFixed(2)}px)`),f.fontSize=`${u}${(o.#E*l).toFixed(2)}px)`,f.fontFamily=a,s.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,this.#i&&(t.dataset.fontName=r.fontSubstitutionLoadedName||e.fontName),n!==0&&(s.angle=n*(180/Math.PI));let p=!1;if(e.str.length>1)p=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){let g=Math.abs(e.transform[0]),m=Math.abs(e.transform[3]);g!==m&&Math.max(g,m)/Math.min(g,m)>1.5&&(p=!0)}if(p&&(s.canvasWidth=r.vertical?e.height:e.width),this.#g.set(t,s),this.#n.div=t,this.#n.properties=s,this.#x(this.#n),s.hasText&&this.#e.append(t),s.hasEOL){let g=document.createElement("br");g.setAttribute("role","presentation"),this.#e.append(g)}}#x(e){let{div:t,properties:s,ctx:i}=e,{style:n}=t,r="";if(o.#E>1&&(r=`scale(${1/o.#E})`),s.canvasWidth!==0&&s.hasText){let{fontFamily:a}=n,{canvasWidth:l,fontSize:h}=s;o.#C(i,h*this.#d,a);let{width:c}=i.measureText(t.textContent);c>0&&(r=`scaleX(${l*this.#d/c}) ${r}`)}s.angle!==0&&(r=`rotate(${s.angle}deg) ${r}`),r.length>0&&(n.transform=r)}static cleanup(){if(!(this.#T.size>0)){this.#A.clear();for(let{canvas:e}of this.#b.values())e.remove();this.#b.clear()}}static#I(e=null){let t=this.#b.get(e||="");if(!t){let s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=e,document.body.append(s),t=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#b.set(e,t),this.#w.set(t,{size:0,family:""})}return t}static#C(e,t,s){let i=this.#w.get(e);t===i.size&&s===i.family||(e.font=`${t}px ${s}`,i.size=t,i.family=s)}static#M(){if(this.#E!==null)return;let e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),this.#E=e.getBoundingClientRect().height,e.remove()}static#D(e,t){let s=this.#A.get(e);if(s)return s;let i=this.#I(t);i.canvas.width=i.canvas.height=vt,this.#C(i,vt,e);let n=i.measureText(""),r=n.fontBoundingBoxAscent,a=Math.abs(n.fontBoundingBoxDescent);if(r){let c=r/(r+a);return this.#A.set(e,c),i.canvas.width=i.canvas.height=0,c}i.strokeStyle="red",i.clearRect(0,0,vt,vt),i.strokeText("g",0,0);let l=i.getImageData(0,0,vt,vt).data;a=0;for(let c=l.length-1-3;c>=0;c-=4)if(l[c]>0){a=Math.ceil(c/4/vt);break}i.clearRect(0,0,vt,vt),i.strokeText("A",0,vt),l=i.getImageData(0,0,vt,vt).data,r=0;for(let c=0,d=l.length;c<d;c+=4)if(l[c]>0){r=vt-Math.floor(c/4/vt);break}i.canvas.width=i.canvas.height=0;let h=r?r/(r+a):nr;return this.#A.set(e,h),h}},ve=class o{static textContent(e){let t=[],s={items:t,styles:Object.create(null)};function i(n){if(!n)return;let r=null,a=n.name;if(a==="#text")r=n.value;else if(o.shouldBuildText(a))n?.attributes?.textContent?r=n.attributes.textContent:n.value&&(r=n.value);else return;if(r!==null&&t.push({str:r}),!!n.children)for(let l of n.children)i(l)}return i(e),s}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}},rr=65536,ar=100,or=5e3,lr=gt?js:Bs,hr=gt?Us:ze,cr=gt?$s:Hs,dr=gt?Gs:Xe;function ur(o={}){typeof o=="string"||o instanceof URL?o={url:o}:(o instanceof ArrayBuffer||ArrayBuffer.isView(o))&&(o={data:o});let e=new ci,{docId:t}=e,s=o.url?fr(o.url):null,i=o.data?pr(o.data):null,n=o.httpHeaders||null,r=o.withCredentials===!0,a=o.password??null,l=o.range instanceof Qe?o.range:null,h=Number.isInteger(o.rangeChunkSize)&&o.rangeChunkSize>0?o.rangeChunkSize:rr,c=o.worker instanceof qt?o.worker:null,d=o.verbosity,u=typeof o.docBaseUrl=="string"&&!vs(o.docBaseUrl)?o.docBaseUrl:null,f=typeof o.cMapUrl=="string"?o.cMapUrl:null,p=o.cMapPacked!==!1,g=o.CMapReaderFactory||hr,m=typeof o.standardFontDataUrl=="string"?o.standardFontDataUrl:null,v=o.StandardFontDataFactory||dr,b=o.stopAtErrors!==!0,A=Number.isInteger(o.maxImageSize)&&o.maxImageSize>-1?o.maxImageSize:-1,w=o.isEvalSupported!==!1,y=typeof o.isOffscreenCanvasSupported=="boolean"?o.isOffscreenCanvasSupported:!gt,x=typeof o.isImageDecoderSupported=="boolean"?o.isImageDecoderSupported:!gt&&(ut.platform.isFirefox||!globalThis.chrome),E=Number.isInteger(o.canvasMaxAreaInBytes)?o.canvasMaxAreaInBytes:-1,C=typeof o.disableFontFace=="boolean"?o.disableFontFace:gt,S=o.fontExtraProperties===!0,M=o.enableXfa===!0,L=o.ownerDocument||globalThis.document,G=o.disableRange===!0,H=o.disableStream===!0,U=o.disableAutoFetch===!0,q=o.pdfBug===!0,P=o.CanvasFactory||lr,R=o.FilterFactory||cr,X=o.enableHWA===!0,Y=l?l.length:o.length??NaN,st=typeof o.useSystemFonts=="boolean"?o.useSystemFonts:!gt&&!C,nt=typeof o.useWorkerFetch=="boolean"?o.useWorkerFetch:g===ze&&v===Xe&&f&&m&&oe(f,document.baseURI)&&oe(m,document.baseURI),K=null;In(d);let Q={canvasFactory:new P({ownerDocument:L,enableHWA:X}),filterFactory:new R({docId:t,ownerDocument:L}),cMapReaderFactory:nt?null:new g({baseUrl:f,isCompressed:p}),standardFontDataFactory:nt?null:new v({baseUrl:m})};if(!c){let _={verbosity:d,port:Gt.workerPort};c=_.port?qt.fromPort(_):new qt(_),e._worker=c}let Tt={docId:t,apiVersion:"4.10.38",data:i,password:a,disableAutoFetch:U,rangeChunkSize:h,length:Y,docBaseUrl:u,enableXfa:M,evaluatorOptions:{maxImageSize:A,disableFontFace:C,ignoreErrors:b,isEvalSupported:w,isOffscreenCanvasSupported:y,isImageDecoderSupported:x,canvasMaxAreaInBytes:E,fontExtraProperties:S,useSystemFonts:st,cMapUrl:nt?f:null,standardFontDataUrl:nt?m:null}},Ct={disableFontFace:C,fontExtraProperties:S,ownerDocument:L,pdfBug:q,styleElement:K,loadingParams:{disableAutoFetch:U,enableXfa:M}};return c.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");let _=c.messageHandler.sendWithPromise("GetDocRequest",Tt,i?[i.buffer]:null),T;if(l)T=new Zs(l,{disableRange:G,disableStream:H});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");let I;if(gt)if(oe(s)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");I=Ke}else I=oi;else I=oe(s)?Ke:ni;T=new I({url:s,length:Y,httpHeaders:n,withCredentials:r,rangeChunkSize:h,disableRange:G,disableStream:H})}return _.then(I=>{if(e.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");let $=new $t(t,I,c.port),J=new pi($,e,T,Ct,Q);e._transport=J,$.send("Ready",null)})}).catch(e._capability.reject),e}function fr(o){if(o instanceof URL)return o.href;try{return new URL(o,window.location).href}catch{if(gt&&typeof o=="string")return o}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function pr(o){if(gt&&typeof Buffer<"u"&&o instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength)return o;if(typeof o=="string")return gs(o);if(o instanceof ArrayBuffer||ArrayBuffer.isView(o)||typeof o=="object"&&!isNaN(o?.length))return new Uint8Array(o);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function dn(o){return typeof o=="object"&&Number.isInteger(o?.num)&&o.num>=0&&Number.isInteger(o?.gen)&&o.gen>=0}var ci=class o{static#t=0;constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${o.#t++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}destroy(){return D(this,null,function*(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),yield this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null})}},Qe=class{constructor(e,t,s=!1,i=null){this.length=e,this.initialData=t,this.progressiveDone=s,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(let s of this._rangeListeners)s(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(let s of this._progressListeners)s(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(let t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){Z("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},di=class{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return z(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}},ui=class{#t=null;#e=!1;constructor(e,t,s,i=!1){this._pageIndex=e,this._pageInfo=t,this._transport=s,this._stats=i?new Ne:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new Je,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:n=!1}={}){return new ce({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:n})}getAnnotations({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return z(this,"isPureXfa",!!this._transport._htmlForXfa)}getXfa(){return D(this,null,function*(){return this._transport._htmlForXfa?.children[this._pageIndex]||null})}render({canvasContext:e,viewport:t,intent:s="display",annotationMode:i=kt.ENABLE,transform:n=null,background:r=null,optionalContentConfigPromise:a=null,annotationCanvasMap:l=null,pageColors:h=null,printAnnotationStorage:c=null,isEditing:d=!1}){this._stats?.time("Overall");let u=this._transport.getRenderingIntent(s,i,c,d),{renderingIntent:f,cacheKey:p}=u;this.#e=!1,this.#i(),a||=this._transport.getOptionalContentConfig(f);let g=this._intentStates.get(p);g||(g=Object.create(null),this._intentStates.set(p,g)),g.streamReaderCancelTimeout&&(clearTimeout(g.streamReaderCancelTimeout),g.streamReaderCancelTimeout=null);let m=!!(f&At.PRINT);g.displayReadyCapability||(g.displayReadyCapability=Promise.withResolvers(),g.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(u));let v=w=>{g.renderTasks.delete(b),(this._maybeCleanupAfterRender||m)&&(this.#e=!0),this.#s(!m),w?(b.capability.reject(w),this._abortOperatorList({intentState:g,reason:w instanceof Error?w:new Error(w)})):b.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},b=new mi({callback:v,params:{canvasContext:e,viewport:t,transform:n,background:r},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:g.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!m,pdfBug:this._pdfBug,pageColors:h});(g.renderTasks||=new Set).add(b);let A=b.task;return Promise.all([g.displayReadyCapability.promise,a]).then(([w,y])=>{if(this.destroyed){v();return}if(this._stats?.time("Rendering"),!(y.renderingIntent&f))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");b.initializeGraphics({transparency:w,optionalContentConfig:y}),b.operatorListChanged()}).catch(v),A}getOperatorList({intent:e="display",annotationMode:t=kt.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){function n(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}let r=this._transport.getRenderingIntent(e,t,s,i,!0),a=this._intentStates.get(r.cacheKey);a||(a=Object.create(null),this._intentStates.set(r.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=n,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||=new Set).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(r)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>ve.textContent(s));let t=this.streamTextContent(e);return new Promise(function(s,i){function n(){r.read().then(function({value:l,done:h}){if(h){s(a);return}a.lang??=l.lang,Object.assign(a.styles,l.styles),a.items.push(...l.items),n()},i)}let r=t.getReader(),a={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let e=[];for(let t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(let s of t.renderTasks)e.push(s.completed),s.cancel();return this.objs.clear(),this.#e=!1,this.#i(),Promise.all(e)}cleanup(e=!1){this.#e=!0;let t=this.#s(!1);return e&&t&&(this._stats&&=new Ne),t}#s(e=!1){if(this.#i(),!this.#e||this.destroyed)return!1;if(e)return this.#t=setTimeout(()=>{this.#t=null,this.#s(!1)},or),!1;for(let{renderTasks:t,operatorList:s}of this._intentStates.values())if(t.size>0||!s.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}#i(){this.#t&&(clearTimeout(this.#t),this.#t=null)}_startRenderPage(e,t){let s=this._intentStates.get(t);s&&(this._stats?.timeEnd("Page Request"),s.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let s=0,i=e.length;s<i;s++)t.operatorList.fnArray.push(e.fnArray[s]),t.operatorList.argsArray.push(e.argsArray[s]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(let s of t.renderTasks)s.operatorListChanged();e.lastChunk&&this.#s(!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:s,modifiedIds:i}){let{map:n,transfer:r}=s,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:n,modifiedIds:i},r).getReader(),h=this._intentStates.get(t);h.streamReader=l;let c=()=>{l.read().then(({value:d,done:u})=>{if(u){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(d,h),c())},d=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(let u of h.renderTasks)u.operatorListChanged();this.#s(!0)}if(h.displayReadyCapability)h.displayReadyCapability.reject(d);else if(h.opListReadCapability)h.opListReadCapability.reject(d);else throw d}})};c()}_abortOperatorList({intentState:e,reason:t,force:s=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!s){if(e.renderTasks.size>0)return;if(t instanceof de){let i=ar;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new Mt(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(let[i,n]of this._intentStates)if(n===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}},fi=class{#t=new Map;#e=Promise.resolve();postMessage(e,t){let s={data:structuredClone(e,t?{transfer:t}:null)};this.#e.then(()=>{for(let[i]of this.#t)i.call(this,s)})}addEventListener(e,t,s=null){let i=null;if(s?.signal instanceof AbortSignal){let{signal:n}=s;if(n.aborted){B("LoopbackPort - cannot use an `aborted` signal.");return}let r=()=>this.removeEventListener(e,t);i=()=>n.removeEventListener("abort",r),n.addEventListener("abort",r)}this.#t.set(t,i)}removeEventListener(e,t){this.#t.get(t)?.(),this.#t.delete(t)}terminate(){for(let[,e]of this.#t)e?.();this.#t.clear()}},ds,jt,Ut,te,Oe,ee,De,tt=class tt{constructor({name:e=null,port:t=null,verbosity:s=Pn()}={}){Qt(this,te);if(this.name=e,this.destroyed=!1,this.verbosity=s,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if(It(tt,Ut)?.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(It(tt,Ut)||Te(tt,Ut,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new $t("main","worker",e),this._messageHandler.on("ready",function(){}),Ce(this,te,Oe).call(this)}_initialize(){if(It(tt,jt)||It(tt,ee,De)){this._setupFakeWorker();return}let{workerSrc:e}=tt;try{tt._isSameOrigin(window.location.href,e)||(e=tt._createCDNWrapper(new URL(e,window.location).href));let t=new Worker(e,{type:"module"}),s=new $t("main","worker",t),i=()=>{n.abort(),s.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},n=new AbortController;t.addEventListener("error",()=>{this._webWorker||i()},{signal:n.signal}),s.on("test",a=>{if(n.abort(),this.destroyed||!a){i();return}this._messageHandler=s,this._port=t,this._webWorker=t,Ce(this,te,Oe).call(this)}),s.on("ready",a=>{if(n.abort(),this.destroyed){i();return}try{r()}catch{this._setupFakeWorker()}});let r=()=>{let a=new Uint8Array;s.send("test",a,[a.buffer])};r();return}catch{ps("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){It(tt,jt)||(B("Setting up fake worker."),Te(tt,jt,!0)),tt._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let t=new fi;this._port=t;let s=`fake${Ki(tt,ds)._++}`,i=new $t(s+"_worker",s,t);e.setup(i,t),this._messageHandler=new $t(s,s+"_worker",t),Ce(this,te,Oe).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){this.destroyed=!0,this._webWorker?.terminate(),this._webWorker=null,It(tt,Ut)?.delete(this._port),this._port=null,this._messageHandler?.destroy(),this._messageHandler=null}static fromPort(e){if(!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");let t=It(this,Ut)?.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new tt(e)}static get workerSrc(){if(Gt.workerSrc)return Gt.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return z(this,"_setupFakeWorkerGlobal",D(this,null,function*(){return It(this,ee,De)?It(this,ee,De):(yield import(this.workerSrc)).WorkerMessageHandler}))}};ds=new WeakMap,jt=new WeakMap,Ut=new WeakMap,te=new WeakSet,Oe=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},ee=new WeakSet,De=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},Qt(tt,ee),Qt(tt,ds,0),Qt(tt,jt,!1),Qt(tt,Ut),gt&&(Te(tt,jt,!0),Gt.workerSrc||="./pdf.worker.mjs"),tt._isSameOrigin=(e,t)=>{let s;try{if(s=new URL(e),!s.origin||s.origin==="null")return!1}catch{return!1}let i=new URL(t,s);return s.origin===i.origin},tt._createCDNWrapper=e=>{let t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};var qt=tt,pi=class{#t=new Map;#e=new Map;#s=new Map;#i=new Map;#r=null;constructor(e,t,s,i,n){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new Je,this.fontLoader=new Ns({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#n(e,t=null){let s=this.#t.get(e);if(s)return s;let i=this.messageHandler.sendWithPromise(e,t);return this.#t.set(e,i),i}get annotationStorage(){return z(this,"annotationStorage",new pe)}getRenderingIntent(e,t=kt.ENABLE,s=null,i=!1,n=!1){let r=At.DISPLAY,a=ks;switch(e){case"any":r=At.ANY;break;case"display":break;case"print":r=At.PRINT;break;default:B(`getRenderingIntent - invalid intent: ${e}`)}let l=r&At.PRINT&&s instanceof je?s:this.annotationStorage;switch(t){case kt.DISABLE:r+=At.ANNOTATIONS_DISABLE;break;case kt.ENABLE:break;case kt.ENABLE_FORMS:r+=At.ANNOTATIONS_FORMS;break;case kt.ENABLE_STORAGE:r+=At.ANNOTATIONS_STORAGE,a=l.serializable;break;default:B(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(r+=At.IS_EDITING),n&&(r+=At.OPLIST);let{ids:h,hash:c}=l.modifiedIds,d=[r,a.hash,c];return{renderingIntent:r,cacheKey:d.join("_"),annotationStorageSerializable:a,modifiedIds:h}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));let e=[];for(let s of this.#e.values())e.push(s._destroy());this.#e.clear(),this.#s.clear(),this.#i.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),me.cleanup(),this._networkStream?.cancelAllRequests(new Mt("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(s,i)=>{ht(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},i.onPull=()=>{this._fullReader.read().then(function({value:n,done:r}){if(r){i.close();return}ht(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{i.error(n)})},i.onCancel=n=>{this._fullReader.cancel(n),i.ready.catch(r=>{if(!this.destroyed)throw r})}}),e.on("ReaderHeadersReady",s=>D(this,null,function*(){yield this._fullReader.headersReady;let{isStreamingSupported:i,isRangeSupported:n,contentLength:r}=this._fullReader;return(!i||!n)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),this._fullReader.onProgress=a=>{t.onProgress?.({loaded:a.loaded,total:a.total})}),{isStreamingSupported:i,isRangeSupported:n,contentLength:r}})),e.on("GetRangeReader",(s,i)=>{ht(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let n=this._networkStream.getRangeReader(s.begin,s.end);if(!n){i.close();return}i.onPull=()=>{n.read().then(function({value:r,done:a}){if(a){i.close();return}ht(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{n.cancel(r),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,t._capability.resolve(new di(s,this))}),e.on("DocException",s=>{t._capability.reject(bt(s))}),e.on("PasswordRequest",s=>{this.#r=Promise.withResolvers();try{if(!t.onPassword)throw bt(s);let i=n=>{n instanceof Error?this.#r.reject(n):this.#r.resolve({password:n})};t.onPassword(i,s.code)}catch(i){this.#r.reject(i)}return this.#r.promise}),e.on("DataLoaded",s=>{t.onProgress?.({loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),e.on("StartRenderPage",s=>{if(this.destroyed)return;this.#e.get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),e.on("commonobj",([s,i,n])=>{if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":let{disableFontFace:r,fontExtraProperties:a,pdfBug:l}=this._params;if("error"in n){let u=n.error;B(`Error during font loading: ${u}`),this.commonObjs.resolve(s,u);break}let h=l&&globalThis.FontInspector?.enabled?(u,f)=>globalThis.FontInspector.fontAdded(u,f):null,c=new Fs(n,{disableFontFace:r,fontExtraProperties:a,inspectFont:h});this.fontLoader.bind(c).catch(()=>e.sendWithPromise("FontFallback",{id:s})).finally(()=>{!a&&c.data&&(c.data=null),this.commonObjs.resolve(s,c)});break;case"CopyLocalImage":let{imageRef:d}=n;ht(d,"The imageRef must be defined.");for(let u of this.#e.values())for(let[,f]of u.objs)if(f?.ref===d)return f.dataLen?(this.commonObjs.resolve(s,structuredClone(f)),f.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,n);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([s,i,n,r])=>{if(this.destroyed)return;let a=this.#e.get(i);if(!a.objs.has(s)){if(a._intentStates.size===0){r?.bitmap?.close();return}switch(n){case"Image":a.objs.resolve(s,r),r?.dataLen>En&&(a._maybeCleanupAfterRender=!0);break;case"Pattern":a.objs.resolve(s,r);break;default:throw new Error(`Got unknown object type ${n}`)}}}),e.on("DocProgress",s=>{this.destroyed||t.onProgress?.({loaded:s.loaded,total:s.total})}),e.on("FetchBuiltInCMap",s=>D(this,null,function*(){if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(s)})),e.on("FetchStandardFontData",s=>D(this,null,function*(){if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(s)}))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&B("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));let t=e-1,s=this.#s.get(t);if(s)return s;let i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&this.#i.set(n.refStr,e);let r=new ui(t,n,this,this._params.pdfBug);return this.#e.set(t,r),r});return this.#s.set(t,i),i}getPageIndex(e){return dn(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return this.#n("GetFieldObjects")}hasJSActions(){return this.#n("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#n("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#n("GetOptionalContentConfig").then(t=>new Js(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let e="GetMetadata",t=this.#t.get(e);if(t)return t;let s=this.messageHandler.sendWithPromise(e,null).then(i=>({info:i[0],metadata:i[1]?new Ks(i[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(e,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}startCleanup(e=!1){return D(this,null,function*(){if(!this.destroyed){yield this.messageHandler.sendWithPromise("Cleanup",null);for(let t of this.#e.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),me.cleanup()}})}cachedPageNumber(e){if(!dn(e))return null;let t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return this.#i.get(t)??null}},re=Symbol("INITIAL_DATA"),Je=class{#t=Object.create(null);#e(e){return this.#t[e]||=Kt(Lt({},Promise.withResolvers()),{data:re})}get(e,t=null){if(t){let i=this.#e(e);return i.promise.then(()=>t(i.data)),null}let s=this.#t[e];if(!s||s.data===re)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return s.data}has(e){let t=this.#t[e];return!!t&&t.data!==re}delete(e){let t=this.#t[e];return!t||t.data===re?!1:(delete this.#t[e],!0)}resolve(e,t=null){let s=this.#e(e);s.data=t,s.resolve()}clear(){for(let e in this.#t){let{data:t}=this.#t[e];t?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(let e in this.#t){let{data:t}=this.#t[e];t!==re&&(yield[e,t])}}},gi=class{#t=null;constructor(e){this.#t=e,this.onContinue=null}get promise(){return this.#t.capability.promise}cancel(e=0){this.#t.cancel(null,e)}get separateAnnots(){let{separateAnnots:e}=this.#t.operatorList;if(!e)return!1;let{annotationCanvasMap:t}=this.#t;return e.form||e.canvas&&t?.size>0}},mi=class o{#t=null;static#e=new WeakSet;constructor({callback:e,params:t,objs:s,commonObjs:i,annotationCanvasMap:n,operatorList:r,pageIndex:a,canvasFactory:l,filterFactory:h,useRequestAnimationFrame:c=!1,pdfBug:d=!1,pageColors:u=null}){this.callback=e,this.params=t,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=h,this._pdfBug=d,this.pageColors=u,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=c===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new gi(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(o.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");o.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:s,viewport:i,transform:n,background:r}=this.params;this.gfx=new Zt(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:n,viewport:i,transparency:e,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),o.#e.delete(this._canvas),this.callback(e||new de(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}_next(){return D(this,null,function*(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),o.#e.delete(this._canvas),this.callback())))})}},gr="4.10.38",mr="f9bea397f",Yr=W(670);function un(o){return Math.floor(Math.max(0,Math.min(1,o))*255).toString(16).padStart(2,"0")}function ae(o){return Math.max(0,Math.min(255,255*o))}var Ze=class{static CMYK_G([e,t,s,i]){return["G",1-Math.min(1,.3*e+.59*s+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=ae(e),[e,e,e]}static G_HTML([e]){let t=un(e);return`#${t}${t}${t}`}static RGB_G([e,t,s]){return["G",.3*e+.59*t+.11*s]}static RGB_rgb(e){return e.map(ae)}static RGB_HTML(e){return`#${e.map(un).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,s,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,s+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,s,i]){return[ae(1-Math.min(1,e+i)),ae(1-Math.min(1,s+i)),ae(1-Math.min(1,t+i))]}static CMYK_HTML(e){let t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,s]){let i=1-e,n=1-t,r=1-s,a=Math.min(i,n,r);return["CMYK",i,n,r,a]}},vi=class{create(e,t,s=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");let i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Z("Abstract method `_createSVG` called.")}},be=class extends vi{_createSVG(e){return document.createElementNS(Ot,e)}},qe=class{static setupStorage(e,t,s,i,n){let r=i.getValue(t,{value:null});switch(s.name){case"textarea":if(r.value!==null&&(e.textContent=r.value),n==="print")break;e.addEventListener("input",a=>{i.setValue(t,{value:a.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(r.value===s.attributes.xfaOn?e.setAttribute("checked",!0):r.value===s.attributes.xfaOff&&e.removeAttribute("checked"),n==="print")break;e.addEventListener("change",a=>{i.setValue(t,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&e.setAttribute("value",r.value),n==="print")break;e.addEventListener("input",a=>{i.setValue(t,{value:a.target.value})})}break;case"select":if(r.value!==null){e.setAttribute("value",r.value);for(let a of s.children)a.attributes.value===r.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}e.addEventListener("input",a=>{let l=a.target.options,h=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(t,{value:h})});break}}static setAttributes({html:e,element:t,storage:s=null,intent:i,linkService:n}){let{attributes:r}=t,a=e instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${i}`);for(let[l,h]of Object.entries(r))if(h!=null)switch(l){case"class":h.length&&e.setAttribute(l,h.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",h);break;case"style":Object.assign(e.style,h);break;case"textContent":e.textContent=h;break;default:(!a||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,h)}a&&n.addLinkAttributes(e,r.href,r.newWindow),s&&r.dataId&&this.setupStorage(e,r.dataId,t,s)}static render(e){let t=e.annotationStorage,s=e.linkService,i=e.xfaHtml,n=e.intent||"display",r=document.createElement(i.name);i.attributes&&this.setAttributes({html:r,element:i,intent:n,linkService:s});let a=n!=="richText",l=e.div;if(l.append(r),e.viewport){let d=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=d}a&&l.setAttribute("class","xfaLayer xfaFont");let h=[];if(i.children.length===0){if(i.value){let d=document.createTextNode(i.value);r.append(d),a&&ve.shouldBuildText(i.name)&&h.push(d)}return{textDivs:h}}let c=[[i,-1,r]];for(;c.length>0;){let[d,u,f]=c.at(-1);if(u+1===d.children.length){c.pop();continue}let p=d.children[++c.at(-1)[1]];if(p===null)continue;let{name:g}=p;if(g==="#text"){let v=document.createTextNode(p.value);h.push(v),f.append(v);continue}let m=p?.attributes?.xmlns?document.createElementNS(p.attributes.xmlns,g):document.createElement(g);if(f.append(m),p.attributes&&this.setAttributes({html:m,element:p,storage:t,intent:n,linkService:s}),p.children?.length>0)c.push([p,-1,m]);else if(p.value){let v=document.createTextNode(p.value);a&&ve.shouldBuildText(g)&&h.push(v),m.append(v)}}for(let d of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))d.setAttribute("readOnly",!0);return{textDivs:h}}static update(e){let t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}},Ee=1e3,vr=9,Xt=new WeakSet;function Nt(o){return{width:o[2]-o[0],height:o[3]-o[1]}}var bi=class{static create(e){switch(e.data.annotationType){case ct.LINK:return new ts(e);case ct.TEXT:return new yi(e);case ct.WIDGET:switch(e.data.fieldType){case"Tx":return new Ai(e);case"Btn":return e.data.radioButton?new es(e):e.data.checkBox?new xi(e):new Ei(e);case"Ch":return new Si(e);case"Sig":return new wi(e)}return new Dt(e);case ct.POPUP:return new ye(e);case ct.FREETEXT:return new ss(e);case ct.LINE:return new Ci(e);case ct.SQUARE:return new Ri(e);case ct.CIRCLE:return new Ii(e);case ct.POLYLINE:return new is(e);case ct.CARET:return new _i(e);case ct.INK:return new Ae(e);case ct.POLYGON:return new Pi(e);case ct.HIGHLIGHT:return new ns(e);case ct.UNDERLINE:return new Mi(e);case ct.SQUIGGLY:return new Li(e);case ct.STRIKEOUT:return new Oi(e);case ct.STAMP:return new rs(e);case ct.FILEATTACHMENT:return new Di(e);default:return new ot(e)}}},ot=class o{#t=null;#e=!1;#s=null;constructor(e,{isRenderable:t=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:s}){return!!(e?.str||t?.str||s?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return o._hasPopupData(this.data)}updateEdited(e){if(!this.container)return;this.#t||={rect:this.data.rect.slice(0)};let{rect:t}=e;t&&this.#i(t),this.#s?.popup.updateEdited(e)}resetEdited(){this.#t&&(this.#i(this.#t.rect),this.#s?.popup.resetEdited(),this.#t=null)}#i(e){let{container:{style:t},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:a,pageY:l}}}}=this;s?.splice(0,4,...e);let{width:h,height:c}=Nt(e);t.left=`${100*(e[0]-a)/n}%`,t.top=`${100*(r-e[3]+l)/r}%`,i===0?(t.width=`${100*h/n}%`,t.height=`${100*c/r}%`):this.setRotation(i)}_createContainer(e){let{data:t,parent:{page:s,viewport:i}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",t.id),this instanceof Dt||(n.tabIndex=Ee);let{style:r}=n;if(r.zIndex=this.parent.zIndex++,t.alternativeText&&(n.title=t.alternativeText),t.noRotate&&n.classList.add("norotate"),!t.rect||this instanceof ye){let{rotation:g}=t;return!t.hasOwnCanvas&&g!==0&&this.setRotation(g,n),n}let{width:a,height:l}=Nt(t.rect);if(!e&&t.borderStyle.width>0){r.borderWidth=`${t.borderStyle.width}px`;let g=t.borderStyle.horizontalCornerRadius,m=t.borderStyle.verticalCornerRadius;if(g>0||m>0){let b=`calc(${g}px * var(--scale-factor)) / calc(${m}px * var(--scale-factor))`;r.borderRadius=b}else if(this instanceof es){let b=`calc(${a}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;r.borderRadius=b}switch(t.borderStyle.style){case ie.SOLID:r.borderStyle="solid";break;case ie.DASHED:r.borderStyle="dashed";break;case ie.BEVELED:B("Unimplemented border style: beveled");break;case ie.INSET:B("Unimplemented border style: inset");break;case ie.UNDERLINE:r.borderBottomStyle="solid";break;default:break}let v=t.borderColor||null;v?(this.#e=!0,r.borderColor=k.makeHexColor(v[0]|0,v[1]|0,v[2]|0)):r.borderWidth=0}let h=k.normalizeRect([t.rect[0],s.view[3]-t.rect[1]+s.view[1],t.rect[2],s.view[3]-t.rect[3]+s.view[1]]),{pageWidth:c,pageHeight:d,pageX:u,pageY:f}=i.rawDims;r.left=`${100*(h[0]-u)/c}%`,r.top=`${100*(h[1]-f)/d}%`;let{rotation:p}=t;return t.hasOwnCanvas||p===0?(r.width=`${100*a/c}%`,r.height=`${100*l/d}%`):this.setRotation(p,n),n}setRotation(e,t=this.container){if(!this.data.rect)return;let{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims,{width:n,height:r}=Nt(this.data.rect),a,l;e%180===0?(a=100*n/s,l=100*r/i):(a=100*r/s,l=100*n/i),t.style.width=`${a}%`,t.style.height=`${l}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){let e=(t,s,i)=>{let n=i.detail[t],r=n[0],a=n.slice(1);i.target.style[s]=Ze[`${r}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[s]:Ze[`${r}_rgb`](a)})};return z(this,"_commonActions",{display:t=>{let{display:s}=t.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{let{hidden:s}=t.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{let s=t.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(e,t){let s=this._commonActions;for(let i of Object.keys(t.detail))(e[i]||s[i])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;let t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;let s=this._commonActions;for(let[i,n]of Object.entries(t)){let r=s[i];if(r){let a={detail:{[i]:n},target:e};r(a),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;let{quadPoints:e}=this.data;if(!e)return;let[t,s,i,n]=this.data.rect.map(g=>Math.fround(g));if(e.length===8){let[g,m,v,b]=e.subarray(2,6);if(i===g&&n===m&&t===v&&s===b)return}let{style:r}=this.container,a;if(this.#e){let{borderColor:g,borderWidth:m}=r;r.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${g}" stroke-width="${m}">`],this.container.classList.add("hasBorder")}let l=i-t,h=n-s,{svgFactory:c}=this,d=c.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0);let u=c.createElement("defs");d.append(u);let f=c.createElement("clipPath"),p=`clippath_${this.data.id}`;f.setAttribute("id",p),f.setAttribute("clipPathUnits","objectBoundingBox"),u.append(f);for(let g=2,m=e.length;g<m;g+=8){let v=e[g],b=e[g+1],A=e[g+2],w=e[g+3],y=c.createElement("rect"),x=(A-t)/l,E=(n-b)/h,C=(v-A)/l,S=(b-w)/h;y.setAttribute("x",x),y.setAttribute("y",E),y.setAttribute("width",C),y.setAttribute("height",S),f.append(y),a?.push(`<rect vector-effect="non-scaling-stroke" x="${x}" y="${E}" width="${C}" height="${S}"/>`)}this.#e&&(a.push("</g></svg>')"),r.backgroundImage=a.join("")),this.container.append(d),this.container.style.clipPath=`url(#${p})`}_createPopup(){let{data:e}=this,t=this.#s=new ye({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]});this.parent.div.append(t.render())}render(){Z("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){let s=[];if(this._fieldObjects){let i=this._fieldObjects[e];if(i)for(let{page:n,id:r,exportValues:a}of i){if(n===-1||r===t)continue;let l=typeof a=="string"?a:null,h=document.querySelector(`[data-element-id="${r}"]`);if(h&&!Xt.has(h)){B(`_getElementsByName - element not allowed: ${r}`);continue}s.push({id:r,exportValue:l,domElement:h})}return s}for(let i of document.getElementsByName(e)){let{exportValue:n}=i,r=i.getAttribute("data-element-id");r!==t&&Xt.has(i)&&s.push({id:r,exportValue:n,domElement:i})}return s}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(let t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}},ts=class extends ot{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){let{data:e,linkService:t}=this,s=document.createElement("a");s.setAttribute("data-element-id",e.id);let i=!1;return e.url?(t.addLinkAttributes(s,e.url,e.newWindow),i=!0):e.action?(this._bindNamedAction(s,e.action),i=!0):e.attachment?(this.#e(s,e.attachment,e.attachmentDest),i=!0):e.setOCGState?(this.#s(s,e.setOCGState),i=!0):e.dest?(this._bindLink(s,e.dest),i=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,e),i=!0),e.resetForm?(this._bindResetFormAction(s,e.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(s,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(s),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||t==="")&&this.#t()}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),this.#t()}#e(e,t,s=null){e.href=this.linkService.getAnchorUrl(""),t.description&&(e.title=t.description),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,s),!1),this.#t()}#s(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),this.#t()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");let s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let i of Object.keys(t.actions)){let n=s.get(i);n&&(e[n]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:i}}),!1))}e.onclick||(e.onclick=()=>!1),this.#t()}_bindResetFormAction(e,t){let s=e.onclick;if(s||(e.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){B('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(e.onclick=()=>!1);return}e.onclick=()=>{s?.();let{fields:i,refs:n,include:r}=t,a=[];if(i.length!==0||n.length!==0){let c=new Set(n);for(let d of i){let u=this._fieldObjects[d]||[];for(let{id:f}of u)c.add(f)}for(let d of Object.values(this._fieldObjects))for(let u of d)c.has(u.id)===r&&a.push(u)}else for(let c of Object.values(this._fieldObjects))a.push(...c);let l=this.annotationStorage,h=[];for(let c of a){let{id:d}=c;switch(h.push(d),c.type){case"text":{let f=c.defaultValue||"";l.setValue(d,{value:f});break}case"checkbox":case"radiobutton":{let f=c.defaultValue===c.exportValues;l.setValue(d,{value:f});break}case"combobox":case"listbox":{let f=c.defaultValue||"";l.setValue(d,{value:f});break}default:continue}let u=document.querySelector(`[data-element-id="${d}"]`);if(u){if(!Xt.has(u)){B(`_bindResetFormAction - element not allowed: ${d}`);continue}}else continue;u.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}}),!1}}},yi=class extends ot{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}},Dt=class extends ot{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return ut.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,s,i,n){s.includes("mouse")?e.addEventListener(s,r=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):e.addEventListener(s,r=>{if(s==="blur"){if(!t.focused||!r.relatedTarget)return;t.focused=!1}else if(s==="focus"){if(t.focused)return;t.focused=!0}n&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(r)}})})}_setEventListeners(e,t,s,i){for(let[n,r]of s)(r==="Action"||this.data.actions?.[r])&&((r==="Focus"||r==="Blur")&&(t||={focused:!1}),this._setEventListener(e,t,n,r,i),r==="Focus"&&!this.data.actions?.Blur?this._setEventListener(e,t,"blur","Blur",null):r==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){let t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":k.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){let t=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||vr,n=e.style,r,a=2,l=h=>Math.round(10*h)/10;if(this.data.multiLine){let h=Math.abs(this.data.rect[3]-this.data.rect[1]-a),c=Math.round(h/(Me*i))||1,d=h/c;r=Math.min(i,l(d/Me))}else{let h=Math.abs(this.data.rect[3]-this.data.rect[1]-a);r=Math.min(i,l(h/Me))}n.fontSize=`calc(${r}px * var(--scale-factor))`,n.color=k.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(n.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}},Ai=class extends Dt{constructor(e){let t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,s,i){let n=this.annotationStorage;for(let r of this._getElementsByName(e.name,e.id))r.domElement&&(r.domElement[t]=s),n.setValue(r.id,{[i]:s})}render(){let e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){let i=e.getValue(t,{value:this.data.fieldValue}),n=i.value||"",r=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;r&&n.length>r&&(n=n.slice(0,r));let a=i.formattedValue||this.data.textContent?.join(`
`)||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));let l={userValue:n,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=a??n,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type="text",s.setAttribute("value",a??n),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Xt.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=Ee,this._setRequired(s,this.data.required),r&&(s.maxLength=r),s.addEventListener("input",c=>{e.setValue(t,{value:c.target.value}),this.setPropertyOnSiblings(s,"value",c.target.value,"value"),l.formattedValue=null}),s.addEventListener("resetform",c=>{let d=this.data.defaultFieldValue??"";s.value=l.userValue=d,l.formattedValue=null});let h=c=>{let{formattedValue:d}=l;d!=null&&(c.target.value=d),c.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",d=>{if(l.focused)return;let{target:u}=d;l.userValue&&(u.value=l.userValue),l.lastCommittedValue=u.value,l.commitKey=1,this.data.actions?.Focus||(l.focused=!0)}),s.addEventListener("updatefromsandbox",d=>{this.showElementAndHideCanvas(d.target);let u={value(f){l.userValue=f.detail.value??"",e.setValue(t,{value:l.userValue.toString()}),f.target.value=l.userValue},formattedValue(f){let{formattedValue:p}=f.detail;l.formattedValue=p,p!=null&&f.target!==document.activeElement&&(f.target.value=p),e.setValue(t,{formattedValue:p})},selRange(f){f.target.setSelectionRange(...f.detail.selRange)},charLimit:f=>{let{charLimit:p}=f.detail,{target:g}=f;if(p===0){g.removeAttribute("maxLength");return}g.setAttribute("maxLength",p);let m=l.userValue;!m||m.length<=p||(m=m.slice(0,p),g.value=l.userValue=m,e.setValue(t,{value:m}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:m,willCommit:!0,commitKey:1,selStart:g.selectionStart,selEnd:g.selectionEnd}}))}};this._dispatchEventFromSandbox(u,d)}),s.addEventListener("keydown",d=>{l.commitKey=1;let u=-1;if(d.key==="Escape"?u=0:d.key==="Enter"&&!this.data.multiLine?u=2:d.key==="Tab"&&(l.commitKey=3),u===-1)return;let{value:f}=d.target;l.lastCommittedValue!==f&&(l.lastCommittedValue=f,l.userValue=f,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:f,willCommit:!0,commitKey:u,selStart:d.target.selectionStart,selEnd:d.target.selectionEnd}}))});let c=h;h=null,s.addEventListener("blur",d=>{if(!l.focused||!d.relatedTarget)return;this.data.actions?.Blur||(l.focused=!1);let{value:u}=d.target;l.userValue=u,l.lastCommittedValue!==u&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:u,willCommit:!0,commitKey:l.commitKey,selStart:d.target.selectionStart,selEnd:d.target.selectionEnd}}),c(d)}),this.data.actions?.Keystroke&&s.addEventListener("beforeinput",d=>{l.lastCommittedValue=null;let{data:u,target:f}=d,{value:p,selectionStart:g,selectionEnd:m}=f,v=g,b=m;switch(d.inputType){case"deleteWordBackward":{let A=p.substring(0,g).match(/\w*[^\w]*$/);A&&(v-=A[0].length);break}case"deleteWordForward":{let A=p.substring(g).match(/^[^\w]*\w*/);A&&(b+=A[0].length);break}case"deleteContentBackward":g===m&&(v-=1);break;case"deleteContentForward":g===m&&(b+=1);break}d.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:p,change:u||"",willCommit:!1,selStart:v,selEnd:b}})}),this._setEventListeners(s,l,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],d=>d.target.value)}if(h&&s.addEventListener("blur",h),this.data.comb){let d=(this.data.rect[2]-this.data.rect[0])/r;s.classList.add("comb"),s.style.letterSpacing=`calc(${d}px * var(--scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}},wi=class extends Dt{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}},xi=class extends Dt{constructor(e){super(e,{isRenderable:e.renderForms})}render(){let e=this.annotationStorage,t=this.data,s=t.id,i=e.getValue(s,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let n=document.createElement("input");return Xt.add(n),n.setAttribute("data-element-id",s),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=t.fieldName,i&&n.setAttribute("checked",!0),n.setAttribute("exportValue",t.exportValue),n.tabIndex=Ee,n.addEventListener("change",r=>{let{name:a,checked:l}=r.target;for(let h of this._getElementsByName(a,s)){let c=l&&h.exportValue===t.exportValue;h.domElement&&(h.domElement.checked=c),e.setValue(h.id,{value:c})}e.setValue(s,{value:l})}),n.addEventListener("resetform",r=>{let a=t.defaultFieldValue||"Off";r.target.checked=a===t.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",r=>{let a={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(s,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,r)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},es=class extends Dt{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let e=this.annotationStorage,t=this.data,s=t.id,i=e.getValue(s,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(s,{value:i})),i)for(let r of this._getElementsByName(t.fieldName,s))e.setValue(r.id,{value:!1});let n=document.createElement("input");if(Xt.add(n),n.setAttribute("data-element-id",s),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=t.fieldName,i&&n.setAttribute("checked",!0),n.tabIndex=Ee,n.addEventListener("change",r=>{let{name:a,checked:l}=r.target;for(let h of this._getElementsByName(a,s))e.setValue(h.id,{value:!1});e.setValue(s,{value:l})}),n.addEventListener("resetform",r=>{let a=t.defaultFieldValue;r.target.checked=a!=null&&a===t.buttonValue}),this.enableScripting&&this.hasJSActions){let r=t.buttonValue;n.addEventListener("updatefromsandbox",a=>{let l={value:h=>{let c=r===h.detail.value;for(let d of this._getElementsByName(h.target.name)){let u=c&&d.id===s;d.domElement&&(d.domElement.checked=u),e.setValue(d.id,{value:u})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},Ei=class extends ts{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){let e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");let t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),e}},Si=class extends Dt{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let e=this.annotationStorage,t=this.data.id,s=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");Xt.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=Ee;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",c=>{let d=this.data.defaultFieldValue;for(let u of i.options)u.selected=u.value===d});for(let c of this.data.options){let d=document.createElement("option");d.textContent=c.displayValue,d.value=c.exportValue,s.value.includes(c.exportValue)&&(d.setAttribute("selected",!0),n=!1),i.append(d)}let r=null;if(n){let c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),i.prepend(c),r=()=>{c.remove(),i.removeEventListener("input",r),r=null},i.addEventListener("input",r)}let a=c=>{let d=c?"value":"textContent",{options:u,multiple:f}=i;return f?Array.prototype.filter.call(u,p=>p.selected).map(p=>p[d]):u.selectedIndex===-1?null:u[u.selectedIndex][d]},l=a(!1),h=c=>{let d=c.target.options;return Array.prototype.map.call(d,u=>({displayValue:u.textContent,exportValue:u.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",c=>{let d={value(u){r?.();let f=u.detail.value,p=new Set(Array.isArray(f)?f:[f]);for(let g of i.options)g.selected=p.has(g.value);e.setValue(t,{value:a(!0)}),l=a(!1)},multipleSelection(u){i.multiple=!0},remove(u){let f=i.options,p=u.detail.remove;f[p].selected=!1,i.remove(p),f.length>0&&Array.prototype.findIndex.call(f,m=>m.selected)===-1&&(f[0].selected=!0),e.setValue(t,{value:a(!0),items:h(u)}),l=a(!1)},clear(u){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),l=a(!1)},insert(u){let{index:f,displayValue:p,exportValue:g}=u.detail.insert,m=i.children[f],v=document.createElement("option");v.textContent=p,v.value=g,m?m.before(v):i.append(v),e.setValue(t,{value:a(!0),items:h(u)}),l=a(!1)},items(u){let{items:f}=u.detail;for(;i.length!==0;)i.remove(0);for(let p of f){let{displayValue:g,exportValue:m}=p,v=document.createElement("option");v.textContent=g,v.value=m,i.append(v)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:a(!0),items:h(u)}),l=a(!1)},indices(u){let f=new Set(u.detail.indices);for(let p of u.target.options)p.selected=f.has(p.index);e.setValue(t,{value:a(!0)}),l=a(!1)},editable(u){u.target.disabled=!u.detail.editable}};this._dispatchEventFromSandbox(d,c)}),i.addEventListener("input",c=>{let d=a(!0),u=a(!1);e.setValue(t,{value:d}),c.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:u,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],c=>c.target.value)):i.addEventListener("input",function(c){e.setValue(t,{value:a(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}},ye=class extends ot{constructor(e){let{data:t,elements:s}=e;super(e,{isRenderable:ot._hasPopupData(t)}),this.elements=s,this.popup=null}render(){this.container.classList.add("popupAnnotation");let e=this.popup=new Ti({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(let s of this.elements)s.popup=e,s.container.ariaHasPopup="dialog",t.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(s=>`${Wi}${s}`).join(",")),this.container}},Ti=class{#t=this.#R.bind(this);#e=this.#C.bind(this);#s=this.#I.bind(this);#i=this.#x.bind(this);#r=null;#n=null;#l=null;#o=null;#c=null;#h=null;#u=null;#d=!1;#f=null;#a=null;#p=null;#m=null;#g=null;#v=null;#A=!1;constructor({container:e,color:t,elements:s,titleObj:i,modificationDate:n,contentsObj:r,richText:a,parent:l,rect:h,parentRect:c,open:d}){this.#n=e,this.#g=i,this.#l=r,this.#m=a,this.#h=l,this.#r=t,this.#p=h,this.#u=c,this.#c=s,this.#o=Fe.toDateObject(n),this.trigger=s.flatMap(u=>u.getElementsToTriggerPopup());for(let u of this.trigger)u.addEventListener("click",this.#i),u.addEventListener("mouseenter",this.#s),u.addEventListener("mouseleave",this.#e),u.classList.add("popupTriggerArea");for(let u of s)u.container?.addEventListener("keydown",this.#t);this.#n.hidden=!0,d&&this.#x()}render(){if(this.#f)return;let e=this.#f=document.createElement("div");if(e.className="popup",this.#r){let n=e.style.outlineColor=k.makeHexColor(...this.#r);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`:e.style.backgroundColor=k.makeHexColor(...this.#r.map(a=>Math.floor(.7*(255-a)+a)))}let t=document.createElement("span");t.className="header";let s=document.createElement("h1");if(t.append(s),{dir:s.dir,str:s.textContent}=this.#g,e.append(t),this.#o){let n=document.createElement("span");n.classList.add("popupDate"),n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#o.valueOf()})),t.append(n)}let i=this.#b;if(i)qe.render({xfaHtml:i,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{let n=this._formatContents(this.#l);e.append(n)}this.#n.append(e)}get#b(){let e=this.#m,t=this.#l;return e?.str&&(!t?.str||t.str===e.str)&&this.#m.html||null}get#w(){return this.#b?.attributes?.style?.fontSize||0}get#E(){return this.#b?.attributes?.style?.color||null}#T(e){let t=[],s={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:this.#E,fontSize:this.#w?`calc(${this.#w}px * var(--scale-factor))`:""}};for(let n of e.split(`
`))t.push({name:"span",value:n,attributes:i});return s}_formatContents({str:e,dir:t}){let s=document.createElement("p");s.classList.add("popupContent"),s.dir=t;let i=e.split(/(?:\r\n?|\n)/);for(let n=0,r=i.length;n<r;++n){let a=i[n];s.append(document.createTextNode(a)),n<r-1&&s.append(document.createElement("br"))}return s}#R(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&this.#d)&&this.#x()}updateEdited({rect:e,popupContent:t}){this.#v||={contentsObj:this.#l,richText:this.#m},e&&(this.#a=null),t&&(this.#m=this.#T(t),this.#l=null),this.#f?.remove(),this.#f=null}resetEdited(){this.#v&&({contentsObj:this.#l,richText:this.#m}=this.#v,this.#v=null,this.#f?.remove(),this.#f=null,this.#a=null)}#P(){if(this.#a!==null)return;let{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:s,pageX:i,pageY:n}}}=this.#h,r=!!this.#u,a=r?this.#u:this.#p;for(let p of this.#c)if(!a||k.intersect(p.data.rect,a)!==null){a=p.data.rect,r=!0;break}let l=k.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]),c=r?a[2]-a[0]+5:0,d=l[0]+c,u=l[1];this.#a=[100*(d-i)/t,100*(u-n)/s];let{style:f}=this.#n;f.left=`${this.#a[0]}%`,f.top=`${this.#a[1]}%`}#x(){this.#d=!this.#d,this.#d?(this.#I(),this.#n.addEventListener("click",this.#i),this.#n.addEventListener("keydown",this.#t)):(this.#C(),this.#n.removeEventListener("click",this.#i),this.#n.removeEventListener("keydown",this.#t))}#I(){this.#f||this.render(),this.isVisible?this.#d&&this.#n.classList.add("focused"):(this.#P(),this.#n.hidden=!1,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)+1e3)}#C(){this.#n.classList.remove("focused"),!(this.#d||!this.isVisible)&&(this.#n.hidden=!0,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)-1e3)}forceHide(){this.#A=this.isVisible,this.#A&&(this.#n.hidden=!0)}maybeShow(){this.#A&&(this.#f||this.#I(),this.#A=!1,this.#n.hidden=!1)}get isVisible(){return this.#n.hidden===!1}},ss=class extends ot{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=j.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(let t of this.textContent){let s=document.createElement("span");s.textContent=t,e.append(s)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},Ci=class extends ot{#t=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");let e=this.data,{width:t,height:s}=Nt(e.rect),i=this.svgFactory.create(t,s,!0),n=this.#t=this.svgFactory.createElement("svg:line");return n.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),n.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),n.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),n.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),n.setAttribute("stroke-width",e.borderStyle.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),i.append(n),this.container.append(i),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},Ri=class extends ot{#t=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");let e=this.data,{width:t,height:s}=Nt(e.rect),i=this.svgFactory.create(t,s,!0),n=e.borderStyle.width,r=this.#t=this.svgFactory.createElement("svg:rect");return r.setAttribute("x",n/2),r.setAttribute("y",n/2),r.setAttribute("width",t-n),r.setAttribute("height",s-n),r.setAttribute("stroke-width",n||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},Ii=class extends ot{#t=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");let e=this.data,{width:t,height:s}=Nt(e.rect),i=this.svgFactory.create(t,s,!0),n=e.borderStyle.width,r=this.#t=this.svgFactory.createElement("svg:ellipse");return r.setAttribute("cx",t/2),r.setAttribute("cy",s/2),r.setAttribute("rx",t/2-n/2),r.setAttribute("ry",s/2-n/2),r.setAttribute("stroke-width",n||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},is=class extends ot{#t=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let{data:{rect:e,vertices:t,borderStyle:s,popupRef:i}}=this;if(!t)return this.container;let{width:n,height:r}=Nt(e),a=this.svgFactory.create(n,r,!0),l=[];for(let c=0,d=t.length;c<d;c+=2){let u=t[c]-e[0],f=e[3]-t[c+1];l.push(`${u},${f}`)}l=l.join(" ");let h=this.#t=this.svgFactory.createElement(this.svgElementName);return h.setAttribute("points",l),h.setAttribute("stroke-width",s.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),a.append(h),this.container.append(a),!i&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},Pi=class extends is{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}},_i=class extends ot{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},Ae=class extends ot{#t=null;#e=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?j.HIGHLIGHT:j.INK}#s(e,t){switch(e){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}}render(){this.container.classList.add(this.containerClassName);let{data:{rect:e,rotation:t,inkLists:s,borderStyle:i,popupRef:n}}=this,{transform:r,width:a,height:l}=this.#s(t,e),h=this.svgFactory.create(a,l,!0),c=this.#t=this.svgFactory.createElement("svg:g");h.append(c),c.setAttribute("stroke-width",i.width||1),c.setAttribute("stroke-linecap","round"),c.setAttribute("stroke-linejoin","round"),c.setAttribute("stroke-miterlimit",10),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),c.setAttribute("transform",r);for(let d=0,u=s.length;d<u;d++){let f=this.svgFactory.createElement(this.svgElementName);this.#e.push(f),f.setAttribute("points",s[d].join(",")),c.append(f)}return!n&&this.hasPopupData&&this._createPopup(),this.container.append(h),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);let{thickness:t,points:s,rect:i}=e,n=this.#t;if(t>=0&&n.setAttribute("stroke-width",t||1),s)for(let r=0,a=this.#e.length;r<a;r++)this.#e[r].setAttribute("points",s[r].join(","));if(i){let{transform:r,width:a,height:l}=this.#s(this.data.rotation,i);n.parentElement.setAttribute("viewBox",`0 0 ${a} ${l}`),n.setAttribute("transform",r)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}},ns=class extends ot{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=j.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}},Mi=class extends ot{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}},Li=class extends ot{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}},Oi=class extends ot{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}},rs=class extends ot{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=j.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},Di=class extends ot{#t=null;constructor(e){super(e,{isRenderable:!0});let{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",Lt({source:this},t))}render(){this.container.classList.add("fileAttachmentAnnotation");let{container:e,data:t}=this,s;t.hasAppearance||t.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(t.fillAlpha*100)}%);`)),s.addEventListener("dblclick",this.#e.bind(this)),this.#t=s;let{isMac:i}=ut.platform;return e.addEventListener("keydown",n=>{n.key==="Enter"&&(i?n.metaKey:n.ctrlKey)&&this.#e()}),!t.popupRef&&this.hasPopupData?this._createPopup():s.classList.add("popupTriggerArea"),e.append(s),e}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}},ki=class{#t=null;#e=null;#s=new Map;#i=null;constructor({div:e,accessibilityManager:t,annotationCanvasMap:s,annotationEditorUIManager:i,page:n,viewport:r,structTreeLayer:a}){this.div=e,this.#t=t,this.#e=s,this.#i=a||null,this.page=n,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return this.#s.size>0}#r(e,t){return D(this,null,function*(){let s=e.firstChild||e,i=s.id=`${Wi}${t}`,n=yield this.#i?.getAriaAttributes(i);if(n)for(let[r,a]of n)s.setAttribute(r,a);this.div.append(e),this.#t?.moveElementInDOM(this.div,e,s,!1)})}render(e){return D(this,null,function*(){let{annotations:t}=e,s=this.div;Vt(s,this.viewport);let i=new Map,n={data:null,layer:s,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new be,annotationStorage:e.annotationStorage||new pe,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(let r of t){if(r.noHTML)continue;let a=r.annotationType===ct.POPUP;if(a){let c=i.get(r.id);if(!c)continue;n.elements=c}else{let{width:c,height:d}=Nt(r.rect);if(c<=0||d<=0)continue}n.data=r;let l=bi.create(n);if(!l.isRenderable)continue;if(!a&&r.popupRef){let c=i.get(r.popupRef);c?c.push(l):i.set(r.popupRef,[l])}let h=l.render();r.hidden&&(h.style.visibility="hidden"),yield this.#r(h,r.id),l._isEditable&&(this.#s.set(l.data.id,l),this._annotationEditorUIManager?.renderAnnotationElement(l))}this.#n()})}update({viewport:e}){let t=this.div;this.viewport=e,Vt(t,{rotation:e.rotation}),this.#n(),t.hidden=!1}#n(){if(!this.#e)return;let e=this.div;for(let[t,s]of this.#e){let i=e.querySelector(`[data-annotation-id="${t}"]`);if(!i)continue;s.className="annotationContent";let{firstChild:n}=i;n?n.nodeName==="CANVAS"?n.replaceWith(s):n.classList.contains("annotationContent")?n.after(s):n.before(s):i.append(s)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#s.values())}getEditableAnnotation(e){return this.#s.get(e)}},_e=/\r\n?|\n/g,Ni=class o extends it{#t;#e="";#s=`${this.id}-editor`;#i=null;#r;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){let e=o.prototype,t=n=>n.isEmpty(),s=fe.TRANSLATE_SMALL,i=fe.TRANSLATE_BIG;return z(this,"_keyboardManager",new Wt([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-i,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[i,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-i],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,i],checker:t}]]))}static _type="freetext";static _editorType=j.FREETEXT;constructor(e){super(Kt(Lt({},e),{name:"freeTextEditor"})),this.#t=e.color||o._defaultColor||it._defaultLineColor,this.#r=e.fontSize||o._defaultFontSize}static initialize(e,t){it.initialize(e,t);let s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case V.FREETEXT_SIZE:o._defaultFontSize=t;break;case V.FREETEXT_COLOR:o._defaultColor=t;break}}updateParams(e,t){switch(e){case V.FREETEXT_SIZE:this.#n(t);break;case V.FREETEXT_COLOR:this.#l(t);break}}static get defaultPropertiesToUpdate(){return[[V.FREETEXT_SIZE,o._defaultFontSize],[V.FREETEXT_COLOR,o._defaultColor||it._defaultLineColor]]}get propertiesToUpdate(){return[[V.FREETEXT_SIZE,this.#r],[V.FREETEXT_COLOR,this.#t]]}#n(e){let t=i=>{this.editorDiv.style.fontSize=`calc(${i}px * var(--scale-factor))`,this.translate(0,-(i-this.#r)*this.parentScale),this.#r=i,this.#c()},s=this.#r;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#l(e){let t=i=>{this.#t=this.editorDiv.style.color=i},s=this.#t;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){let e=this.parentScale;return[-o._internalPadding*e,-(o._internalPadding+this.#r)*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(j.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#i=new AbortController;let e=this._uiManager.combinedSignal(this.#i);this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#s),this._isDraggable=!0,this.#i?.abort(),this.#i=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#o(){let e=[];this.editorDiv.normalize();let t=null;for(let s of this.editorDiv.childNodes)t?.nodeType===Node.TEXT_NODE&&s.nodeName==="BR"||(e.push(o.#h(s)),t=s);return e.join(`
`)}#c(){let[e,t]=this.parentDimensions,s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{let{currentLayer:i,div:n}=this,r=n.style.display,a=n.classList.contains("hidden");n.classList.remove("hidden"),n.style.display="hidden",i.div.append(this.div),s=n.getBoundingClientRect(),n.remove(),n.style.display=r,n.classList.toggle("hidden",a)}this.rotation%180===this.parentRotation%180?(this.width=s.width/e,this.height=s.height/t):(this.width=s.height/e,this.height=s.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let e=this.#e,t=this.#e=this.#o().trimEnd();if(e===t)return;let s=i=>{if(this.#e=i,!i){this.remove();return}this.#u(),this._uiManager.rebuild(this),this.#c()};this.addCommands({cmd:()=>{s(t)},undo:()=>{s(e)},mustExec:!1}),this.#c()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){this.enterInEditMode()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){o._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#s),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:s}=this.editorDiv;if(s.fontSize=`calc(${this.#r}px * var(--scale-factor))`,s.color=this.#t,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Be(this,this.div,["dblclick","keydown"]),this.width){let[i,n]=this.parentDimensions;if(this.annotationElementId){let{position:r}=this._initialData,[a,l]=this.getInitialTranslation();[a,l]=this.pageTranslationToScreen(a,l);let[h,c]=this.pageDimensions,[d,u]=this.pageTranslation,f,p;switch(this.rotation){case 0:f=e+(r[0]-d)/h,p=t+this.height-(r[1]-u)/c;break;case 90:f=e+(r[0]-d)/h,p=t-(r[1]-u)/c,[a,l]=[l,-a];break;case 180:f=e-this.width+(r[0]-d)/h,p=t-(r[1]-u)/c,[a,l]=[-a,-l];break;case 270:f=e+(r[0]-d-this.height*c)/h,p=t+(r[1]-u-this.width*h)/c,[a,l]=[-l,a];break}this.setAt(f*i,p*n,a,l)}else this.setAt(e*i,t*n,this.width*i,this.height*n);this.#u(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#h(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(_e,"")}editorDivPaste(e){let t=e.clipboardData||window.clipboardData,{types:s}=t;if(s.length===1&&s[0]==="text/plain")return;e.preventDefault();let i=o.#f(t.getData("text")||"").replaceAll(_e,`
`);if(!i)return;let n=window.getSelection();if(!n.rangeCount)return;this.editorDiv.normalize(),n.deleteFromDocument();let r=n.getRangeAt(0);if(!i.includes(`
`)){r.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),n.collapseToStart();return}let{startContainer:a,startOffset:l}=r,h=[],c=[];if(a.nodeType===Node.TEXT_NODE){let f=a.parentElement;if(c.push(a.nodeValue.slice(l).replaceAll(_e,"")),f!==this.editorDiv){let p=h;for(let g of this.editorDiv.childNodes){if(g===f){p=c;continue}p.push(o.#h(g))}}h.push(a.nodeValue.slice(0,l).replaceAll(_e,""))}else if(a===this.editorDiv){let f=h,p=0;for(let g of this.editorDiv.childNodes)p++===l&&(f=c),f.push(o.#h(g))}this.#e=`${h.join(`
`)}${i}${c.join(`
`)}`,this.#u();let d=new Range,u=h.reduce((f,p)=>f+p.length,0);for(let{firstChild:f}of this.editorDiv.childNodes)if(f.nodeType===Node.TEXT_NODE){let p=f.nodeValue.length;if(u<=p){d.setStart(f,u),d.setEnd(f,u);break}u-=p}n.removeAllRanges(),n.addRange(d)}#u(){if(this.editorDiv.replaceChildren(),!!this.#e)for(let e of this.#e.split(`
`)){let t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#d(){return this.#e.replaceAll("\xA0"," ")}static#f(e){return e.replaceAll(" ","\xA0")}get contentDiv(){return this.editorDiv}static deserialize(e,t,s){return D(this,null,function*(){let i=null;if(e instanceof ss){let{data:{defaultAppearanceData:{fontSize:r,fontColor:a},rect:l,rotation:h,id:c,popupRef:d},textContent:u,textPosition:f,parent:{page:{pageNumber:p}}}=e;if(!u||u.length===0)return null;i=e={annotationType:j.FREETEXT,color:Array.from(a),fontSize:r,value:u.join(`
`),position:f,pageIndex:p-1,rect:l.slice(0),rotation:h,id:c,deleted:!1,popupRef:d}}let n=yield Ht(o,this,"deserialize").call(this,e,t,s);return n.#r=e.fontSize,n.#t=k.makeHexColor(...e.color),n.#e=o.#f(e.value),n.annotationElementId=e.id||null,n._initialData=i,n})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let t=o._internalPadding*this.parentScale,s=this.getRect(t,t),i=it._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#t),n={annotationType:j.FREETEXT,color:i,fontSize:this.#r,value:this.#d(),pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?n:this.annotationElementId&&!this.#a(n)?null:(n.id=this.annotationElementId,n)}#a(e){let{value:t,fontSize:s,color:i,pageIndex:n}=this._initialData;return this._hasBeenMoved||e.value!==t||e.fontSize!==s||e.color.some((r,a)=>r!==i[a])||e.pageIndex!==n}renderAnnotationElement(e){let t=super.renderAnnotationElement(e);if(this.deleted)return t;let{style:s}=t;s.fontSize=`calc(${this.#r}px * var(--scale-factor))`,s.color=this.#t,t.replaceChildren();for(let n of this.#e.split(`
`)){let r=document.createElement("div");r.append(n?document.createTextNode(n):document.createElement("br")),t.append(r)}let i=o._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(i,i),popupContent:this.#e}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}},O=(()=>{class o{static PRECISION=1e-4;toSVGPath(){Z("Abstract method `toSVGPath` must be implemented.")}get box(){Z("Abstract getter `box` must be implemented.")}serialize(t,s){Z("Abstract method `serialize` must be implemented.")}static _rescale(t,s,i,n,r,a){a||=new Float32Array(t.length);for(let l=0,h=t.length;l<h;l+=2)a[l]=s+t[l]*n,a[l+1]=i+t[l+1]*r;return a}static _rescaleAndSwap(t,s,i,n,r,a){a||=new Float32Array(t.length);for(let l=0,h=t.length;l<h;l+=2)a[l]=s+t[l+1]*n,a[l+1]=i+t[l]*r;return a}static _translate(t,s,i,n){n||=new Float32Array(t.length);for(let r=0,a=t.length;r<a;r+=2)n[r]=s+t[r],n[r+1]=i+t[r+1];return n}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,s,i,n,r){switch(r){case 90:return[1-s/i,t/n];case 180:return[1-t/i,1-s/n];case 270:return[s/i,1-t/n];default:return[t/i,s/n]}}static _normalizePagePoint(t,s,i){switch(i){case 90:return[1-s,t];case 180:return[1-t,1-s];case 270:return[s,1-t];default:return[t,s]}}static createBezierPoints(t,s,i,n,r,a){return[(t+5*i)/6,(s+5*n)/6,(5*i+r)/6,(5*n+a)/6,(i+r)/2,(n+a)/2]}}return o})(),as=class o{#t;#e=[];#s;#i;#r=[];#n=new Float32Array(18);#l;#o;#c;#h;#u;#d;#f=[];static#a=8;static#p=2;static#m=o.#a+o.#p;constructor({x:e,y:t},s,i,n,r,a=0){this.#t=s,this.#d=n*i,this.#i=r,this.#n.set([NaN,NaN,NaN,NaN,e,t],6),this.#s=a,this.#h=o.#a*i,this.#c=o.#m*i,this.#u=i,this.#f.push(e,t)}isEmpty(){return isNaN(this.#n[8])}#g(){let e=this.#n.subarray(4,6),t=this.#n.subarray(16,18),[s,i,n,r]=this.#t;return[(this.#l+(e[0]-t[0])/2-s)/n,(this.#o+(e[1]-t[1])/2-i)/r,(this.#l+(t[0]-e[0])/2-s)/n,(this.#o+(t[1]-e[1])/2-i)/r]}add({x:e,y:t}){this.#l=e,this.#o=t;let[s,i,n,r]=this.#t,[a,l,h,c]=this.#n.subarray(8,12),d=e-h,u=t-c,f=Math.hypot(d,u);if(f<this.#c)return!1;let p=f-this.#h,g=p/f,m=g*d,v=g*u,b=a,A=l;a=h,l=c,h+=m,c+=v,this.#f?.push(e,t);let w=-v/p,y=m/p,x=w*this.#d,E=y*this.#d;return this.#n.set(this.#n.subarray(2,8),0),this.#n.set([h+x,c+E],4),this.#n.set(this.#n.subarray(14,18),12),this.#n.set([h-x,c-E],16),isNaN(this.#n[6])?(this.#r.length===0&&(this.#n.set([a+x,l+E],2),this.#r.push(NaN,NaN,NaN,NaN,(a+x-s)/n,(l+E-i)/r),this.#n.set([a-x,l-E],14),this.#e.push(NaN,NaN,NaN,NaN,(a-x-s)/n,(l-E-i)/r)),this.#n.set([b,A,a,l,h,c],6),!this.isEmpty()):(this.#n.set([b,A,a,l,h,c],6),Math.abs(Math.atan2(A-l,b-a)-Math.atan2(v,m))<Math.PI/2?([a,l,h,c]=this.#n.subarray(2,6),this.#r.push(NaN,NaN,NaN,NaN,((a+h)/2-s)/n,((l+c)/2-i)/r),[a,l,b,A]=this.#n.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((b+a)/2-s)/n,((A+l)/2-i)/r),!0):([b,A,a,l,h,c]=this.#n.subarray(0,6),this.#r.push(((b+5*a)/6-s)/n,((A+5*l)/6-i)/r,((5*a+h)/6-s)/n,((5*l+c)/6-i)/r,((a+h)/2-s)/n,((l+c)/2-i)/r),[h,c,a,l,b,A]=this.#n.subarray(12,18),this.#e.push(((b+5*a)/6-s)/n,((A+5*l)/6-i)/r,((5*a+h)/6-s)/n,((5*l+c)/6-i)/r,((a+h)/2-s)/n,((l+c)/2-i)/r),!0))}toSVGPath(){if(this.isEmpty())return"";let e=this.#r,t=this.#e;if(isNaN(this.#n[6])&&!this.isEmpty())return this.#v();let s=[];s.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);this.#b(s);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return this.#A(s),s.join(" ")}#v(){let[e,t,s,i]=this.#t,[n,r,a,l]=this.#g();return`M${(this.#n[2]-e)/s} ${(this.#n[3]-t)/i} L${(this.#n[4]-e)/s} ${(this.#n[5]-t)/i} L${n} ${r} L${a} ${l} L${(this.#n[16]-e)/s} ${(this.#n[17]-t)/i} L${(this.#n[14]-e)/s} ${(this.#n[15]-t)/i} Z`}#A(e){let t=this.#e;e.push(`L${t[4]} ${t[5]} Z`)}#b(e){let[t,s,i,n]=this.#t,r=this.#n.subarray(4,6),a=this.#n.subarray(16,18),[l,h,c,d]=this.#g();e.push(`L${(r[0]-t)/i} ${(r[1]-s)/n} L${l} ${h} L${c} ${d} L${(a[0]-t)/i} ${(a[1]-s)/n}`)}newFreeDrawOutline(e,t,s,i,n,r){return new os(e,t,s,i,n,r)}getOutlines(){let e=this.#r,t=this.#e,s=this.#n,[i,n,r,a]=this.#t,l=new Float32Array((this.#f?.length??0)+2);for(let d=0,u=l.length-2;d<u;d+=2)l[d]=(this.#f[d]-i)/r,l[d+1]=(this.#f[d+1]-n)/a;if(l[l.length-2]=(this.#l-i)/r,l[l.length-1]=(this.#o-n)/a,isNaN(s[6])&&!this.isEmpty())return this.#w(l);let h=new Float32Array(this.#r.length+24+this.#e.length),c=e.length;for(let d=0;d<c;d+=2){if(isNaN(e[d])){h[d]=h[d+1]=NaN;continue}h[d]=e[d],h[d+1]=e[d+1]}c=this.#T(h,c);for(let d=t.length-6;d>=6;d-=6)for(let u=0;u<6;u+=2){if(isNaN(t[d+u])){h[c]=h[c+1]=NaN,c+=2;continue}h[c]=t[d+u],h[c+1]=t[d+u+1],c+=2}return this.#E(h,c),this.newFreeDrawOutline(h,l,this.#t,this.#u,this.#s,this.#i)}#w(e){let t=this.#n,[s,i,n,r]=this.#t,[a,l,h,c]=this.#g(),d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(t[2]-s)/n,(t[3]-i)/r,NaN,NaN,NaN,NaN,(t[4]-s)/n,(t[5]-i)/r,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,h,c,NaN,NaN,NaN,NaN,(t[16]-s)/n,(t[17]-i)/r,NaN,NaN,NaN,NaN,(t[14]-s)/n,(t[15]-i)/r],0),this.newFreeDrawOutline(d,e,this.#t,this.#u,this.#s,this.#i)}#E(e,t){let s=this.#e;return e.set([NaN,NaN,NaN,NaN,s[4],s[5]],t),t+=6}#T(e,t){let s=this.#n.subarray(4,6),i=this.#n.subarray(16,18),[n,r,a,l]=this.#t,[h,c,d,u]=this.#g();return e.set([NaN,NaN,NaN,NaN,(s[0]-n)/a,(s[1]-r)/l,NaN,NaN,NaN,NaN,h,c,NaN,NaN,NaN,NaN,d,u,NaN,NaN,NaN,NaN,(i[0]-n)/a,(i[1]-r)/l],t),t+=24}},os=class extends O{#t;#e=new Float32Array(4);#s;#i;#r;#n;#l;constructor(e,t,s,i,n,r){super(),this.#l=e,this.#r=t,this.#t=s,this.#n=i,this.#s=n,this.#i=r,this.lastPoint=[NaN,NaN],this.#o(r);let[a,l,h,c]=this.#e;for(let d=0,u=e.length;d<u;d+=2)e[d]=(e[d]-a)/h,e[d+1]=(e[d+1]-l)/c;for(let d=0,u=t.length;d<u;d+=2)t[d]=(t[d]-a)/h,t[d+1]=(t[d+1]-l)/c}toSVGPath(){let e=[`M${this.#l[4]} ${this.#l[5]}`];for(let t=6,s=this.#l.length;t<s;t+=6){if(isNaN(this.#l[t])){e.push(`L${this.#l[t+4]} ${this.#l[t+5]}`);continue}e.push(`C${this.#l[t]} ${this.#l[t+1]} ${this.#l[t+2]} ${this.#l[t+3]} ${this.#l[t+4]} ${this.#l[t+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,t,s,i],n){let r=s-e,a=i-t,l,h;switch(n){case 0:l=O._rescale(this.#l,e,i,r,-a),h=O._rescale(this.#r,e,i,r,-a);break;case 90:l=O._rescaleAndSwap(this.#l,e,t,r,a),h=O._rescaleAndSwap(this.#r,e,t,r,a);break;case 180:l=O._rescale(this.#l,s,t,-r,a),h=O._rescale(this.#r,s,t,-r,a);break;case 270:l=O._rescaleAndSwap(this.#l,s,i,-r,-a),h=O._rescaleAndSwap(this.#r,s,i,-r,-a);break}return{outline:Array.from(l),points:[Array.from(h)]}}#o(e){let t=this.#l,s=t[4],i=t[5],n=s,r=i,a=s,l=i,h=s,c=i,d=e?Math.max:Math.min;for(let f=6,p=t.length;f<p;f+=6){if(isNaN(t[f]))n=Math.min(n,t[f+4]),r=Math.min(r,t[f+5]),a=Math.max(a,t[f+4]),l=Math.max(l,t[f+5]),c<t[f+5]?(h=t[f+4],c=t[f+5]):c===t[f+5]&&(h=d(h,t[f+4]));else{let g=k.bezierBoundingBox(s,i,...t.slice(f,f+6));n=Math.min(n,g[0]),r=Math.min(r,g[1]),a=Math.max(a,g[2]),l=Math.max(l,g[3]),c<g[3]?(h=g[2],c=g[3]):c===g[3]&&(h=d(h,g[2]))}s=t[f+4],i=t[f+5]}let u=this.#e;u[0]=n-this.#s,u[1]=r-this.#s,u[2]=a-n+2*this.#s,u[3]=l-r+2*this.#s,this.lastPoint=[h,c]}get box(){return this.#e}newOutliner(e,t,s,i,n,r=0){return new as(e,t,s,i,n,r)}getNewOutline(e,t){let[s,i,n,r]=this.#e,[a,l,h,c]=this.#t,d=n*h,u=r*c,f=s*h+a,p=i*c+l,g=this.newOutliner({x:this.#r[0]*d+f,y:this.#r[1]*u+p},this.#t,this.#n,e,this.#i,t??this.#s);for(let m=2;m<this.#r.length;m+=2)g.add({x:this.#r[m]*d+f,y:this.#r[m+1]*u+p});return g.getOutlines()}},we=class{#t;#e;#s=[];#i=[];constructor(e,t=0,s=0,i=!0){let n=1/0,r=-1/0,a=1/0,l=-1/0,c=10**-4;for(let{x:v,y:b,width:A,height:w}of e){let y=Math.floor((v-t)/c)*c,x=Math.ceil((v+A+t)/c)*c,E=Math.floor((b-t)/c)*c,C=Math.ceil((b+w+t)/c)*c,S=[y,E,C,!0],M=[x,E,C,!1];this.#s.push(S,M),n=Math.min(n,y),r=Math.max(r,x),a=Math.min(a,E),l=Math.max(l,C)}let d=r-n+2*s,u=l-a+2*s,f=n-s,p=a-s,g=this.#s.at(i?-1:-2),m=[g[0],g[2]];for(let v of this.#s){let[b,A,w]=v;v[0]=(b-f)/d,v[1]=(A-p)/u,v[2]=(w-p)/u}this.#t=new Float32Array([f,p,d,u]),this.#e=m}getOutlines(){this.#s.sort((t,s)=>t[0]-s[0]||t[1]-s[1]||t[2]-s[2]);let e=[];for(let t of this.#s)t[3]?(e.push(...this.#c(t)),this.#l(t)):(this.#o(t),e.push(...this.#c(t)));return this.#r(e)}#r(e){let t=[],s=new Set;for(let r of e){let[a,l,h]=r;t.push([a,l,r],[a,h,r])}t.sort((r,a)=>r[1]-a[1]||r[0]-a[0]);for(let r=0,a=t.length;r<a;r+=2){let l=t[r][2],h=t[r+1][2];l.push(h),h.push(l),s.add(l),s.add(h)}let i=[],n;for(;s.size>0;){let r=s.values().next().value,[a,l,h,c,d]=r;s.delete(r);let u=a,f=l;for(n=[a,h],i.push(n);;){let p;if(s.has(c))p=c;else if(s.has(d))p=d;else break;s.delete(p),[a,l,h,c,d]=p,u!==a&&(n.push(u,f,a,f===l?l:h),u=a),f=f===l?h:l}n.push(u,f)}return new Fi(i,this.#t,this.#e)}#n(e){let t=this.#i,s=0,i=t.length-1;for(;s<=i;){let n=s+i>>1,r=t[n][0];if(r===e)return n;r<e?s=n+1:i=n-1}return i+1}#l([,e,t]){let s=this.#n(e);this.#i.splice(s,0,[e,t])}#o([,e,t]){let s=this.#n(e);for(let i=s;i<this.#i.length;i++){let[n,r]=this.#i[i];if(n!==e)break;if(n===e&&r===t){this.#i.splice(i,1);return}}for(let i=s-1;i>=0;i--){let[n,r]=this.#i[i];if(n!==e)break;if(n===e&&r===t){this.#i.splice(i,1);return}}}#c(e){let[t,s,i]=e,n=[[t,s,i]],r=this.#n(i);for(let a=0;a<r;a++){let[l,h]=this.#i[a];for(let c=0,d=n.length;c<d;c++){let[,u,f]=n[c];if(!(h<=u||f<=l)){if(u>=l){if(f>h)n[c][1]=h;else{if(d===1)return[];n.splice(c,1),c--,d--}continue}n[c][2]=l,f>h&&n.push([t,h,f])}}}return n}},Fi=class extends O{#t;#e;constructor(e,t,s){super(),this.#e=e,this.#t=t,this.lastPoint=s}toSVGPath(){let e=[];for(let t of this.#e){let[s,i]=t;e.push(`M${s} ${i}`);for(let n=2;n<t.length;n+=2){let r=t[n],a=t[n+1];r===s?(e.push(`V${a}`),i=a):a===i&&(e.push(`H${r}`),s=r)}e.push("Z")}return e.join(" ")}serialize([e,t,s,i],n){let r=[],a=s-e,l=i-t;for(let h of this.#e){let c=new Array(h.length);for(let d=0;d<h.length;d+=2)c[d]=e+h[d]*a,c[d+1]=i-h[d+1]*l;r.push(c)}return r}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}},xe=class extends as{newFreeDrawOutline(e,t,s,i,n,r){return new Bi(e,t,s,i,n,r)}},Bi=class extends os{newOutliner(e,t,s,i,n,r=0){return new xe(e,t,s,i,n,r)}},ls=class o{#t=null;#e=null;#s;#i=null;#r=!1;#n=!1;#l=null;#o;#c=null;#h=null;#u;static#d=null;static get _keyboardManager(){return z(this,"_keyboardManager",new Wt([[["Escape","mac+Escape"],o.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],o.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],o.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],o.prototype._moveToPrevious],[["Home","mac+Home"],o.prototype._moveToBeginning],[["End","mac+End"],o.prototype._moveToEnd]]))}constructor({editor:e=null,uiManager:t=null}){e?(this.#n=!1,this.#u=V.HIGHLIGHT_COLOR,this.#l=e):(this.#n=!0,this.#u=V.HIGHLIGHT_DEFAULT_COLOR),this.#h=e?._uiManager||t,this.#o=this.#h._eventBus,this.#s=e?.color||this.#h?.highlightColors.values().next().value||"#FFFF98",o.#d||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){let e=this.#t=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);let t=this.#h._signal;e.addEventListener("click",this.#m.bind(this),{signal:t}),e.addEventListener("keydown",this.#p.bind(this),{signal:t});let s=this.#e=document.createElement("span");return s.className="swatch",s.setAttribute("aria-hidden",!0),s.style.backgroundColor=this.#s,e.append(s),e}renderMainDropdown(){let e=this.#i=this.#f();return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}#f(){let e=document.createElement("div"),t=this.#h._signal;e.addEventListener("contextmenu",St,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(let[s,i]of this.#h.highlightColors){let n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",i),n.title=s,n.setAttribute("data-l10n-id",o.#d[s]);let r=document.createElement("span");n.append(r),r.className="swatch",r.style.backgroundColor=i,n.setAttribute("aria-selected",i===this.#s),n.addEventListener("click",this.#a.bind(this,i),{signal:t}),e.append(n)}return e.addEventListener("keydown",this.#p.bind(this),{signal:t}),e}#a(e,t){t.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:this.#u,value:e})}_colorSelectFromKeyboard(e){if(e.target===this.#t){this.#m(e);return}let t=e.target.getAttribute("data-color");t&&this.#a(t,e)}_moveToNext(e){if(!this.#v){this.#m(e);return}if(e.target===this.#t){this.#i.firstChild?.focus();return}e.target.nextSibling?.focus()}_moveToPrevious(e){if(e.target===this.#i?.firstChild||e.target===this.#t){this.#v&&this._hideDropdownFromKeyboard();return}this.#v||this.#m(e),e.target.previousSibling?.focus()}_moveToBeginning(e){if(!this.#v){this.#m(e);return}this.#i.firstChild?.focus()}_moveToEnd(e){if(!this.#v){this.#m(e);return}this.#i.lastChild?.focus()}#p(e){o._keyboardManager.exec(this,e)}#m(e){if(this.#v){this.hideDropdown();return}if(this.#r=e.detail===0,this.#c||(this.#c=new AbortController,window.addEventListener("pointerdown",this.#g.bind(this),{signal:this.#h.combinedSignal(this.#c)})),this.#i){this.#i.classList.remove("hidden");return}let t=this.#i=this.#f();this.#t.append(t)}#g(e){this.#i?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#i?.classList.add("hidden"),this.#c?.abort(),this.#c=null}get#v(){return this.#i&&!this.#i.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#n){if(!this.#v){this.#l?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#r})}}updateColor(e){if(this.#e&&(this.#e.style.backgroundColor=e),!this.#i)return;let t=this.#h.highlightColors.values();for(let s of this.#i.children)s.setAttribute("aria-selected",t.next().value===e)}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#i?.remove(),this.#i=null}},hs=class o extends it{#t=null;#e=0;#s;#i=null;#r=null;#n=null;#l=null;#o=0;#c=null;#h=null;#u=null;#d=!1;#f=null;#a;#p=null;#m="";#g;#v="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=j.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){let e=o.prototype;return z(this,"_keyboardManager",new Wt([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super(Kt(Lt({},e),{name:"highlightEditor"})),this.color=e.color||o._defaultColor,this.#g=e.thickness||o._defaultThickness,this.#a=e.opacity||o._defaultOpacity,this.#s=e.boxes||null,this.#v=e.methodOfCreation||"",this.#m=e.text||"",this._isDraggable=!1,e.highlightId>-1?(this.#d=!0,this.#b(e),this.#P()):this.#s&&(this.#t=e.anchorNode,this.#e=e.anchorOffset,this.#l=e.focusNode,this.#o=e.focusOffset,this.#A(),this.#P(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#d?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#g,methodOfCreation:this.#v}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#A(){let e=new we(this.#s,.001);this.#h=e.getOutlines(),[this.x,this.y,this.width,this.height]=this.#h.box;let t=new we(this.#s,.0025,.001,this._uiManager.direction==="ltr");this.#n=t.getOutlines();let{lastPoint:s}=this.#n;this.#f=[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height]}#b({highlightOutlines:e,highlightId:t,clipPathId:s}){this.#h=e;let i=1.5;if(this.#n=e.getNewOutline(this.#g/2+i,.0025),t>=0)this.#u=t,this.#i=s,this.parent.drawLayer.finalizeDraw(t,{bbox:e.box,path:{d:e.toSVGPath()}}),this.#p=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#n.box,path:{d:this.#n.toSVGPath()}},!0);else if(this.parent){let c=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#u,{bbox:o.#x(this.#h.box,(c-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#p,{bbox:o.#x(this.#n.box,c),path:{d:this.#n.toSVGPath()}})}let[n,r,a,l]=e.box;switch(this.rotation){case 0:this.x=n,this.y=r,this.width=a,this.height=l;break;case 90:{let[c,d]=this.parentDimensions;this.x=r,this.y=1-n,this.width=a*d/c,this.height=l*c/d;break}case 180:this.x=1-n,this.y=1-r,this.width=a,this.height=l;break;case 270:{let[c,d]=this.parentDimensions;this.x=1-r,this.y=n,this.width=a*d/c,this.height=l*c/d;break}}let{lastPoint:h}=this.#n;this.#f=[(h[0]-n)/a,(h[1]-r)/l]}static initialize(e,t){it.initialize(e,t),o._defaultColor||=t.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,t){switch(e){case V.HIGHLIGHT_DEFAULT_COLOR:o._defaultColor=t;break;case V.HIGHLIGHT_THICKNESS:o._defaultThickness=t;break}}translateInPage(e,t){}get toolbarPosition(){return this.#f}updateParams(e,t){switch(e){case V.HIGHLIGHT_COLOR:this.#w(t);break;case V.HIGHLIGHT_THICKNESS:this.#E(t);break}}static get defaultPropertiesToUpdate(){return[[V.HIGHLIGHT_DEFAULT_COLOR,o._defaultColor],[V.HIGHLIGHT_THICKNESS,o._defaultThickness]]}get propertiesToUpdate(){return[[V.HIGHLIGHT_COLOR,this.color||o._defaultColor],[V.HIGHLIGHT_THICKNESS,this.#g||o._defaultThickness],[V.HIGHLIGHT_FREE,this.#d]]}#w(e){let t=(n,r)=>{this.color=n,this.#a=r,this.parent?.drawLayer.updateProperties(this.#u,{root:{fill:n,"fill-opacity":r}}),this.#r?.updateColor(n)},s=this.color,i=this.#a;this.addCommands({cmd:t.bind(this,e,o._defaultOpacity),undo:t.bind(this,s,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)}#E(e){let t=this.#g,s=i=>{this.#g=i,this.#T(i)};this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}addEditToolbar(){return D(this,null,function*(){let e=yield Ht(o.prototype,this,"addEditToolbar").call(this);return e?(this._uiManager.highlightColors&&(this.#r=new ls({editor:this}),e.addColorPicker(this.#r)),e):null})}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#M())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#M())}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){this.#R(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#P(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#R():e&&(this.#P(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),t&&this.select()}#T(e){if(!this.#d)return;this.#b({highlightOutlines:this.#h.getNewOutline(e/2)}),this.fixAndSetPosition();let[t,s]=this.parentDimensions;this.setDims(this.width*t,this.height*s)}#R(){this.#u===null||!this.parent||(this.parent.drawLayer.remove(this.#u),this.#u=null,this.parent.drawLayer.remove(this.#p),this.#p=null)}#P(e=this.parent){this.#u===null&&({id:this.#u,clipPathId:this.#i}=e.drawLayer.draw({bbox:this.#h.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#a},rootClass:{highlight:!0,free:this.#d},path:{d:this.#h.toSVGPath()}},!1,!0),this.#p=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#d},bbox:this.#n.box,path:{d:this.#n.toSVGPath()}},this.#d),this.#c&&(this.#c.style.clipPath=this.#i))}static#x([e,t,s,i],n){switch(n){case 90:return[1-t-i,e,i,s];case 180:return[1-e-s,1-t-i,s,i];case 270:return[t,1-e-s,i,s]}return[e,t,s,i]}rotate(e){let{drawLayer:t}=this.parent,s;this.#d?(e=(e-this.rotation+360)%360,s=o.#x(this.#h.box,e)):s=o.#x([this.x,this.y,this.width,this.height],e),t.updateProperties(this.#u,{bbox:s,root:{"data-main-rotation":e}}),t.updateProperties(this.#p,{bbox:o.#x(this.#n.box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;let e=super.render();this.#m&&(e.setAttribute("aria-label",this.#m),e.setAttribute("role","mark")),this.#d?e.classList.add("free"):this.div.addEventListener("keydown",this.#I.bind(this),{signal:this._uiManager._signal});let t=this.#c=document.createElement("div");e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=this.#i;let[s,i]=this.parentDimensions;return this.setDims(this.width*s,this.height*i),Be(this,this.#c,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1}})}#I(e){o._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#C(!0);break;case 1:case 3:this.#C(!1);break}}#C(e){if(!this.#t)return;let t=window.getSelection();e?t.setPosition(this.#t,this.#e):t.setPosition(this.#l,this.#o)}select(){super.select(),this.#p&&this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#p&&(this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{selected:!1}}),this.#d||this.#C(!1))}get _mustFixPosition(){return!this.#d}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#u,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#p,{rootClass:{hidden:!e}}))}#M(){return this.#d?this.rotation:0}#D(){if(this.#d)return null;let[e,t]=this.pageDimensions,[s,i]=this.pageTranslation,n=this.#s,r=new Float32Array(n.length*8),a=0;for(let{x:l,y:h,width:c,height:d}of n){let u=l*e+s,f=(1-h)*t+i;r[a]=r[a+4]=u,r[a+1]=r[a+3]=f,r[a+2]=r[a+6]=u+c*e,r[a+5]=r[a+7]=f-d*t,a+=8}return r}#N(e){return this.#h.serialize(e,this.#M())}static startHighlighting(e,t,{target:s,x:i,y:n}){let{x:r,y:a,width:l,height:h}=s.getBoundingClientRect(),c=new AbortController,d=e.combinedSignal(c),u=f=>{c.abort(),this.#y(e,f)};window.addEventListener("blur",u,{signal:d}),window.addEventListener("pointerup",u,{signal:d}),window.addEventListener("pointerdown",wt,{capture:!0,passive:!1,signal:d}),window.addEventListener("contextmenu",St,{signal:d}),s.addEventListener("pointermove",this.#S.bind(this,e),{signal:d}),this._freeHighlight=new xe({x:i,y:n},[r,a,l,h],e.scale,this._defaultThickness/2,t,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#S(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#y(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static deserialize(e,t,s){return D(this,null,function*(){let i=null;if(e instanceof ns){let{data:{quadPoints:p,rect:g,rotation:m,id:v,color:b,opacity:A,popupRef:w},parent:{page:{pageNumber:y}}}=e;i=e={annotationType:j.HIGHLIGHT,color:Array.from(b),opacity:A,quadPoints:p,boxes:null,pageIndex:y-1,rect:g.slice(0),rotation:m,id:v,deleted:!1,popupRef:w}}else if(e instanceof Ae){let{data:{inkLists:p,rect:g,rotation:m,id:v,color:b,borderStyle:{rawWidth:A},popupRef:w},parent:{page:{pageNumber:y}}}=e;i=e={annotationType:j.HIGHLIGHT,color:Array.from(b),thickness:A,inkLists:p,boxes:null,pageIndex:y-1,rect:g.slice(0),rotation:m,id:v,deleted:!1,popupRef:w}}let{color:n,quadPoints:r,inkLists:a,opacity:l}=e,h=yield Ht(o,this,"deserialize").call(this,e,t,s);h.color=k.makeHexColor(...n),h.#a=l||1,a&&(h.#g=e.thickness),h.annotationElementId=e.id||null,h._initialData=i;let[c,d]=h.pageDimensions,[u,f]=h.pageTranslation;if(r){let p=h.#s=[];for(let g=0;g<r.length;g+=8)p.push({x:(r[g]-u)/c,y:1-(r[g+1]-f)/d,width:(r[g+2]-r[g])/c,height:(r[g+1]-r[g+5])/d});h.#A(),h.#P(),h.rotate(h.rotation)}else if(a){h.#d=!0;let p=a[0],g={x:p[0]-u,y:d-(p[1]-f)},m=new xe(g,[0,0,c,d],1,h.#g/2,!0,.001);for(let A=0,w=p.length;A<w;A+=2)g.x=p[A]-u,g.y=d-(p[A+1]-f),m.add(g);let{id:v,clipPathId:b}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:h.color,"fill-opacity":h._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:m.toSVGPath()}},!0,!0);h.#b({highlightOutlines:m.getOutlines(),highlightId:v,clipPathId:b}),h.#P()}return h})}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();let t=this.getRect(0,0),s=it._colorManager.convert(this.color),i={annotationType:j.HIGHLIGHT,color:s,opacity:this.#a,thickness:this.#g,quadPoints:this.#D(),outlines:this.#N(t),pageIndex:this.pageIndex,rect:t,rotation:this.#M(),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!this.#O(i)?null:(i.id=this.annotationElementId,i)}#O(e){let{color:t}=this._initialData;return e.color.some((s,i)=>s!==t[i])}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}},Hi=class{#t=Object.create(null);updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(let[t,s]of Object.entries(e))this.updateProperty(t,s)}updateSVGProperty(e,t){this.#t[e]=t}toSVGProperties(){let e=this.#t;return this.#t=Object.create(null),{root:e}}reset(){this.#t=Object.create(null)}updateAll(e=this){this.updateProperties(e)}clone(){Z("Not implemented")}},br=(()=>{class o extends it{#t=null;#e;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#s=null;static#i=null;static#r=null;static#n=NaN;static#l=null;static#o=null;static#c=NaN;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,t.drawOutlines&&(this.#h(t),this.#f())}#h({drawOutlines:t,drawId:s,drawingOptions:i}){this.#t=t,this._drawingOptions||=i,s>=0?(this._drawId=s,this.parent.drawLayer.finalizeDraw(s,t.defaultProperties)):this._drawId=this.#u(t,this.parent),this.#m(t.box)}#u(t,s){let{id:i}=s.drawLayer.draw(o._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i}static _mergeSVGProperties(t,s){let i=new Set(Object.keys(t));for(let[n,r]of Object.entries(s))i.has(n)?Object.assign(t[n],r):t[n]=r;return t}static getDefaultDrawingOptions(t){Z("Not implemented")}static get typesMap(){Z("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,s){let i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,s),this._currentParent&&(o.#s.updateProperty(i,s),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,s){let i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,s)}static get defaultPropertiesToUpdate(){let t=[],s=this._defaultDrawingOptions;for(let[i,n]of this.typesMap)t.push([i,s[n]]);return t}get propertiesToUpdate(){let t=[],{_drawingOptions:s}=this;for(let[i,n]of this.constructor.typesMap)t.push([i,s[n]]);return t}_updateProperty(t,s,i){let n=this._drawingOptions,r=n[s],a=l=>{n.updateProperty(s,l);let h=this.#t.updateProperty(s,l);h&&this.#m(h),this.parent?.drawLayer.updateProperties(this._drawId,n.toSVGProperties())};this.addCommands({cmd:a.bind(this,i),undo:a.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,o._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#p()),{bbox:this.#g()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,o._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#p()),{bbox:this.#g()}))}_onTranslating(t,s){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#g(t,s)})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,o._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#p(),this.parentDimensions),{bbox:this.#g()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#d(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#f(),this.#m(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let s=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#d()):t&&(this._uiManager.addShouldRescale(this),this.#f(t),s=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),s&&this.select()}#d(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#f(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#u(this.#t,t)}}#a([t,s,i,n]){let{parentDimensions:[r,a],rotation:l}=this;switch(l){case 90:return[s,1-t,i*(a/r),n*(r/a)];case 180:return[1-t,1-s,i,n];case 270:return[1-s,t,i*(a/r),n*(r/a)];default:return[t,s,i,n]}}#p(){let{x:t,y:s,width:i,height:n,parentDimensions:[r,a],rotation:l}=this;switch(l){case 90:return[1-s,t,i*(r/a),n*(a/r)];case 180:return[1-t,1-s,i,n];case 270:return[s,1-t,i*(r/a),n*(a/r)];default:return[t,s,i,n]}}#m(t){if([this.x,this.y,this.width,this.height]=this.#a(t),this.div){this.fixAndSetPosition();let[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i)}this._onResized()}#g(){let{x:t,y:s,width:i,height:n,rotation:r,parentRotation:a,parentDimensions:[l,h]}=this;switch((r*4+a)/90){case 1:return[1-s-n,t,n,i];case 2:return[1-t-i,1-s-n,i,n];case 3:return[s,1-t-i,n,i];case 4:return[t,s-i*(l/h),n*(h/l),i*(l/h)];case 5:return[1-s,t,i*(l/h),n*(h/l)];case 6:return[1-t-n*(h/l),1-s,n*(h/l),i*(l/h)];case 7:return[s-i*(l/h),1-t-n*(h/l),i*(l/h),n*(h/l)];case 8:return[t-i,s-n,i,n];case 9:return[1-s,t-i,n,i];case 10:return[1-t,1-s,i,n];case 11:return[s-n,1-t,n,i];case 12:return[t-n*(h/l),s,n*(h/l),i*(l/h)];case 13:return[1-s-i*(l/h),t-n*(h/l),i*(l/h),n*(h/l)];case 14:return[1-t,1-s-i*(l/h),n*(h/l),i*(l/h)];case 15:return[s,1-t,i*(l/h),n*(h/l)];default:return[t,s,i,n]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,o._mergeSVGProperties({bbox:this.#g()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#m(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t=super.render();t.classList.add("draw");let s=document.createElement("div");t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal";let[i,n]=this.parentDimensions;return this.setDims(this.width*i,this.height*n),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,s,i,n,r){Z("Not implemented")}static startDrawing(t,s,i,n){let{target:r,offsetX:a,offsetY:l,pointerId:h,pointerType:c}=n;if(o.#l&&o.#l!==c)return;let{viewport:{rotation:d}}=t,{width:u,height:f}=r.getBoundingClientRect(),p=o.#i=new AbortController,g=t.combinedSignal(p);if(o.#n||=h,o.#l??=c,window.addEventListener("pointerup",m=>{o.#n===m.pointerId?this._endDraw(m):o.#o?.delete(m.pointerId)},{signal:g}),window.addEventListener("pointercancel",m=>{o.#n===m.pointerId?this._currentParent.endDrawingSession():o.#o?.delete(m.pointerId)},{signal:g}),window.addEventListener("pointerdown",m=>{o.#l===m.pointerType&&((o.#o||=new Set).add(m.pointerId),o.#s.isCancellable()&&(o.#s.removeLastElement(),o.#s.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:g}),window.addEventListener("contextmenu",St,{signal:g}),r.addEventListener("pointermove",this._drawMove.bind(this),{signal:g}),r.addEventListener("touchmove",m=>{m.timeStamp===o.#c&&wt(m)},{signal:g}),t.toggleDrawing(),s._editorUndoBar?.hide(),o.#s){t.drawLayer.updateProperties(this._currentDrawId,o.#s.startNew(a,l,u,f,d));return}s.updateUIForDefaultProperties(this),o.#s=this.createDrawerInstance(a,l,u,f,d),o.#r=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(o.#r.toSVGProperties(),o.#s.defaultSVGProperties),!0,!1)}static _drawMove(t){if(o.#c=-1,!o.#s)return;let{offsetX:s,offsetY:i,pointerId:n}=t;if(o.#n===n){if(o.#o?.size>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,o.#s.add(s,i)),o.#c=t.timeStamp,wt(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,o.#s=null,o.#r=null,o.#l=null,o.#c=NaN),o.#i&&(o.#i.abort(),o.#i=null,o.#n=NaN,o.#o=null)}static _endDraw(t){let s=this._currentParent;if(s){if(s.toggleDrawing(!0),this._cleanup(!1),t&&s.drawLayer.updateProperties(this._currentDrawId,o.#s.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){let i=o.#s,n=this._currentDrawId,r=i.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(n,i.setLastElement(r))},undo:()=>{s.drawLayer.updateProperties(n,i.removeLastElement())},mustExec:!1,type:V.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){let s=this._currentParent;if(!s)return null;if(s.toggleDrawing(!0),s.cleanUndoStack(V.DRAW_STEP),!o.#s.isEmpty()){let{pageDimensions:[i,n],scale:r}=s,a=s.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:o.#s.getOutlines(i*r,n*r,r,this._INNER_MARGIN),drawingOptions:o.#r,mustBeCommitted:!t});return this._cleanup(!0),a}return s.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,s,i,n,r,a){Z("Not implemented")}static deserialize(t,s,i){return D(this,null,function*(){let{rawDims:{pageWidth:n,pageHeight:r,pageX:a,pageY:l}}=s.viewport,h=this.deserializeDraw(a,l,n,r,this._INNER_MARGIN,t),c=yield Ht(o,this,"deserialize").call(this,t,s,i);return c.createDrawingOptions(t),c.#h({drawOutlines:h}),c.#f(),c.onScaleChanging(),c.rotate(),c})}serializeDraw(t){let[s,i]=this.pageTranslation,[n,r]=this.pageDimensions;return this.#t.serialize([s,i,n,r],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}return o})(),$i=class{#t=new Float64Array(6);#e;#s;#i;#r;#n;#l="";#o=0;#c=new cs;#h;#u;constructor(e,t,s,i,n,r){this.#h=s,this.#u=i,this.#i=n,this.#r=r,[e,t]=this.#d(e,t);let a=this.#e=[NaN,NaN,NaN,NaN,e,t];this.#n=[e,t],this.#s=[{line:a,points:this.#n}],this.#t.set(a,0)}updateProperty(e,t){e==="stroke-width"&&(this.#r=t)}#d(e,t){return O._normalizePoint(e,t,this.#h,this.#u,this.#i)}isEmpty(){return!this.#s||this.#s.length===0}isCancellable(){return this.#n.length<=10}add(e,t){[e,t]=this.#d(e,t);let[s,i,n,r]=this.#t.subarray(2,6),a=e-n,l=t-r;return Math.hypot(this.#h*a,this.#u*l)<=2?null:(this.#n.push(e,t),isNaN(s)?(this.#t.set([n,r,e,t],2),this.#e.push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([s,i,n,r,e,t],0),this.#e.push(...O.createBezierPoints(s,i,n,r,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){let s=this.add(e,t);return s||(this.#n.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,s,i,n){this.#h=s,this.#u=i,this.#i=n,[e,t]=this.#d(e,t);let r=this.#e=[NaN,NaN,NaN,NaN,e,t];this.#n=[e,t];let a=this.#s.at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),this.#s.push({line:r,points:this.#n}),this.#t.set(r,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#s.at(-1)}setLastElement(e){return this.#s?(this.#s.push(e),this.#e=e.line,this.#n=e.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#c.setLastElement(e)}removeLastElement(){if(!this.#s)return this.#c.removeLastElement();this.#s.pop(),this.#l="";for(let e=0,t=this.#s.length;e<t;e++){let{line:s,points:i}=this.#s[e];this.#e=s,this.#n=i,this.#o=0,this.toSVGPath()}return{path:{d:this.#l}}}toSVGPath(){let e=O.svgRound(this.#e[4]),t=O.svgRound(this.#e[5]);if(this.#n.length===2)return this.#l=`${this.#l} M ${e} ${t} Z`,this.#l;if(this.#n.length<=6){let i=this.#l.lastIndexOf("M");this.#l=`${this.#l.slice(0,i)} M ${e} ${t}`,this.#o=6}if(this.#n.length===4){let i=O.svgRound(this.#e[10]),n=O.svgRound(this.#e[11]);return this.#l=`${this.#l} L ${i} ${n}`,this.#o=12,this.#l}let s=[];this.#o===0&&(s.push(`M ${e} ${t}`),this.#o=6);for(let i=this.#o,n=this.#e.length;i<n;i+=6){let[r,a,l,h,c,d]=this.#e.slice(i,i+6).map(O.svgRound);s.push(`C${r} ${a} ${l} ${h} ${c} ${d}`)}return this.#l+=s.join(" "),this.#o=this.#e.length,this.#l}getOutlines(e,t,s,i){let n=this.#s.at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),this.#c.build(this.#s,e,t,s,this.#i,this.#r,i),this.#t=null,this.#e=null,this.#s=null,this.#l=null,this.#c}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}},cs=class o extends O{#t;#e=0;#s;#i;#r;#n;#l;#o;#c;build(e,t,s,i,n,r,a){this.#r=t,this.#n=s,this.#l=i,this.#o=n,this.#c=r,this.#s=a??0,this.#i=e,this.#d()}setLastElement(e){return this.#i.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#i.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){let e=[];for(let{line:t}of this.#i){if(e.push(`M${O.svgRound(t[4])} ${O.svgRound(t[5])}`),t.length===6){e.push("Z");continue}if(t.length===12){e.push(`L${O.svgRound(t[10])} ${O.svgRound(t[11])}`);continue}for(let s=6,i=t.length;s<i;s+=6){let[n,r,a,l,h,c]=t.subarray(s,s+6).map(O.svgRound);e.push(`C${n} ${r} ${a} ${l} ${h} ${c}`)}}return e.join("")}serialize([e,t,s,i],n){let r=[],a=[],[l,h,c,d]=this.#u(),u,f,p,g,m,v,b,A,w;switch(this.#o){case 0:w=O._rescale,u=e,f=t+i,p=s,g=-i,m=e+l*s,v=t+(1-h-d)*i,b=e+(l+c)*s,A=t+(1-h)*i;break;case 90:w=O._rescaleAndSwap,u=e,f=t,p=s,g=i,m=e+h*s,v=t+l*i,b=e+(h+d)*s,A=t+(l+c)*i;break;case 180:w=O._rescale,u=e+s,f=t,p=-s,g=i,m=e+(1-l-c)*s,v=t+h*i,b=e+(1-l)*s,A=t+(h+d)*i;break;case 270:w=O._rescaleAndSwap,u=e+s,f=t+i,p=-s,g=-i,m=e+(1-h-d)*s,v=t+(1-l-c)*i,b=e+(1-h)*s,A=t+(1-l)*i;break}for(let{line:y,points:x}of this.#i)r.push(w(y,u,f,p,g,n?new Array(y.length):null)),a.push(w(x,u,f,p,g,n?new Array(x.length):null));return{lines:r,points:a,rect:[m,v,b,A]}}static deserialize(e,t,s,i,n,{paths:{lines:r,points:a},rotation:l,thickness:h}){let c=[],d,u,f,p,g;switch(l){case 0:g=O._rescale,d=-e/s,u=t/i+1,f=1/s,p=-1/i;break;case 90:g=O._rescaleAndSwap,d=-t/i,u=-e/s,f=1/i,p=1/s;break;case 180:g=O._rescale,d=e/s+1,u=-t/i,f=-1/s,p=1/i;break;case 270:g=O._rescaleAndSwap,d=t/i+1,u=e/s+1,f=-1/i,p=-1/s;break}if(!r){r=[];for(let v of a){let b=v.length;if(b===2){r.push(new Float32Array([NaN,NaN,NaN,NaN,v[0],v[1]]));continue}if(b===4){r.push(new Float32Array([NaN,NaN,NaN,NaN,v[0],v[1],NaN,NaN,NaN,NaN,v[2],v[3]]));continue}let A=new Float32Array(3*(b-2));r.push(A);let[w,y,x,E]=v.subarray(0,4);A.set([NaN,NaN,NaN,NaN,w,y],0);for(let C=4;C<b;C+=2){let S=v[C],M=v[C+1];A.set(O.createBezierPoints(w,y,x,E,S,M),(C-2)*3),[w,y,x,E]=[x,E,S,M]}}}for(let v=0,b=r.length;v<b;v++)c.push({line:g(r[v].map(A=>A??NaN),d,u,f,p),points:g(a[v].map(A=>A??NaN),d,u,f,p)});let m=new o;return m.build(c,s,i,1,l,h,n),m}#h(e=this.#c){let t=this.#s+e/2*this.#l;return this.#o%180===0?[t/this.#r,t/this.#n]:[t/this.#n,t/this.#r]}#u(){let[e,t,s,i]=this.#t,[n,r]=this.#h(0);return[e+n,t+r,s-2*n,i-2*r]}#d(){let e=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(let{line:i}of this.#i){if(i.length<=12){for(let a=4,l=i.length;a<l;a+=6){let[h,c]=i.subarray(a,a+2);e[0]=Math.min(e[0],h),e[1]=Math.min(e[1],c),e[2]=Math.max(e[2],h),e[3]=Math.max(e[3],c)}continue}let n=i[4],r=i[5];for(let a=6,l=i.length;a<l;a+=6){let[h,c,d,u,f,p]=i.subarray(a,a+6);k.bezierBoundingBox(n,r,h,c,d,u,f,p,e),n=f,r=p}}let[t,s]=this.#h();e[0]=Math.min(1,Math.max(0,e[0]-t)),e[1]=Math.min(1,Math.max(0,e[1]-s)),e[2]=Math.min(1,Math.max(0,e[2]+t)),e[3]=Math.min(1,Math.max(0,e[3]+s)),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#t}updateProperty(e,t){return e==="stroke-width"?this.#f(t):null}#f(e){let[t,s]=this.#h();this.#c=e;let[i,n]=this.#h(),[r,a]=[i-t,n-s],l=this.#t;return l[0]-=r,l[1]-=a,l[2]+=2*r,l[3]+=2*a,l}updateParentDimensions([e,t],s){let[i,n]=this.#h();this.#r=e,this.#n=t,this.#l=s;let[r,a]=this.#h(),l=r-i,h=a-n,c=this.#t;return c[0]-=l,c[1]-=h,c[2]+=2*l,c[3]+=2*h,c}updateRotation(e){return this.#e=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(O.svgRound).join(" ")}get defaultProperties(){let[e,t]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${O.svgRound(e)} ${O.svgRound(t)}`}}}get rotationTransform(){let[,,e,t]=this.#t,s=0,i=0,n=0,r=0,a=0,l=0;switch(this.#e){case 90:i=t/e,n=-e/t,a=e;break;case 180:s=-1,r=-1,a=e,l=t;break;case 270:i=-t/e,n=e/t,l=t;break;default:return""}return`matrix(${s} ${i} ${n} ${r} ${O.svgRound(a)} ${O.svgRound(l)})`}getPathResizingSVGProperties([e,t,s,i]){let[n,r]=this.#h(),[a,l,h,c]=this.#t;if(Math.abs(h-n)<=O.PRECISION||Math.abs(c-r)<=O.PRECISION){let g=e+s/2-(a+h/2),m=t+i/2-(l+c/2);return{path:{"transform-origin":`${O.svgRound(e)} ${O.svgRound(t)}`,transform:`${this.rotationTransform} translate(${g} ${m})`}}}let d=(s-2*n)/(h-2*n),u=(i-2*r)/(c-2*r),f=h/s,p=c/i;return{path:{"transform-origin":`${O.svgRound(a)} ${O.svgRound(l)}`,transform:`${this.rotationTransform} scale(${f} ${p}) translate(${O.svgRound(n)} ${O.svgRound(r)}) scale(${d} ${u}) translate(${O.svgRound(-n)} ${O.svgRound(-r)})`}}}getPathResizedSVGProperties([e,t,s,i]){let[n,r]=this.#h(),a=this.#t,[l,h,c,d]=a;if(a[0]=e,a[1]=t,a[2]=s,a[3]=i,Math.abs(c-n)<=O.PRECISION||Math.abs(d-r)<=O.PRECISION){let m=e+s/2-(l+c/2),v=t+i/2-(h+d/2);for(let{line:b,points:A}of this.#i)O._translate(b,m,v,b),O._translate(A,m,v,A);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${O.svgRound(e)} ${O.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}let u=(s-2*n)/(c-2*n),f=(i-2*r)/(d-2*r),p=-u*(l+n)+e+n,g=-f*(h+r)+t+r;if(u!==1||f!==1||p!==0||g!==0)for(let{line:m,points:v}of this.#i)O._rescale(m,p,g,u,f,m),O._rescale(v,p,g,u,f,v);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${O.svgRound(e)} ${O.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,t],s){let[i,n]=s,r=this.#t,a=e-r[0],l=t-r[1];if(this.#r===i&&this.#n===n)for(let{line:h,points:c}of this.#i)O._translate(h,a,l,h),O._translate(c,a,l,c);else{let h=this.#r/i,c=this.#n/n;this.#r=i,this.#n=n;for(let{line:d,points:u}of this.#i)O._rescale(d,a,l,h,c,d),O._rescale(u,a,l,h,c,u);r[2]*=h,r[3]*=c}return r[0]=e,r[1]=t,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${O.svgRound(e)} ${O.svgRound(t)}`}}}get defaultSVGProperties(){let e=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${O.svgRound(e[0])} ${O.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}},ji=class o extends Hi{#t;constructor(e){super(),this.#t=e,super.updateProperties({fill:"none",stroke:it._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??=this["stroke-width"],t*=this.#t.realScale),super.updateSVGProperty(e,t)}clone(){let e=new o(this.#t);return e.updateAll(this),e}},Ui=class o extends br{static _type="ink";static _editorType=j.INK;static _defaultDrawingOptions=null;constructor(e){super(Kt(Lt({},e),{name:"inkEditor"})),this._willKeepAspectRatio=!0}static initialize(e,t){it.initialize(e,t),this._defaultDrawingOptions=new ji(t.viewParameters)}static getDefaultDrawingOptions(e){let t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!0}static get typesMap(){return z(this,"typesMap",new Map([[V.INK_THICKNESS,"stroke-width"],[V.INK_COLOR,"stroke"],[V.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,t,s,i,n){return new $i(e,t,s,i,n,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,t,s,i,n,r){return cs.deserialize(e,t,s,i,n,r)}static deserialize(e,t,s){return D(this,null,function*(){let i=null;if(e instanceof Ae){let{data:{inkLists:r,rect:a,rotation:l,id:h,color:c,opacity:d,borderStyle:{rawWidth:u},popupRef:f},parent:{page:{pageNumber:p}}}=e;i=e={annotationType:j.INK,color:Array.from(c),thickness:u,opacity:d,paths:{points:r},boxes:null,pageIndex:p-1,rect:a.slice(0),rotation:l,id:h,deleted:!1,popupRef:f}}let n=yield Ht(o,this,"deserialize").call(this,e,t,s);return n.annotationElementId=e.id||null,n._initialData=i,n})}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();let{_drawId:e,_drawingOptions:t,parent:s}=this;t.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(e,t.toSVGProperties())}static onScaleChangingWhenDrawing(){let e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:t,opacity:s}){this._drawingOptions=o.getDefaultDrawingOptions({stroke:k.makeHexColor(...e),"stroke-width":t,"stroke-opacity":s})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let{lines:t,points:s,rect:i}=this.serializeDraw(e),{_drawingOptions:{stroke:n,"stroke-opacity":r,"stroke-width":a}}=this,l={annotationType:j.INK,color:it._colorManager.convert(n),opacity:r,thickness:a,paths:{lines:t,points:s},pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?l:this.annotationElementId&&!this.#t(l)?null:(l.id=this.annotationElementId,l)}#t(e){let{color:t,thickness:s,opacity:i,pageIndex:n}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||e.color.some((r,a)=>r!==t[a])||e.thickness!==s||e.opacity!==i||e.pageIndex!==n}renderAnnotationElement(e){let{points:t,rect:s}=this.serializeDraw(!1);return e.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:t}),null}},Gi=class o extends it{#t=null;#e=null;#s=null;#i=null;#r=null;#n="";#l=null;#o=null;#c=!1;#h=!1;static _type="stamp";static _editorType=j.STAMP;constructor(e){super(Kt(Lt({},e),{name:"stampEditor"})),this.#i=e.bitmapUrl,this.#r=e.bitmapFile}static initialize(e,t){it.initialize(e,t)}static get supportedTypes(){return z(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(t=>`image/${t}`))}static get supportedTypesStr(){return z(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(e){return this.supportedTypes.includes(e)}static paste(e,t){t.pasteEditor(j.STAMP,{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){let t=e.get("hasAltText");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}#u(e,t=!1){if(!e){this.remove();return}this.#t=e.bitmap,t||(this.#e=e.id,this.#c=e.isSvg),e.file&&(this.#n=e.file.name),this.#a()}#d(){if(this.#s=null,this._uiManager.enableWaiting(!1),!!this.#l){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}mlGuessAltText(e=null,t=!0){return D(this,null,function*(){if(this.hasAltTextData())return null;let{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!(yield s.isEnabledFor("altText")))throw new Error("ML isn't enabled for alt text.");let{data:i,width:n,height:r}=e||this.copyCanvas(null,null,!0).imageData,a=yield s.guess({name:"altText",request:{data:i,width:n,height:r,channels:i.length/(n*r)}});if(!a)throw new Error("No response from the AI service.");if(a.error)throw new Error("Error from the AI service.");if(a.cancel)return null;if(!a.output)throw new Error("No valid response from the AI service.");let l=a.output;return yield this.setGuessedAltText(l),t&&!this.hasAltTextData()&&(this.altTextData={alt:l,decorative:!1}),l})}#f(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(s=>this.#u(s,!0)).finally(()=>this.#d());return}if(this.#i){let s=this.#i;this.#i=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromUrl(s).then(i=>this.#u(i)).finally(()=>this.#d());return}if(this.#r){let s=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromFile(s).then(i=>this.#u(i)).finally(()=>this.#d());return}let e=document.createElement("input");e.type="file",e.accept=o.supportedTypesStr;let t=this._uiManager._signal;this.#s=new Promise(s=>{e.addEventListener("change",()=>D(this,null,function*(){if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);let i=yield this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#u(i)}s()}),{signal:t}),e.addEventListener("cancel",()=>{this.remove(),s()},{signal:t})}).finally(()=>this.#d()),e.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#l?.remove(),this.#l=null,this.#o&&(clearTimeout(this.#o),this.#o=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#f();return}super.rebuild(),this.div!==null&&(this.#e&&this.#l===null&&this.#f(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(this.#s||this.#t||this.#i||this.#r||this.#e)}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;if(this.width&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),this.#t?this.#a():this.#f(),this.width&&!this.annotationElementId){let[s,i]=this.parentDimensions;this.setAt(e*s,t*i,this.width*s,this.height*i)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#o!==null&&clearTimeout(this.#o);let e=200;this.#o=setTimeout(()=>{this.#o=null,this.#m()},e)}#a(){let{div:e}=this,{width:t,height:s}=this.#t,[i,n]=this.pageDimensions,r=.75;if(this.width)t=this.width*i,s=this.height*n;else if(t>r*i||s>r*n){let c=Math.min(r*i/t,r*n/s);t*=c,s*=c}let[a,l]=this.parentDimensions;this.setDims(t*a/i,s*l/n),this._uiManager.enableWaiting(!1);let h=this.#l=document.createElement("canvas");h.setAttribute("role","img"),this.addContainer(h),this.width=t/i,this.height=s/n,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),this.#m(),this.#h||(this.parent.addUndoableEditor(this),this.#h=!0),this._reportTelemetry({action:"inserted_image"}),this.#n&&h.setAttribute("aria-label",this.#n)}copyCanvas(e,t,s=!1){e||(e=224);let{width:i,height:n}=this.#t,r=new ue,a=this.#t,l=i,h=n,c=null;if(t){if(i>t||n>t){let x=Math.min(t/i,t/n);l=Math.floor(i*x),h=Math.floor(n*x)}c=document.createElement("canvas");let u=c.width=Math.ceil(l*r.sx),f=c.height=Math.ceil(h*r.sy);this.#c||(a=this.#p(u,f));let p=c.getContext("2d");p.filter=this._uiManager.hcmFilter;let g="white",m="#cfcfd8";this._uiManager.hcmFilter!=="none"?m="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(g="#8f8f9d",m="#42414d");let v=15,b=v*r.sx,A=v*r.sy,w=new OffscreenCanvas(b*2,A*2),y=w.getContext("2d");y.fillStyle=g,y.fillRect(0,0,b*2,A*2),y.fillStyle=m,y.fillRect(0,0,b,A),y.fillRect(b,A,b,A),p.fillStyle=p.createPattern(w,"repeat"),p.fillRect(0,0,u,f),p.drawImage(a,0,0,a.width,a.height,0,0,u,f)}let d=null;if(s){let u,f;if(r.symmetric&&a.width<e&&a.height<e)u=a.width,f=a.height;else if(a=this.#t,i>e||n>e){let m=Math.min(e/i,e/n);u=Math.floor(i*m),f=Math.floor(n*m),this.#c||(a=this.#p(u,f))}let g=new OffscreenCanvas(u,f).getContext("2d",{willReadFrequently:!0});g.drawImage(a,0,0,a.width,a.height,0,0,u,f),d={width:u,height:f,data:g.getImageData(0,0,u,f).data}}return{canvas:c,width:l,height:h,imageData:d}}#p(e,t){let{width:s,height:i}=this.#t,n=s,r=i,a=this.#t;for(;n>2*e||r>2*t;){let l=n,h=r;n>2*e&&(n=n>=16384?Math.floor(n/2)-1:Math.ceil(n/2)),r>2*t&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2));let c=new OffscreenCanvas(n,r);c.getContext("2d").drawImage(a,0,0,l,h,0,0,n,r),a=c.transferToImageBitmap()}return a}#m(){let[e,t]=this.parentDimensions,{width:s,height:i}=this,n=new ue,r=Math.ceil(s*e*n.sx),a=Math.ceil(i*t*n.sy),l=this.#l;if(!l||l.width===r&&l.height===a)return;l.width=r,l.height=a;let h=this.#c?this.#t:this.#p(r,a),c=l.getContext("2d");c.filter=this._uiManager.hcmFilter,c.drawImage(h,0,0,h.width,h.height,0,0,r,a)}getImageForAltText(){return this.#l}#g(e){if(e){if(this.#c){let i=this._uiManager.imageManager.getSvgUrl(this.#e);if(i)return i}let t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#t,t.getContext("2d").drawImage(this.#t,0,0),t.toDataURL()}if(this.#c){let[t,s]=this.pageDimensions,i=Math.round(this.width*t*Ft.PDF_TO_CSS_UNITS),n=Math.round(this.height*s*Ft.PDF_TO_CSS_UNITS),r=new OffscreenCanvas(i,n);return r.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,i,n),r.transferToImageBitmap()}return structuredClone(this.#t)}static deserialize(e,t,s){return D(this,null,function*(){let i=null;if(e instanceof rs){let{data:{rect:p,rotation:g,id:m,structParent:v,popupRef:b},container:A,parent:{page:{pageNumber:w}}}=e,y=A.querySelector("canvas"),x=s.imageManager.getFromCanvas(A.id,y);y.remove();let E=(yield t._structTree.getAriaAttributes(`${Wi}${m}`))?.get("aria-label")||"";i=e={annotationType:j.STAMP,bitmapId:x.id,bitmap:x.bitmap,pageIndex:w-1,rect:p.slice(0),rotation:g,id:m,deleted:!1,accessibilityData:{decorative:!1,altText:E},isSvg:!1,structParent:v,popupRef:b}}let n=yield Ht(o,this,"deserialize").call(this,e,t,s),{rect:r,bitmap:a,bitmapUrl:l,bitmapId:h,isSvg:c,accessibilityData:d}=e;h&&s.imageManager.isValidId(h)?(n.#e=h,a&&(n.#t=a)):n.#i=l,n.#c=c;let[u,f]=n.pageDimensions;return n.width=(r[2]-r[0])/u,n.height=(r[3]-r[1])/f,n.annotationElementId=e.id||null,d&&(n.altTextData=d),n._initialData=i,n.#h=!!i,n})}serialize(e=!1,t=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let s={annotationType:j.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#c,structTreeParentId:this._structTreeParentId};if(e)return s.bitmapUrl=this.#g(!0),s.accessibilityData=this.serializeAltText(!0),s;let{decorative:i,altText:n}=this.serializeAltText(!1);if(!i&&n&&(s.accessibilityData={type:"Figure",alt:n}),this.annotationElementId){let a=this.#v(s);if(a.isSame)return null;a.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1}if(s.id=this.annotationElementId,t===null)return s;t.stamps||=new Map;let r=this.#c?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!t.stamps.has(this.#e))t.stamps.set(this.#e,{area:r,serialized:s}),s.bitmap=this.#g(!1);else if(this.#c){let a=t.stamps.get(this.#e);r>a.area&&(a.area=r,a.serialized.bitmap.close(),a.serialized.bitmap=this.#g(!1))}return s}#v(e){let{pageIndex:t,accessibilityData:{altText:s}}=this._initialData,i=e.pageIndex===t,n=(e.accessibilityData?.alt||"")===s;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&i&&n,isSameAltText:n}}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}},yr=(()=>{class o{#t;#e=!1;#s=null;#i=null;#r=null;#n=new Map;#l=!1;#o=!1;#c=!1;#h=null;#u=null;#d=null;#f=null;#a;static _initialized=!1;static#p=new Map([Ni,Ui,Gi,hs].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:s,div:i,structTreeLayer:n,accessibilityManager:r,annotationLayer:a,drawLayer:l,textLayer:h,viewport:c,l10n:d}){let u=[...o.#p.values()];if(!o._initialized){o._initialized=!0;for(let f of u)f.initialize(d,t)}t.registerEditorTypes(u),this.#a=t,this.pageIndex=s,this.div=i,this.#t=r,this.#s=a,this.viewport=c,this.#d=h,this.drawLayer=l,this._structTree=n,this.#a.addLayer(this)}get isEmpty(){return this.#n.size===0}get isInvisible(){return this.isEmpty&&this.#a.getMode()===j.NONE}updateToolbar(t){this.#a.updateToolbar(t)}updateMode(t=this.#a.getMode()){switch(this.#b(),t){case j.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case j.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case j.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:s}=this.div;for(let i of o.#p.values())s.toggle(`${i._type}Editing`,t===i._editorType);this.div.hidden=!1}hasTextLayer(t){return t===this.#d?.div}setEditingState(t){this.#a.setEditingState(t)}addCommands(t){this.#a.addCommands(t)}cleanUndoStack(t){this.#a.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#s?.div.classList.toggle("disabled",!t)}enable(){return D(this,null,function*(){this.#c=!0,this.div.tabIndex=0,this.togglePointerEvents(!0);let t=new Set;for(let i of this.#n.values())i.enableEditing(),i.show(!0),i.annotationElementId&&(this.#a.removeChangedExistingAnnotation(i),t.add(i.annotationElementId));if(!this.#s){this.#c=!1;return}let s=this.#s.getEditableAnnotations();for(let i of s){if(i.hide(),this.#a.isDeletedAnnotationElement(i.data.id)||t.has(i.data.id))continue;let n=yield this.deserialize(i);n&&(this.addOrRebuild(n),n.enableEditing())}this.#c=!1})}disable(){this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);let t=new Map,s=new Map;for(let n of this.#n.values())if(n.disableEditing(),!!n.annotationElementId){if(n.serialize()!==null){t.set(n.annotationElementId,n);continue}else s.set(n.annotationElementId,n);this.getEditableAnnotation(n.annotationElementId)?.show(),n.remove()}if(this.#s){let n=this.#s.getEditableAnnotations();for(let r of n){let{id:a}=r.data;if(this.#a.isDeletedAnnotationElement(a))continue;let l=s.get(a);if(l){l.resetAnnotationElement(r),l.show(!1),r.show();continue}l=t.get(a),l&&(this.#a.addChangedExistingAnnotation(l),l.renderAnnotationElement(r)&&l.show(!1)),r.show()}}this.#b(),this.isEmpty&&(this.div.hidden=!0);let{classList:i}=this.div;for(let n of o.#p.values())i.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#o=!1}getEditableAnnotation(t){return this.#s?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#a.getActive()!==t&&this.#a.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#d?.div&&!this.#f){this.#f=new AbortController;let t=this.#a.combinedSignal(this.#f);this.#d.div.addEventListener("pointerdown",this.#m.bind(this),{signal:t}),this.#d.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#d?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#d.div.classList.remove("highlighting"))}#m(t){this.#a.unselectAll();let{target:s}=t;if(s===this.#d.div||(s.getAttribute("role")==="img"||s.classList.contains("endOfContent"))&&this.#d.div.contains(s)){let{isMac:i}=ut.platform;if(t.button!==0||t.ctrlKey&&i)return;this.#a.showAllEditors("highlight",!0,!0),this.#d.div.classList.add("free"),this.toggleDrawing(),hs.startHighlighting(this,this.#a.direction==="ltr",{target:this.#d.div,x:t.x,y:t.y}),this.#d.div.addEventListener("pointerup",()=>{this.#d.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#a._signal}),t.preventDefault()}}enableClick(){if(this.#i)return;this.#i=new AbortController;let t=this.#a.combinedSignal(this.#i);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});let s=this.pointerup.bind(this);this.div.addEventListener("pointerup",s,{signal:t}),this.div.addEventListener("pointercancel",s,{signal:t})}disableClick(){this.#i?.abort(),this.#i=null}attach(t){this.#n.set(t.id,t);let{annotationElementId:s}=t;s&&this.#a.isDeletedAnnotationElement(s)&&this.#a.removeDeletedAnnotationElement(t)}detach(t){this.#n.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#o&&t.annotationElementId&&this.#a.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#a.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#a.addDeletedAnnotationElement(t.annotationElementId),it.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#a.addEditor(t),this.attach(t),!t.isAttachedToDOM){let s=t.render();this.div.append(s),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#c),this.#a.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;let{activeElement:s}=document;t.div.contains(s)&&!this.#r&&(t._focusEventsAllowed=!1,this.#r=setTimeout(()=>{this.#r=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#a._signal}),s.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){let s=()=>t._uiManager.rebuild(t),i=()=>{t.remove()};this.addCommands({cmd:s,undo:i,mustExec:!1})}getNextId(){return this.#a.getId()}get#g(){return o.#p.get(this.#a.getMode())}combinedSignal(t){return this.#a.combinedSignal(t)}#v(t){let s=this.#g;return s?new s.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#g?.canCreateNewEmptyEditor()}pasteEditor(t,s){this.#a.updateToolbar(t),this.#a.updateMode(t);let{offsetX:i,offsetY:n}=this.#A(),r=this.getNextId(),a=this.#v(Lt({parent:this,id:r,x:i,y:n,uiManager:this.#a,isCentered:!0},s));a&&this.add(a)}deserialize(t){return D(this,null,function*(){return(yield o.#p.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#a))||null})}createAndAddNewEditor(t,s,i={}){let n=this.getNextId(),r=this.#v(Lt({parent:this,id:n,x:t.offsetX,y:t.offsetY,uiManager:this.#a,isCentered:s},i));return r&&this.add(r),r}#A(){let{x:t,y:s,width:i,height:n}=this.div.getBoundingClientRect(),r=Math.max(0,t),a=Math.max(0,s),l=Math.min(window.innerWidth,t+i),h=Math.min(window.innerHeight,s+n),c=(r+l)/2-t,d=(a+h)/2-s,[u,f]=this.viewport.rotation%180===0?[c,d]:[d,c];return{offsetX:u,offsetY:f}}addNewEditor(){this.createAndAddNewEditor(this.#A(),!0)}setSelected(t){this.#a.setSelected(t)}toggleSelected(t){this.#a.toggleSelected(t)}unselect(t){this.#a.unselect(t)}pointerup(t){let{isMac:s}=ut.platform;if(!(t.button!==0||t.ctrlKey&&s)&&t.target===this.div&&this.#l&&(this.#l=!1,!(this.#g?.isDrawer&&this.#g.supportMultipleDrawings))){if(!this.#e){this.#e=!0;return}if(this.#a.getMode()===j.STAMP){this.#a.unselectAll();return}this.createAndAddNewEditor(t,!1)}}pointerdown(t){if(this.#a.getMode()===j.HIGHLIGHT&&this.enableTextSelection(),this.#l){this.#l=!1;return}let{isMac:s}=ut.platform;if(t.button!==0||t.ctrlKey&&s||t.target!==this.div)return;if(this.#l=!0,this.#g?.isDrawer){this.startDrawingSession(t);return}let i=this.#a.getActive();this.#e=!i||i.isEmpty()}startDrawingSession(t){if(this.div.focus(),this.#h){this.#g.startDrawing(this,this.#a,!1,t);return}this.#a.setCurrentDrawingSession(this),this.#h=new AbortController;let s=this.#a.combinedSignal(this.#h);this.div.addEventListener("blur",({relatedTarget:i})=>{i&&!this.div.contains(i)&&(this.#u=null,this.commitOrRemove())},{signal:s}),this.#g.startDrawing(this,this.#a,!1,t)}pause(t){if(t){let{activeElement:s}=document;this.div.contains(s)&&(this.#u=s);return}this.#u&&setTimeout(()=>{this.#u?.focus(),this.#u=null},0)}endDrawingSession(t=!1){return this.#h?(this.#a.setCurrentDrawingSession(null),this.#h.abort(),this.#h=null,this.#u=null,this.#g.endDrawing(t)):null}findNewParent(t,s,i){let n=this.#a.findParent(s,i);return n===null||n===this?!1:(n.changeParent(t),!0)}commitOrRemove(){return this.#h?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#h&&this.#g.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#a.getActive()?.parent===this&&(this.#a.commitOrRemove(),this.#a.setActiveEditor(null)),this.#r&&(clearTimeout(this.#r),this.#r=null);for(let t of this.#n.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#n.clear(),this.#a.removeLayer(this)}#b(){for(let t of this.#n.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,Vt(this.div,t);for(let s of this.#a.getEditors(this.pageIndex))this.add(s),s.rebuild();this.updateMode()}update({viewport:t}){this.#a.commitOrRemove(),this.#b();let s=this.viewport.rotation,i=t.rotation;if(this.viewport=t,Vt(this.div,{rotation:i}),s!==i)for(let n of this.#n.values())n.rotate(i)}get pageDimensions(){let{pageWidth:t,pageHeight:s}=this.viewport.rawDims;return[t,s]}get scale(){return this.#a.viewParameters.realScale}}return o})(),zi=class o{#t=null;#e=0;#s=new Map;#i=new Map;constructor({pageIndex:e}){this.pageIndex=e}setParent(e){if(!this.#t){this.#t=e;return}if(this.#t!==e){if(this.#s.size>0)for(let t of this.#s.values())t.remove(),e.append(t);this.#t=e}}static get _svgFactory(){return z(this,"_svgFactory",new be)}static#r(e,[t,s,i,n]){let{style:r}=e;r.top=`${100*s}%`,r.left=`${100*t}%`,r.width=`${100*i}%`,r.height=`${100*n}%`}#n(){let e=o._svgFactory.create(1,1,!0);return this.#t.append(e),e.setAttribute("aria-hidden",!0),e}#l(e,t){let s=o._svgFactory.createElement("clipPath");e.append(s);let i=`clip_${t}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");let n=o._svgFactory.createElement("use");return s.append(n),n.setAttribute("href",`#${t}`),n.classList.add("clip"),i}#o(e,t){for(let[s,i]of Object.entries(t))i===null?e.removeAttribute(s):e.setAttribute(s,i)}draw(e,t=!1,s=!1){let i=this.#e++,n=this.#n(),r=o._svgFactory.createElement("defs");n.append(r);let a=o._svgFactory.createElement("path");r.append(a);let l=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),t&&this.#i.set(i,a);let h=s?this.#l(r,l):null,c=o._svgFactory.createElement("use");return n.append(c),c.setAttribute("href",`#${l}`),this.updateProperties(n,e),this.#s.set(i,n),{id:i,clipPathId:`url(#${h})`}}drawOutline(e,t){let s=this.#e++,i=this.#n(),n=o._svgFactory.createElement("defs");i.append(n);let r=o._svgFactory.createElement("path");n.append(r);let a=`path_p${this.pageIndex}_${s}`;r.setAttribute("id",a),r.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){let d=o._svgFactory.createElement("mask");n.append(d),l=`mask_p${this.pageIndex}_${s}`,d.setAttribute("id",l),d.setAttribute("maskUnits","objectBoundingBox");let u=o._svgFactory.createElement("rect");d.append(u),u.setAttribute("width","1"),u.setAttribute("height","1"),u.setAttribute("fill","white");let f=o._svgFactory.createElement("use");d.append(f),f.setAttribute("href",`#${a}`),f.setAttribute("stroke","none"),f.setAttribute("fill","black"),f.setAttribute("fill-rule","nonzero"),f.classList.add("mask")}let h=o._svgFactory.createElement("use");i.append(h),h.setAttribute("href",`#${a}`),l&&h.setAttribute("mask",`url(#${l})`);let c=h.cloneNode();return i.append(c),h.classList.add("mainOutline"),c.classList.add("secondaryOutline"),this.updateProperties(i,e),this.#s.set(s,i),s}finalizeDraw(e,t){this.#i.delete(e),this.updateProperties(e,t)}updateProperties(e,t){if(!t)return;let{root:s,bbox:i,rootClass:n,path:r}=t,a=typeof e=="number"?this.#s.get(e):e;if(a){if(s&&this.#o(a,s),i&&o.#r(a,i),n){let{classList:l}=a;for(let[h,c]of Object.entries(n))l.toggle(h,c)}if(r){let h=a.firstChild.firstChild;this.#o(h,r)}}}updateParent(e,t){if(t===this)return;let s=this.#s.get(e);s&&(t.#t.append(s),this.#s.delete(e),t.#s.set(e,s))}remove(e){this.#i.delete(e),this.#t!==null&&(this.#s.get(e).remove(),this.#s.delete(e))}destroy(){this.#t=null;for(let e of this.#s.values())e.remove();this.#s.clear(),this.#i.clear()}};globalThis.pdfjsTestingUtils={HighlightOutliner:we};var Kr=F.AbortException,Qr=F.AnnotationEditorLayer,Jr=F.AnnotationEditorParamsType,Zr=F.AnnotationEditorType,qr=F.AnnotationEditorUIManager,ta=F.AnnotationLayer,ea=F.AnnotationMode,sa=F.ColorPicker,ia=F.DOMSVGFactory,na=F.DrawLayer,ra=F.FeatureTest,aa=F.GlobalWorkerOptions,oa=F.ImageKind,la=F.InvalidPDFException,ha=F.MissingPDFException,ca=F.OPS,da=F.OutputScale,ua=F.PDFDataRangeTransport,fa=F.PDFDateString,pa=F.PDFWorker,ga=F.PasswordResponses,ma=F.PermissionFlag,va=F.PixelsPerInch,ba=F.RenderingCancelledException,ya=F.TextLayer,Aa=F.TouchManager,wa=F.UnexpectedResponseException,xa=F.Util,Ea=F.VerbosityLevel,Sa=F.XfaLayer,Ta=F.build,Ca=F.createValidAbsoluteUrl,Ra=F.fetchData,Ia=F.getDocument,Pa=F.getFilenameFromUrl,_a=F.getPdfFilenameFromUrl,Ma=F.getXfaPageViewport,La=F.isDataScheme,Oa=F.isPdfFile,Da=F.noContextMenu,ka=F.normalizeUnicode,Na=F.setLayerDimensions,Fa=F.shadow,Ba=F.stopEvent,Ha=F.version;export{Kr as AbortException,Qr as AnnotationEditorLayer,Jr as AnnotationEditorParamsType,Zr as AnnotationEditorType,qr as AnnotationEditorUIManager,ta as AnnotationLayer,ea as AnnotationMode,sa as ColorPicker,ia as DOMSVGFactory,na as DrawLayer,ra as FeatureTest,aa as GlobalWorkerOptions,oa as ImageKind,la as InvalidPDFException,ha as MissingPDFException,ca as OPS,da as OutputScale,ua as PDFDataRangeTransport,fa as PDFDateString,pa as PDFWorker,ga as PasswordResponses,ma as PermissionFlag,va as PixelsPerInch,ba as RenderingCancelledException,ya as TextLayer,Aa as TouchManager,wa as UnexpectedResponseException,xa as Util,Ea as VerbosityLevel,Sa as XfaLayer,Ta as build,Ca as createValidAbsoluteUrl,Ra as fetchData,Ia as getDocument,Pa as getFilenameFromUrl,_a as getPdfFilenameFromUrl,Ma as getXfaPageViewport,La as isDataScheme,Oa as isPdfFile,Da as noContextMenu,ka as normalizeUnicode,Na as setLayerDimensions,Fa as shadow,Ba as stopEvent,Ha as version};
